{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "rich-text-editor",
  "title": "Rich Text Editor",
  "description": "A modern, feature-rich text editor with slash commands, code blocks, tables, @mentions, callouts, toggles, and file attachments. Built with Tiptap 3.x and React 19.",
  "dependencies": [
    "@tanstack/react-virtual",
    "@tiptap/extension-bubble-menu",
    "@tiptap/extension-code-block-lowlight",
    "@tiptap/extension-color",
    "@tiptap/extension-highlight",
    "@tiptap/extension-image",
    "@tiptap/extension-link",
    "@tiptap/extension-placeholder",
    "@tiptap/extension-table",
    "@tiptap/extension-table-cell",
    "@tiptap/extension-table-header",
    "@tiptap/extension-table-row",
    "@tiptap/extension-task-item",
    "@tiptap/extension-task-list",
    "@tiptap/extension-text-align",
    "@tiptap/extension-text-style",
    "@tiptap/extension-typography",
    "@tiptap/extension-underline",
    "@tiptap/pm",
    "@tiptap/react",
    "@tiptap/starter-kit",
    "@tiptap/suggestion",
    "lowlight",
    "react-pdf",
    "tippy.js"
  ],
  "registryDependencies": [
    "button",
    "popover"
  ],
  "files": [
    {
      "path": "src/components/ui/editor/editor.tsx",
      "content": "import { forwardRef, useCallback, useImperativeHandle, useState, useMemo, useEffect } from 'react'\nimport { useEditor, EditorContent, ReactRenderer } from '@tiptap/react'\nimport tippy, { type Instance as TippyInstance } from 'tippy.js'\nimport { createExtensions } from './extensions'\nimport { SlashCommands } from './extensions/slash-commands'\nimport { defaultSlashCommands } from './commands'\nimport { CommandMenu, type CommandMenuRef } from './command-menu'\nimport { BubbleMenu } from './bubble-menu'\nimport { TableControls } from './table-controls'\nimport { Toolbar } from './toolbar'\nimport { FloatingLinkPopover } from './link-popover'\nimport type {\n  RichTextEditorProps,\n  RichTextEditorRef,\n  SlashCommand,\n  EditorContentFormat,\n  EditorActionContext,\n} from './types'\nimport { cn } from '@/lib/utils'\nimport './editor.css'\n\n// Helper to format CSS value (adds 'px' if number)\nconst formatCssValue = (value: string | number | undefined): string | undefined => {\n  if (value === undefined) return undefined\n  return typeof value === 'number' ? `${value}px` : value\n}\n\nexport const RichTextEditor = forwardRef<RichTextEditorRef, RichTextEditorProps>(function RichTextEditor(\n  {\n    content,\n    onChange,\n    editable = true,\n    placeholder,\n    autoFocus = false,\n    className,\n    showToolbar,\n    plugins = [],\n    minHeight = '200px',\n    codeBlockMaxHeight,\n    calloutTypes,\n  },\n  ref,\n) {\n  const [, setForceUpdate] = useState(0)\n  const [linkPopoverOpen, setLinkPopoverOpen] = useState(false)\n\n  // Action context for commands that need to open popovers/dialogs\n  const openLinkPopover = useCallback(() => setLinkPopoverOpen(true), [setLinkPopoverOpen])\n  const actionContext = useMemo<EditorActionContext>(() => ({ openLinkPopover }), [openLinkPopover])\n\n  // Collect slash commands from plugins\n  const allSlashCommands = [...defaultSlashCommands, ...plugins.flatMap((p) => p.slashCommands ?? [])]\n\n  // Collect extensions from plugins\n  const pluginExtensions = plugins.flatMap((p) => p.extensions ?? [])\n\n  // Collect toolbar actions from plugins\n  const pluginToolbarActions = plugins.flatMap((p) => p.toolbarActions ?? [])\n\n  const editor = useEditor({\n    extensions: [\n      ...createExtensions({ placeholder, calloutTypes }),\n      ...pluginExtensions,\n      SlashCommands.configure({\n        suggestion: {\n          items: ({ query }: { query: string }) => {\n            return allSlashCommands.filter((item) => {\n              const nameMatch = item.name.toLowerCase().includes(query.toLowerCase())\n              const aliasMatch = item.aliases?.some((a) => a.toLowerCase().includes(query.toLowerCase()))\n              return nameMatch || aliasMatch\n            })\n          },\n          command: ({ editor, range, props }: { editor: unknown; range: unknown; props: SlashCommand }) => {\n            // eslint-disable-next-line @typescript-eslint/no-explicit-any\n            ;(editor as any).chain().focus().deleteRange(range).run()\n            // eslint-disable-next-line @typescript-eslint/no-explicit-any\n            props.action(editor as any, actionContext)\n          },\n          render: () => {\n            let component: ReactRenderer<CommandMenuRef> | null = null\n            let popup: TippyInstance[] | null = null\n            // Store the range and editor for use in onSelect\n            let currentRange: unknown = null\n            let currentEditor: unknown = null\n\n            return {\n              onStart: (props: {\n                editor: unknown\n                clientRect: (() => DOMRect | null) | null\n                items: SlashCommand[]\n                range: unknown\n              }) => {\n                currentEditor = props.editor\n                currentRange = props.range\n\n                component = new ReactRenderer(CommandMenu, {\n                  props: {\n                    items: props.items,\n                    query: '',\n                    onSelect: (command: SlashCommand) => {\n                      // Delete the \"/\" and any typed query, then execute the command\n                      if (currentEditor && currentRange) {\n                        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n                        ;(currentEditor as any).chain().focus().deleteRange(currentRange).run()\n                        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n                        command.action(currentEditor as any, actionContext)\n                      }\n                      popup?.[0]?.hide()\n                    },\n                    onClose: () => {\n                      popup?.[0]?.hide()\n                    },\n                  },\n                  editor: props.editor as import('@tiptap/react').Editor,\n                })\n\n                if (!props.clientRect) return\n\n                popup = tippy('body', {\n                  getReferenceClientRect: props.clientRect as () => DOMRect,\n                  appendTo: () => document.body,\n                  content: component.element,\n                  showOnCreate: true,\n                  interactive: true,\n                  trigger: 'manual',\n                  placement: 'bottom-start',\n                })\n              },\n              onUpdate: (props: {\n                query: string\n                items: SlashCommand[]\n                clientRect: (() => DOMRect | null) | null\n                range: unknown\n              }) => {\n                // Update the range as user types\n                currentRange = props.range\n\n                component?.updateProps({\n                  items: props.items,\n                  query: props.query,\n                })\n\n                if (props.clientRect) {\n                  popup?.[0]?.setProps({\n                    getReferenceClientRect: props.clientRect as () => DOMRect,\n                  })\n                }\n              },\n              onKeyDown: (props: { event: KeyboardEvent }) => {\n                if (props.event.key === 'Escape') {\n                  popup?.[0]?.hide()\n                  return true\n                }\n\n                return component?.ref?.onKeyDown(props.event) ?? false\n              },\n              onExit: () => {\n                popup?.[0]?.destroy()\n                component?.destroy()\n              },\n            }\n          },\n        },\n      }),\n    ],\n    content: typeof content === 'string' ? content : content,\n    editable,\n    autofocus: autoFocus,\n    onUpdate: ({ editor }) => {\n      if (onChange) {\n        onChange({\n          html: editor.getHTML(),\n          json: editor.getJSON(),\n          text: editor.getText(),\n        })\n      }\n      // Force re-render for controlled component behavior\n      setForceUpdate((n) => n + 1)\n    },\n    immediatelyRender: true,\n  })\n\n  // Initialize plugins via useEffect to ensure editor and DOM are fully ready.\n  // This is more reliable than onCreate which can have timing issues in TipTap v3.\n  useEffect(() => {\n    if (!editor || editor.isDestroyed) return\n\n    plugins.forEach((plugin) => plugin.onInit?.(editor))\n\n    return () => {\n      plugins.forEach((plugin) => plugin.onDestroy?.())\n    }\n  }, [editor, plugins])\n\n  // Imperative handle\n  const getContent = useCallback(\n    (format: EditorContentFormat = 'html') => {\n      if (!editor) return null\n      switch (format) {\n        case 'html':\n          return editor.getHTML()\n        case 'json':\n          return editor.getJSON()\n        case 'text':\n          return editor.getText()\n        default:\n          return editor.getHTML()\n      }\n    },\n    [editor],\n  )\n\n  const setContent = useCallback(\n    (newContent: string | Record<string, unknown>) => {\n      if (!editor) return\n      if (typeof newContent === 'string') {\n        editor.commands.setContent(newContent)\n      } else {\n        editor.commands.setContent(newContent)\n      }\n    },\n    [editor],\n  )\n\n  useImperativeHandle(\n    ref,\n    () => ({\n      getEditor: () => editor,\n      getContent,\n      setContent,\n      focus: () => editor?.commands.focus(),\n      blur: () => editor?.commands.blur(),\n      isEmpty: () => editor?.isEmpty ?? true,\n      clear: () => editor?.commands.clearContent(),\n    }),\n    [editor, getContent, setContent],\n  )\n\n  if (!editor) {\n    return null\n  }\n\n  // Determine if toolbar should be shown (defaults to true in edit mode)\n  const shouldShowToolbar = showToolbar ?? editable\n\n  // Build style object with CSS custom properties\n  const editorStyle = {\n    minHeight,\n    '--code-block-max-height': formatCssValue(codeBlockMaxHeight),\n  } as React.CSSProperties\n\n  if (shouldShowToolbar && editable) {\n    return (\n      <div className=\"editor-with-toolbar\" style={editorStyle}>\n        <Toolbar editor={editor} pluginActions={pluginToolbarActions} />\n        <div className={cn('rich-text-editor', className)} data-editable={editable}>\n          <BubbleMenu editor={editor} />\n          <TableControls editor={editor} />\n          <EditorContent editor={editor} />\n        </div>\n        <FloatingLinkPopover editor={editor} open={linkPopoverOpen} onOpenChange={setLinkPopoverOpen} />\n      </div>\n    )\n  }\n\n  return (\n    <div className={cn('rich-text-editor', className)} data-editable={editable} style={editorStyle}>\n      {editable && <BubbleMenu editor={editor} />}\n      {editable && <TableControls editor={editor} />}\n      <EditorContent editor={editor} />\n      {editable && <FloatingLinkPopover editor={editor} open={linkPopoverOpen} onOpenChange={setLinkPopoverOpen} />}\n    </div>\n  )\n})\n",
      "type": "registry:component"
    },
    {
      "path": "src/components/ui/editor/viewer.tsx",
      "content": "import { useEffect, useMemo, useRef } from 'react'\nimport { useEditor, EditorContent } from '@tiptap/react'\nimport { createExtensions } from './extensions'\nimport { FileAttachment } from './extensions/file-attachment'\nimport { MentionExtension } from './extensions/mention-extension'\nimport type { RichTextViewerProps } from './types'\nimport { cn } from '@/lib/utils'\nimport './editor.css'\n\n// Helper to format CSS value (adds 'px' if number)\nconst formatCssValue = (value: string | number | undefined): string | undefined => {\n  if (value === undefined) return undefined\n  return typeof value === 'number' ? `${value}px` : value\n}\n\n/**\n * Lightweight read-only viewer for displaying rich text content.\n * Renders content without editing UI (no bubble menu, no slash commands).\n */\nexport function RichTextViewer({ content, className, onMentionClick, codeBlockMaxHeight }: RichTextViewerProps) {\n  const extensions = useMemo(\n    () => [\n      ...createExtensions(),\n      FileAttachment, // Include file attachment support for viewing\n      MentionExtension.configure({\n        onMentionClick,\n      }),\n    ],\n    [onMentionClick],\n  )\n\n  const editor = useEditor({\n    extensions,\n    content: typeof content === 'string' ? content : content,\n    editable: false,\n    immediatelyRender: true,\n  })\n\n  // Track whether this is the initial mount to avoid unnecessary setContent on first render\n  const isInitialMount = useRef(true)\n\n  // Sync content prop changes to the editor (useEditor only uses content on creation)\n  useEffect(() => {\n    if (!editor || editor.isDestroyed) return\n    if (isInitialMount.current) {\n      isInitialMount.current = false\n      return\n    }\n    const newContent = typeof content === 'string' ? content : content\n    editor.commands.setContent(newContent ?? '')\n  }, [editor, content])\n\n  if (!editor) {\n    return null\n  }\n\n  // Build style object with CSS custom properties\n  const viewerStyle = {\n    '--code-block-max-height': formatCssValue(codeBlockMaxHeight),\n  } as React.CSSProperties\n\n  return (\n    <div className={cn('rich-text-editor', className)} data-editable=\"false\" style={viewerStyle}>\n      <EditorContent editor={editor} />\n    </div>\n  )\n}\n",
      "type": "registry:component"
    },
    {
      "path": "src/components/ui/editor/toolbar.tsx",
      "content": "import type { Editor } from '@tiptap/react'\nimport {\n  Bold,\n  Italic,\n  Underline as UnderlineIcon,\n  Strikethrough,\n  Code,\n  Heading1,\n  Heading2,\n  Heading3,\n  List,\n  ListOrdered,\n  CheckSquare,\n  Quote,\n  Minus,\n  Undo,\n  Redo,\n  AlignLeft,\n  AlignCenter,\n  AlignRight,\n  Highlighter,\n  Type,\n  Table2,\n} from 'lucide-react'\nimport { cn } from '@/lib/utils'\nimport { Button } from '@/components/ui/button'\nimport type { ToolbarAction } from './types'\nimport { LinkPopoverButton } from './link-popover'\n\ninterface ToolbarProps {\n  editor: Editor\n  pluginActions?: ToolbarAction[]\n}\n\ninterface ToolbarButtonProps {\n  icon: React.ReactNode\n  onClick: () => void\n  isActive?: boolean\n  disabled?: boolean\n  title: string\n}\n\nfunction ToolbarButton({ icon, onClick, isActive, disabled, title }: ToolbarButtonProps) {\n  return (\n    <Button\n      variant={isActive ? 'default' : 'ghost'}\n      size=\"icon-sm\"\n      onClick={onClick}\n      disabled={disabled}\n      title={title}\n      type=\"button\"\n      className={cn(isActive && 'bg-primary text-primary-foreground', disabled && 'opacity-40 cursor-not-allowed')}\n    >\n      {icon}\n    </Button>\n  )\n}\n\nfunction ToolbarDivider() {\n  return <div className=\"toolbar-divider\" />\n}\n\nexport function Toolbar({ editor, pluginActions = [] }: ToolbarProps) {\n  if (!editor) {\n    return null\n  }\n\n  return (\n    <div className=\"toolbar\" data-slot=\"editor-toolbar\">\n      {/* Undo/Redo */}\n      <ToolbarButton\n        icon={<Undo size={16} />}\n        onClick={() => editor.chain().focus().undo().run()}\n        disabled={!editor.can().undo()}\n        title=\"Undo (Cmd+Z)\"\n      />\n      <ToolbarButton\n        icon={<Redo size={16} />}\n        onClick={() => editor.chain().focus().redo().run()}\n        disabled={!editor.can().redo()}\n        title=\"Redo (Cmd+Shift+Z)\"\n      />\n\n      <ToolbarDivider />\n\n      {/* Text Styles */}\n      <ToolbarButton\n        icon={<Type size={16} />}\n        onClick={() => editor.chain().focus().setParagraph().run()}\n        isActive={editor.isActive('paragraph')}\n        title=\"Normal text\"\n      />\n      <ToolbarButton\n        icon={<Heading1 size={16} />}\n        onClick={() => editor.chain().focus().toggleHeading({ level: 1 }).run()}\n        isActive={editor.isActive('heading', { level: 1 })}\n        title=\"Heading 1\"\n      />\n      <ToolbarButton\n        icon={<Heading2 size={16} />}\n        onClick={() => editor.chain().focus().toggleHeading({ level: 2 }).run()}\n        isActive={editor.isActive('heading', { level: 2 })}\n        title=\"Heading 2\"\n      />\n      <ToolbarButton\n        icon={<Heading3 size={16} />}\n        onClick={() => editor.chain().focus().toggleHeading({ level: 3 }).run()}\n        isActive={editor.isActive('heading', { level: 3 })}\n        title=\"Heading 3\"\n      />\n\n      <ToolbarDivider />\n\n      {/* Text Formatting */}\n      <ToolbarButton\n        icon={<Bold size={16} />}\n        onClick={() => editor.chain().focus().toggleBold().run()}\n        isActive={editor.isActive('bold')}\n        title=\"Bold (Cmd+B)\"\n      />\n      <ToolbarButton\n        icon={<Italic size={16} />}\n        onClick={() => editor.chain().focus().toggleItalic().run()}\n        isActive={editor.isActive('italic')}\n        title=\"Italic (Cmd+I)\"\n      />\n      <ToolbarButton\n        icon={<UnderlineIcon size={16} />}\n        onClick={() => editor.chain().focus().toggleUnderline().run()}\n        isActive={editor.isActive('underline')}\n        title=\"Underline (Cmd+U)\"\n      />\n      <ToolbarButton\n        icon={<Strikethrough size={16} />}\n        onClick={() => editor.chain().focus().toggleStrike().run()}\n        isActive={editor.isActive('strike')}\n        title=\"Strikethrough\"\n      />\n      <ToolbarButton\n        icon={<Code size={16} />}\n        onClick={() => editor.chain().focus().toggleCode().run()}\n        isActive={editor.isActive('code')}\n        title=\"Inline code\"\n      />\n      <ToolbarButton\n        icon={<Highlighter size={16} />}\n        onClick={() => editor.chain().focus().toggleHighlight().run()}\n        isActive={editor.isActive('highlight')}\n        title=\"Highlight\"\n      />\n\n      <ToolbarDivider />\n\n      {/* Alignment */}\n      <ToolbarButton\n        icon={<AlignLeft size={16} />}\n        onClick={() => editor.chain().focus().setTextAlign('left').run()}\n        isActive={editor.isActive({ textAlign: 'left' })}\n        title=\"Align left\"\n      />\n      <ToolbarButton\n        icon={<AlignCenter size={16} />}\n        onClick={() => editor.chain().focus().setTextAlign('center').run()}\n        isActive={editor.isActive({ textAlign: 'center' })}\n        title=\"Align center\"\n      />\n      <ToolbarButton\n        icon={<AlignRight size={16} />}\n        onClick={() => editor.chain().focus().setTextAlign('right').run()}\n        isActive={editor.isActive({ textAlign: 'right' })}\n        title=\"Align right\"\n      />\n\n      <ToolbarDivider />\n\n      {/* Lists */}\n      <ToolbarButton\n        icon={<List size={16} />}\n        onClick={() => editor.chain().focus().toggleBulletList().run()}\n        isActive={editor.isActive('bulletList')}\n        title=\"Bullet list\"\n      />\n      <ToolbarButton\n        icon={<ListOrdered size={16} />}\n        onClick={() => editor.chain().focus().toggleOrderedList().run()}\n        isActive={editor.isActive('orderedList')}\n        title=\"Numbered list\"\n      />\n      <ToolbarButton\n        icon={<CheckSquare size={16} />}\n        onClick={() => editor.chain().focus().toggleTaskList().run()}\n        isActive={editor.isActive('taskList')}\n        title=\"Task list\"\n      />\n\n      <ToolbarDivider />\n\n      {/* Block Elements */}\n      <ToolbarButton\n        icon={<Quote size={16} />}\n        onClick={() => editor.chain().focus().toggleBlockquote().run()}\n        isActive={editor.isActive('blockquote')}\n        title=\"Quote\"\n      />\n      <ToolbarButton\n        icon={<Minus size={16} />}\n        onClick={() => editor.chain().focus().setHorizontalRule().run()}\n        title=\"Divider\"\n      />\n      <ToolbarButton\n        icon={<Table2 size={16} />}\n        onClick={() => editor.chain().focus().insertTable({ rows: 3, cols: 3, withHeaderRow: true }).run()}\n        isActive={editor.isActive('table')}\n        title=\"Insert table\"\n      />\n\n      <ToolbarDivider />\n\n      {/* Link */}\n      <LinkPopoverButton editor={editor} variant=\"toolbar\" />\n\n      {/* Plugin Actions */}\n      {pluginActions.length > 0 && (\n        <>\n          <ToolbarDivider />\n          {pluginActions.map((action) => (\n            <ToolbarButton\n              key={action.id}\n              icon={<action.icon size={16} />}\n              onClick={() => action.action(editor)}\n              isActive={action.isActive?.(editor)}\n              title={action.label}\n            />\n          ))}\n        </>\n      )}\n    </div>\n  )\n}\n",
      "type": "registry:component"
    },
    {
      "path": "src/components/ui/editor/bubble-menu.tsx",
      "content": "import { useEffect, useState, useCallback, useRef } from 'react'\nimport type { Editor } from '@tiptap/react'\nimport { Bold, Italic, Underline as UnderlineIcon, Strikethrough, Code, Highlighter, Link } from 'lucide-react'\nimport { cn } from '@/lib/utils'\nimport { Button } from '@/components/ui/button'\nimport { LinkPopoverContent } from './link-popover'\n\n// Offset from selection to position bubble menu above text\nconst BUBBLE_MENU_OFFSET_Y = 50\n\ninterface BubbleMenuProps {\n  editor: Editor\n}\n\nexport function BubbleMenu({ editor }: BubbleMenuProps) {\n  const [isVisible, setIsVisible] = useState(false)\n  const [position, setPosition] = useState({ top: 0, left: 0 })\n  const [showLinkPopover, setShowLinkPopover] = useState(false)\n  const menuRef = useRef<HTMLDivElement>(null)\n  const linkPopoverOpenRef = useRef(false)\n\n  // Track link popover state in ref for blur handler\n  useEffect(() => {\n    linkPopoverOpenRef.current = showLinkPopover\n  }, [showLinkPopover])\n\n  const updatePosition = useCallback(() => {\n    // Don't hide if link popover is open\n    if (linkPopoverOpenRef.current) return\n\n    const { selection } = editor.state\n    const { from, to } = selection\n\n    if (from === to) {\n      setIsVisible(false)\n      return\n    }\n\n    // Check if selection is text (not node selection)\n    const isTextSelection = !selection.empty && editor.state.doc.textBetween(from, to, ' ').length > 0\n\n    if (!isTextSelection) {\n      setIsVisible(false)\n      return\n    }\n\n    const { view } = editor\n    const start = view.coordsAtPos(from)\n    const end = view.coordsAtPos(to)\n\n    // Position above the selection\n    const left = (start.left + end.left) / 2\n    const top = start.top - BUBBLE_MENU_OFFSET_Y\n\n    setPosition({ top, left })\n    setIsVisible(true)\n  }, [editor])\n\n  const handleBlur = useCallback(() => {\n    // Don't hide if link popover is open\n    if (linkPopoverOpenRef.current) return\n    setIsVisible(false)\n  }, [])\n\n  useEffect(() => {\n    editor.on('selectionUpdate', updatePosition)\n    editor.on('blur', handleBlur)\n\n    return () => {\n      editor.off('selectionUpdate', updatePosition)\n      editor.off('blur', handleBlur)\n    }\n  }, [editor, updatePosition, handleBlur])\n\n  // Close link popover and refocus editor\n  const handleLinkPopoverClose = useCallback(() => {\n    setShowLinkPopover(false)\n    editor.chain().focus().run()\n  }, [editor])\n\n  if (!isVisible) {\n    return null\n  }\n\n  return (\n    <div\n      ref={menuRef}\n      className=\"bubble-menu\"\n      data-slot=\"editor-bubble-menu\"\n      style={{\n        position: 'fixed',\n        top: position.top,\n        left: position.left,\n        transform: 'translateX(-50%)',\n        zIndex: 50,\n      }}\n      onMouseDown={(e) => e.preventDefault()}\n    >\n      {showLinkPopover ? (\n        <div className=\"p-1\">\n          <LinkPopoverContent editor={editor} onClose={handleLinkPopoverClose} />\n        </div>\n      ) : (\n        <>\n          <Button\n            variant={editor.isActive('bold') ? 'default' : 'ghost'}\n            size=\"icon-sm\"\n            onClick={() => editor.chain().focus().toggleBold().run()}\n            className={cn(editor.isActive('bold') && 'bg-primary text-primary-foreground')}\n            title=\"Bold (Cmd+B)\"\n          >\n            <Bold size={16} />\n          </Button>\n\n          <Button\n            variant={editor.isActive('italic') ? 'default' : 'ghost'}\n            size=\"icon-sm\"\n            onClick={() => editor.chain().focus().toggleItalic().run()}\n            className={cn(editor.isActive('italic') && 'bg-primary text-primary-foreground')}\n            title=\"Italic (Cmd+I)\"\n          >\n            <Italic size={16} />\n          </Button>\n\n          <Button\n            variant={editor.isActive('underline') ? 'default' : 'ghost'}\n            size=\"icon-sm\"\n            onClick={() => editor.chain().focus().toggleUnderline().run()}\n            className={cn(editor.isActive('underline') && 'bg-primary text-primary-foreground')}\n            title=\"Underline (Cmd+U)\"\n          >\n            <UnderlineIcon size={16} />\n          </Button>\n\n          <Button\n            variant={editor.isActive('strike') ? 'default' : 'ghost'}\n            size=\"icon-sm\"\n            onClick={() => editor.chain().focus().toggleStrike().run()}\n            className={cn(editor.isActive('strike') && 'bg-primary text-primary-foreground')}\n            title=\"Strikethrough\"\n          >\n            <Strikethrough size={16} />\n          </Button>\n\n          <div className=\"bubble-menu-divider\" />\n\n          <Button\n            variant={editor.isActive('code') ? 'default' : 'ghost'}\n            size=\"icon-sm\"\n            onClick={() => editor.chain().focus().toggleCode().run()}\n            className={cn(editor.isActive('code') && 'bg-primary text-primary-foreground')}\n            title=\"Inline Code (Cmd+E)\"\n          >\n            <Code size={16} />\n          </Button>\n\n          <Button\n            variant={editor.isActive('link') ? 'default' : 'ghost'}\n            size=\"icon-sm\"\n            onClick={() => setShowLinkPopover(true)}\n            className={cn(editor.isActive('link') && 'bg-primary text-primary-foreground')}\n            title=\"Add Link (Cmd+K)\"\n          >\n            <Link size={16} />\n          </Button>\n\n          <Button\n            variant={editor.isActive('highlight') ? 'default' : 'ghost'}\n            size=\"icon-sm\"\n            onClick={() => editor.chain().focus().toggleHighlight().run()}\n            className={cn(editor.isActive('highlight') && 'bg-primary text-primary-foreground')}\n            title=\"Highlight\"\n          >\n            <Highlighter size={16} />\n          </Button>\n        </>\n      )}\n    </div>\n  )\n}\n",
      "type": "registry:component"
    },
    {
      "path": "src/components/ui/editor/command-menu.tsx",
      "content": "import { forwardRef, useEffect, useImperativeHandle, useLayoutEffect, useState, useCallback } from 'react'\nimport type { SlashCommand } from './types'\nimport { filterCommands, groupCommands } from './commands'\nimport { cn } from '@/lib/utils'\n\ninterface CommandMenuProps {\n  items: SlashCommand[]\n  query: string\n  onSelect: (command: SlashCommand) => void\n  onClose: () => void\n}\n\nexport interface CommandMenuRef {\n  onKeyDown: (event: KeyboardEvent) => boolean\n}\n\nexport const CommandMenu = forwardRef<CommandMenuRef, CommandMenuProps>(function CommandMenu(\n  { items, query, onSelect, onClose },\n  ref,\n) {\n  const [selectedIndex, setSelectedIndex] = useState(0)\n\n  // Filter items based on query\n  const filteredItems = filterCommands(items, query)\n  const groupedItems = groupCommands(filteredItems)\n\n  // Flatten for keyboard navigation\n  const flatItems = Array.from(groupedItems.values()).flat()\n\n  // Reset selection when items change\n  useLayoutEffect(() => {\n    setSelectedIndex(0)\n  }, [query])\n\n  // Scroll selected item into view\n  useEffect(() => {\n    const element = document.querySelector(`[data-command-index=\"${selectedIndex}\"]`)\n    element?.scrollIntoView({ block: 'nearest' })\n  }, [selectedIndex])\n\n  const selectItem = useCallback(\n    (index: number) => {\n      const item = flatItems[index]\n      if (item) {\n        onSelect(item)\n      }\n    },\n    [flatItems, onSelect],\n  )\n\n  useImperativeHandle(ref, () => ({\n    onKeyDown: (event: KeyboardEvent) => {\n      if (event.key === 'ArrowUp') {\n        setSelectedIndex((prev) => (prev <= 0 ? flatItems.length - 1 : prev - 1))\n        return true\n      }\n\n      if (event.key === 'ArrowDown') {\n        setSelectedIndex((prev) => (prev >= flatItems.length - 1 ? 0 : prev + 1))\n        return true\n      }\n\n      if (event.key === 'Enter') {\n        selectItem(selectedIndex)\n        return true\n      }\n\n      if (event.key === 'Escape') {\n        onClose()\n        return true\n      }\n\n      return false\n    },\n  }))\n\n  if (flatItems.length === 0) {\n    return (\n      <div className=\"command-menu\">\n        <div className=\"command-menu-empty\">No results found</div>\n      </div>\n    )\n  }\n\n  let globalIndex = 0\n\n  return (\n    <div className=\"command-menu\">\n      {Array.from(groupedItems.entries()).map(([group, commands]) => (\n        <div key={group.id} className=\"command-menu-group\">\n          <div className=\"command-menu-group-label\">{group.label}</div>\n          {commands.map((command) => {\n            const index = globalIndex++\n            const Icon = command.icon\n            return (\n              <button\n                key={command.name}\n                data-command-index={index}\n                className={cn('command-menu-item', index === selectedIndex && 'command-menu-item-selected')}\n                onClick={() => onSelect(command)}\n                onMouseEnter={() => setSelectedIndex(index)}\n              >\n                <div className=\"command-menu-item-icon\">\n                  <Icon size={18} />\n                </div>\n                <div className=\"command-menu-item-content\">\n                  <div className=\"command-menu-item-name\">{command.name}</div>\n                  <div className=\"command-menu-item-description\">{command.description}</div>\n                </div>\n              </button>\n            )\n          })}\n        </div>\n      ))}\n    </div>\n  )\n})\n",
      "type": "registry:component"
    },
    {
      "path": "src/components/ui/editor/link-popover.tsx",
      "content": "import { useState, useCallback, useRef, useLayoutEffect, useId } from 'react'\nimport type { Editor } from '@tiptap/react'\nimport { Button } from '@/components/ui/button'\nimport { Popover, PopoverContent, PopoverTrigger } from '@/components/ui/popover'\nimport { Link, Trash2 } from 'lucide-react'\nimport { cn } from '@/lib/utils'\n\ninterface LinkPopoverContentProps {\n  editor: Editor\n  onClose: () => void\n}\n\n// Focus delay for inputs after popover opens\nconst INPUT_FOCUS_DELAY_MS = 50\n\nexport function LinkPopoverContent({ editor, onClose }: LinkPopoverContentProps) {\n  // Get initial values from editor state\n  const getInitialValues = useCallback(() => {\n    const { from, to } = editor.state.selection\n    const selectedText = editor.state.doc.textBetween(from, to, ' ')\n    const linkMark = editor.getAttributes('link')\n    return {\n      text: selectedText || '',\n      url: (linkMark.href as string) || '',\n    }\n  }, [editor])\n\n  const initialValues = getInitialValues()\n  const [text, setText] = useState(initialValues.text)\n  const [url, setUrl] = useState(initialValues.url)\n  const urlInputRef = useRef<HTMLInputElement>(null)\n  const textInputRef = useRef<HTMLInputElement>(null)\n  const instanceId = useId()\n  const textInputId = `link-text-${instanceId}`\n  const urlInputId = `link-url-${instanceId}`\n\n  // Focus appropriate input after mount\n  useLayoutEffect(() => {\n    const timer = setTimeout(() => {\n      if (initialValues.text) {\n        urlInputRef.current?.focus()\n        urlInputRef.current?.select()\n      } else {\n        textInputRef.current?.focus()\n      }\n    }, INPUT_FOCUS_DELAY_MS)\n    return () => clearTimeout(timer)\n  }, [initialValues.text])\n\n  const handleSubmit = useCallback(() => {\n    if (!url) {\n      onClose()\n      return\n    }\n\n    const { from, to } = editor.state.selection\n    const selectedText = editor.state.doc.textBetween(from, to, ' ')\n\n    if (text && text !== selectedText) {\n      // Text was modified - delete selection and insert new text with link\n      editor\n        .chain()\n        .focus()\n        .deleteSelection()\n        .insertContent({\n          type: 'text',\n          text: text,\n          marks: [{ type: 'link', attrs: { href: url } }],\n        })\n        .run()\n    } else if (text) {\n      // Apply link to existing text\n      editor.chain().focus().extendMarkRange('link').setLink({ href: url }).run()\n    } else {\n      // No text - insert URL as both text and link\n      editor\n        .chain()\n        .focus()\n        .insertContent({\n          type: 'text',\n          text: url,\n          marks: [{ type: 'link', attrs: { href: url } }],\n        })\n        .run()\n    }\n\n    onClose()\n  }, [editor, text, url, onClose])\n\n  const handleRemoveLink = useCallback(() => {\n    editor.chain().focus().extendMarkRange('link').unsetLink().run()\n    onClose()\n  }, [editor, onClose])\n\n  const handleKeyDown = useCallback(\n    (e: React.KeyboardEvent) => {\n      if (e.key === 'Enter') {\n        e.preventDefault()\n        handleSubmit()\n      }\n      if (e.key === 'Escape') {\n        e.preventDefault()\n        onClose()\n      }\n    },\n    [handleSubmit, onClose],\n  )\n\n  const isEditing = editor.isActive('link')\n\n  return (\n    <div className=\"flex flex-col gap-3\">\n      <div className=\"flex flex-col gap-1.5\">\n        <label htmlFor={textInputId} className=\"text-xs font-medium text-muted-foreground\">\n          Text\n        </label>\n        <input\n          ref={textInputRef}\n          id={textInputId}\n          type=\"text\"\n          placeholder=\"Link text...\"\n          value={text}\n          onChange={(e) => setText(e.target.value)}\n          onKeyDown={handleKeyDown}\n          className=\"flex h-8 w-full rounded-md border border-input bg-transparent px-2.5 py-1.5 text-sm shadow-sm transition-colors placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring\"\n        />\n      </div>\n\n      <div className=\"flex flex-col gap-1.5\">\n        <label htmlFor={urlInputId} className=\"text-xs font-medium text-muted-foreground\">\n          URL\n        </label>\n        <input\n          ref={urlInputRef}\n          id={urlInputId}\n          type=\"url\"\n          placeholder=\"https://...\"\n          value={url}\n          onChange={(e) => setUrl(e.target.value)}\n          onKeyDown={handleKeyDown}\n          className=\"flex h-8 w-full rounded-md border border-input bg-transparent px-2.5 py-1.5 text-sm shadow-sm transition-colors placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring\"\n        />\n      </div>\n\n      <div className=\"flex items-center justify-between pt-1\">\n        {isEditing ? (\n          <Button\n            type=\"button\"\n            variant=\"ghost\"\n            size=\"xs\"\n            onClick={handleRemoveLink}\n            className=\"text-destructive hover:text-destructive hover:bg-destructive/10\"\n          >\n            <Trash2 size={12} className=\"mr-1\" />\n            Remove\n          </Button>\n        ) : (\n          <div />\n        )}\n        <div className=\"flex gap-1.5\">\n          <Button type=\"button\" variant=\"ghost\" size=\"xs\" onClick={onClose}>\n            Cancel\n          </Button>\n          <Button type=\"button\" size=\"xs\" onClick={handleSubmit} disabled={!url}>\n            {isEditing ? 'Update' : 'Add'}\n          </Button>\n        </div>\n      </div>\n    </div>\n  )\n}\n\n// Self-contained button with popover for toolbar use\ninterface LinkPopoverButtonProps {\n  editor: Editor\n  variant?: 'toolbar' | 'bubble'\n  className?: string\n}\n\nexport function LinkPopoverButton({ editor, variant = 'toolbar', className }: LinkPopoverButtonProps) {\n  const [open, setOpen] = useState(false)\n\n  const isEditing = editor.isActive('link')\n\n  return (\n    <Popover open={open} onOpenChange={setOpen}>\n      <PopoverTrigger\n        render={\n          <Button\n            variant={isEditing ? 'default' : 'ghost'}\n            size={variant === 'toolbar' ? 'icon-sm' : 'icon-sm'}\n            className={cn(isEditing && 'bg-primary text-primary-foreground', className)}\n            title=\"Add/Edit link\"\n            type=\"button\"\n            onPointerDown={(e) => {\n              // Prevent editor from losing focus\n              e.preventDefault()\n            }}\n          >\n            <Link size={16} />\n          </Button>\n        }\n      />\n      <PopoverContent side=\"bottom\" align=\"start\" sideOffset={8} className=\"w-80\">\n        <LinkPopoverContent editor={editor} onClose={() => setOpen(false)} />\n      </PopoverContent>\n    </Popover>\n  )\n}\n\n// Floating modal that can be triggered programmatically (for slash commands)\ninterface FloatingLinkPopoverProps {\n  editor: Editor\n  open: boolean\n  onOpenChange: (open: boolean) => void\n}\n\nexport function FloatingLinkPopover({ editor, open, onOpenChange }: FloatingLinkPopoverProps) {\n  if (!open) return null\n\n  return (\n    <>\n      {/* Backdrop */}\n      <div className=\"fixed inset-0 z-40\" aria-hidden=\"true\" onClick={() => onOpenChange(false)} />\n      {/* Modal */}\n      <div\n        role=\"dialog\"\n        aria-modal=\"true\"\n        aria-label=\"Add link\"\n        className=\"fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 z-50 rounded-lg border bg-popover p-3 text-popover-foreground shadow-md w-80 animate-in fade-in-0 zoom-in-95\"\n        onMouseDown={(e) => e.stopPropagation()}\n      >\n        <LinkPopoverContent editor={editor} onClose={() => onOpenChange(false)} />\n      </div>\n    </>\n  )\n}\n",
      "type": "registry:component"
    },
    {
      "path": "src/components/ui/editor/table-controls.tsx",
      "content": "import { useEffect, useState, useCallback, useRef } from 'react'\nimport { createPortal } from 'react-dom'\nimport type { Editor } from '@tiptap/react'\nimport { Plus, Trash2, GripVertical, AlignLeft, AlignCenter, AlignRight, Maximize2 } from 'lucide-react'\nimport { cn } from '@/lib/utils'\nimport { Button } from '@/components/ui/button'\nimport type { TableAlignment } from './extensions/table'\n\ninterface TableControlsProps {\n  editor: Editor\n}\n\nconst TABLE_SIZES = [\n  { label: 'S', width: 400 },\n  { label: 'M', width: 600 },\n  { label: 'L', width: 800 },\n  { label: 'Full', width: null },\n]\n\nexport function TableControls({ editor }: TableControlsProps) {\n  const [tableElement, setTableElement] = useState<HTMLElement | null>(null)\n  const [tablePos, setTablePos] = useState<number | null>(null)\n  const [hoveredRow, setHoveredRow] = useState<number | null>(null)\n  const [hoveredCol, setHoveredCol] = useState<number | null>(null)\n  const [showRowMenu, setShowRowMenu] = useState<number | null>(null)\n  const [showColMenu, setShowColMenu] = useState<number | null>(null)\n  const [showTableMenu, setShowTableMenu] = useState(false)\n  const [menuPosition, setMenuPosition] = useState({ top: 0, left: 0 })\n  const [isResizing, setIsResizing] = useState(false)\n  const [liveTableRect, setLiveTableRect] = useState<DOMRect | null>(null) // Live rect during resize\n  const controlsRef = useRef<HTMLDivElement>(null)\n  const resizeStartRef = useRef<{ x: number; width: number; newWidth?: number } | null>(null)\n\n  // Get table attributes\n  const getTableAttributes = useCallback(() => {\n    if (!editor.isActive('table')) return { alignment: 'left' as TableAlignment, width: null }\n\n    const { selection } = editor.state\n    const $pos = selection.$from\n\n    for (let depth = $pos.depth; depth > 0; depth--) {\n      const node = $pos.node(depth)\n      if (node.type.name === 'table') {\n        return {\n          alignment: (node.attrs.alignment || 'left') as TableAlignment,\n          width: node.attrs.width as number | null,\n        }\n      }\n    }\n    return { alignment: 'left' as TableAlignment, width: null }\n  }, [editor])\n\n  const [tableAttrs, setTableAttrs] = useState(getTableAttributes())\n\n  // Find the table element when cursor is inside a table\n  const updateTableElement = useCallback(() => {\n    if (!editor.isActive('table')) {\n      setTableElement(null)\n      setTablePos(null)\n      setShowRowMenu(null)\n      setShowColMenu(null)\n      setShowTableMenu(false)\n      return\n    }\n\n    const { selection } = editor.state\n    const $pos = selection.$from\n\n    for (let depth = $pos.depth; depth > 0; depth--) {\n      const node = $pos.node(depth)\n      if (node.type.name === 'table') {\n        const pos = $pos.before(depth)\n        setTablePos(pos)\n        const dom = editor.view.nodeDOM(pos) as HTMLElement | null\n        if (dom) {\n          // Find the actual table element (might be wrapped)\n          const table = dom.tagName === 'TABLE' ? dom : dom.querySelector('table')\n          const wrapper = dom.classList.contains('tableWrapper') ? dom : dom.closest('.tableWrapper')\n          setTableElement((wrapper || table) as HTMLElement)\n          setTableAttrs(getTableAttributes())\n          return\n        }\n        break\n      }\n    }\n    setTableElement(null)\n    setTablePos(null)\n  }, [editor, getTableAttributes])\n\n  useEffect(() => {\n    editor.on('selectionUpdate', updateTableElement)\n    editor.on('transaction', updateTableElement)\n    return () => {\n      editor.off('selectionUpdate', updateTableElement)\n      editor.off('transaction', updateTableElement)\n    }\n  }, [editor, updateTableElement])\n\n  // Apply initial styles when table element changes\n  useEffect(() => {\n    if (tableElement && tableAttrs) {\n      const wrapper = tableElement.classList.contains('tableWrapper')\n        ? tableElement\n        : tableElement.closest('.tableWrapper')\n\n      if (wrapper instanceof HTMLElement) {\n        // Apply alignment\n        wrapper.style.marginLeft = tableAttrs.alignment === 'center' || tableAttrs.alignment === 'right' ? 'auto' : ''\n        wrapper.style.marginRight = tableAttrs.alignment === 'center' ? 'auto' : ''\n        // Apply width\n        if (tableAttrs.width) {\n          wrapper.style.width = `${tableAttrs.width}px`\n          wrapper.style.maxWidth = '100%'\n        } else {\n          wrapper.style.width = ''\n        }\n      }\n    }\n  }, [tableElement, tableAttrs])\n\n  // Close menus on click outside\n  useEffect(() => {\n    const handleClickOutside = (e: MouseEvent) => {\n      if (controlsRef.current && !controlsRef.current.contains(e.target as Node)) {\n        setShowRowMenu(null)\n        setShowColMenu(null)\n        setShowTableMenu(false)\n      }\n    }\n    document.addEventListener('mousedown', handleClickOutside)\n    return () => document.removeEventListener('mousedown', handleClickOutside)\n  }, [])\n\n  // Update table attributes and apply styles to wrapper\n  const updateTableAttributes = useCallback(\n    (attrs: Record<string, unknown>) => {\n      if (tablePos === null) return\n\n      const { tr } = editor.state\n      tr.setNodeMarkup(tablePos, undefined, {\n        ...editor.state.doc.nodeAt(tablePos)?.attrs,\n        ...attrs,\n      })\n      editor.view.dispatch(tr)\n      setTableAttrs((prev) => ({ ...prev, ...attrs }) as typeof prev)\n\n      // Apply styles to wrapper element\n      if (tableElement) {\n        const wrapper = tableElement.classList.contains('tableWrapper')\n          ? tableElement\n          : tableElement.closest('.tableWrapper')\n\n        if (wrapper instanceof HTMLElement) {\n          // Apply alignment\n          if (attrs.alignment) {\n            wrapper.style.marginLeft = attrs.alignment === 'center' || attrs.alignment === 'right' ? 'auto' : ''\n            wrapper.style.marginRight = attrs.alignment === 'center' ? 'auto' : ''\n          }\n          // Apply width\n          if ('width' in attrs) {\n            wrapper.style.width = attrs.width ? `${attrs.width}px` : ''\n            wrapper.style.maxWidth = '100%'\n          }\n        }\n      }\n    },\n    [editor, tablePos, tableElement],\n  )\n\n  // Resize handlers\n  const handleResizeStart = useCallback(\n    (e: React.MouseEvent) => {\n      if (!tableElement) return\n      e.preventDefault()\n      e.stopPropagation()\n\n      const rect = tableElement.getBoundingClientRect()\n      resizeStartRef.current = {\n        x: e.clientX,\n        width: rect.width,\n      }\n      setIsResizing(true)\n\n      // Add resizing class for visual feedback\n      const wrapper = tableElement.classList.contains('tableWrapper')\n        ? tableElement\n        : tableElement.closest('.tableWrapper')\n      if (wrapper) {\n        wrapper.classList.add('resizing')\n      }\n    },\n    [tableElement],\n  )\n\n  const handleResizeMove = useCallback(\n    (e: MouseEvent) => {\n      if (!resizeStartRef.current || !tableElement) return\n      const deltaX = e.clientX - resizeStartRef.current.x\n      const newWidth = Math.max(300, Math.min(1200, resizeStartRef.current.width + deltaX))\n\n      // Store in ref to avoid full re-renders during drag\n      resizeStartRef.current.newWidth = newWidth\n\n      // Apply width immediately to wrapper for live preview (DOM only)\n      const wrapper = tableElement.classList.contains('tableWrapper')\n        ? tableElement\n        : tableElement.closest('.tableWrapper')\n\n      if (wrapper instanceof HTMLElement) {\n        wrapper.style.width = `${newWidth}px`\n        wrapper.style.maxWidth = '100%'\n        wrapper.style.overflow = 'hidden' // Prevent content from expanding wrapper\n\n        // Update live rect for handle positioning\n        setLiveTableRect(wrapper.getBoundingClientRect())\n      }\n    },\n    [tableElement],\n  )\n\n  const handleResizeEnd = useCallback(() => {\n    // Remove resizing class and restore overflow\n    if (tableElement) {\n      const wrapper = tableElement.classList.contains('tableWrapper')\n        ? tableElement\n        : tableElement.closest('.tableWrapper')\n      if (wrapper instanceof HTMLElement) {\n        wrapper.classList.remove('resizing')\n        wrapper.style.overflow = '' // Restore overflow\n      }\n    }\n\n    // Use width from ref (set during drag) instead of state\n    if (resizeStartRef.current?.newWidth) {\n      const finalWidth = Math.round(resizeStartRef.current.newWidth)\n      updateTableAttributes({ width: finalWidth })\n    }\n    resizeStartRef.current = null\n    setIsResizing(false)\n    setLiveTableRect(null) // Clear live rect\n  }, [updateTableAttributes, tableElement])\n\n  useEffect(() => {\n    if (isResizing) {\n      // Add cursor style to body for smooth resize experience\n      document.body.style.cursor = 'se-resize'\n      document.body.style.userSelect = 'none'\n\n      window.addEventListener('mousemove', handleResizeMove)\n      window.addEventListener('mouseup', handleResizeEnd)\n      return () => {\n        document.body.style.cursor = ''\n        document.body.style.userSelect = ''\n        window.removeEventListener('mousemove', handleResizeMove)\n        window.removeEventListener('mouseup', handleResizeEnd)\n      }\n    }\n  }, [isResizing, handleResizeMove, handleResizeEnd])\n\n  // Handle table click for menu\n  const handleTableClick = useCallback(() => {\n    if (isResizing) return\n    const rect = tableElement?.getBoundingClientRect()\n    if (rect) {\n      setMenuPosition({\n        top: rect.top - 50,\n        left: rect.left + rect.width / 2,\n      })\n      setShowTableMenu(true)\n    }\n  }, [tableElement, isResizing])\n\n  if (!tableElement || !editor.isEditable) {\n    return null\n  }\n\n  const tableRect = tableElement.getBoundingClientRect()\n  const actualTable = tableElement.tagName === 'TABLE' ? tableElement : tableElement.querySelector('table')\n\n  if (!actualTable) return null\n\n  const rows = Array.from(actualTable.querySelectorAll('tr'))\n  const firstRowCells = Array.from(rows[0]?.querySelectorAll('td, th') || [])\n\n  // Get column positions from first row cells\n  const columnPositions = firstRowCells.map((cell, index) => {\n    const rect = cell.getBoundingClientRect()\n    return { left: rect.left, right: rect.right, width: rect.width, index }\n  })\n\n  // Get row positions\n  const rowPositions = rows.map((row, index) => {\n    const rect = row.getBoundingClientRect()\n    return { top: rect.top, bottom: rect.bottom, height: rect.height, index }\n  })\n\n  return (\n    <>\n      <div ref={controlsRef} className=\"table-controls\">\n        {/* Row handles on the left */}\n        {rowPositions.map((row, index) => (\n          <div\n            key={`row-${index}`}\n            className={cn(\n              'table-row-handle',\n              (hoveredRow === index || showRowMenu === index) && 'table-row-handle-active',\n            )}\n            style={{\n              position: 'fixed',\n              top: row.top,\n              left: tableRect.left - 32,\n              height: row.height,\n            }}\n            onMouseEnter={() => setHoveredRow(index)}\n            onMouseLeave={() => !showRowMenu && setHoveredRow(null)}\n          >\n            <button\n              className=\"table-row-handle-button\"\n              onClick={() => setShowRowMenu(showRowMenu === index ? null : index)}\n            >\n              <GripVertical size={14} />\n            </button>\n\n            {/* Row menu dropdown */}\n            {showRowMenu === index && (\n              <div className=\"table-control-dropdown table-row-dropdown\">\n                <button\n                  className=\"table-control-dropdown-item\"\n                  onClick={() => {\n                    editor.chain().focus().addRowBefore().run()\n                    setShowRowMenu(null)\n                  }}\n                >\n                  <Plus size={14} />\n                  <span>Insert above</span>\n                </button>\n                <button\n                  className=\"table-control-dropdown-item\"\n                  onClick={() => {\n                    editor.chain().focus().addRowAfter().run()\n                    setShowRowMenu(null)\n                  }}\n                >\n                  <Plus size={14} />\n                  <span>Insert below</span>\n                </button>\n                <div className=\"table-control-dropdown-divider\" />\n                <button\n                  className=\"table-control-dropdown-item table-control-dropdown-item-danger\"\n                  onClick={() => {\n                    editor.chain().focus().deleteRow().run()\n                    setShowRowMenu(null)\n                  }}\n                >\n                  <Trash2 size={14} />\n                  <span>Delete row</span>\n                </button>\n              </div>\n            )}\n          </div>\n        ))}\n\n        {/* Column add buttons - at top between columns */}\n        {columnPositions.map((col, index) => (\n          <div\n            key={`col-${index}`}\n            className={cn(\n              'table-col-handle',\n              (hoveredCol === index || showColMenu === index) && 'table-col-handle-active',\n            )}\n            style={{\n              position: 'fixed',\n              top: tableRect.top - 12,\n              left: col.right - 10,\n            }}\n            onMouseEnter={() => setHoveredCol(index)}\n            onMouseLeave={() => !showColMenu && setHoveredCol(null)}\n          >\n            <button\n              className=\"table-col-add-button\"\n              onClick={() => setShowColMenu(showColMenu === index ? null : index)}\n            >\n              <Plus size={12} />\n            </button>\n\n            {/* Vertical line */}\n            <div className=\"table-col-line\" style={{ height: tableRect.height + 12 }} />\n\n            {/* Column menu dropdown */}\n            {showColMenu === index && (\n              <div className=\"table-control-dropdown table-col-dropdown\">\n                <button\n                  className=\"table-control-dropdown-item\"\n                  onClick={() => {\n                    editor.chain().focus().addColumnBefore().run()\n                    setShowColMenu(null)\n                  }}\n                >\n                  <Plus size={14} />\n                  <span>Insert left</span>\n                </button>\n                <button\n                  className=\"table-control-dropdown-item\"\n                  onClick={() => {\n                    editor.chain().focus().addColumnAfter().run()\n                    setShowColMenu(null)\n                  }}\n                >\n                  <Plus size={14} />\n                  <span>Insert right</span>\n                </button>\n                <div className=\"table-control-dropdown-divider\" />\n                <button\n                  className=\"table-control-dropdown-item table-control-dropdown-item-danger\"\n                  onClick={() => {\n                    editor.chain().focus().deleteColumn().run()\n                    setShowColMenu(null)\n                  }}\n                >\n                  <Trash2 size={14} />\n                  <span>Delete column</span>\n                </button>\n              </div>\n            )}\n          </div>\n        ))}\n\n        {/* Table options button - top left */}\n        <button\n          className=\"table-options-button\"\n          style={{\n            position: 'fixed',\n            top: tableRect.top - 12,\n            left: tableRect.left - 32,\n          }}\n          onClick={handleTableClick}\n          title=\"Table options\"\n        >\n          <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\n            <rect x=\"3\" y=\"3\" width=\"18\" height=\"18\" rx=\"2\" />\n            <path d=\"M3 9h18\" />\n            <path d=\"M9 21V9\" />\n          </svg>\n        </button>\n\n        {/* Resize handle - bottom right corner */}\n        <div\n          className={cn('table-resize-handle', isResizing && 'table-resize-handle-active')}\n          style={{\n            position: 'fixed',\n            top: (liveTableRect || tableRect).bottom - 12,\n            left: (liveTableRect || tableRect).right - 12,\n          }}\n          onMouseDown={handleResizeStart}\n          title=\"Drag to resize\"\n        >\n          <div className=\"table-resize-handle-inner\" />\n        </div>\n\n        {/* Add row at bottom */}\n        <div\n          className=\"table-add-row-bottom\"\n          style={{\n            position: 'fixed',\n            top: (liveTableRect || tableRect).bottom + 4,\n            left: (liveTableRect || tableRect).left,\n            width: (liveTableRect || tableRect).width,\n          }}\n        >\n          <button className=\"table-add-row-bottom-button\" onClick={() => editor.chain().focus().addRowAfter().run()}>\n            <Plus size={14} />\n            <span>Add row</span>\n          </button>\n        </div>\n      </div>\n\n      {/* Floating table menu */}\n      {showTableMenu &&\n        createPortal(\n          <div\n            className=\"table-floating-menu\"\n            style={{\n              position: 'fixed',\n              top: menuPosition.top,\n              left: menuPosition.left,\n              transform: 'translateX(-50%)',\n              zIndex: 50,\n            }}\n            onMouseDown={(e) => e.stopPropagation()}\n          >\n            {/* Alignment */}\n            <div className=\"table-menu-section\">\n              <Button\n                variant={tableAttrs.alignment === 'left' ? 'default' : 'ghost'}\n                size=\"icon-xs\"\n                onClick={() => updateTableAttributes({ alignment: 'left' })}\n                title=\"Align left\"\n                className={cn('h-7 w-7', tableAttrs.alignment === 'left' && 'bg-primary text-primary-foreground')}\n              >\n                <AlignLeft size={14} />\n              </Button>\n              <Button\n                variant={tableAttrs.alignment === 'center' ? 'default' : 'ghost'}\n                size=\"icon-xs\"\n                onClick={() => updateTableAttributes({ alignment: 'center' })}\n                title=\"Align center\"\n                className={cn('h-7 w-7', tableAttrs.alignment === 'center' && 'bg-primary text-primary-foreground')}\n              >\n                <AlignCenter size={14} />\n              </Button>\n              <Button\n                variant={tableAttrs.alignment === 'right' ? 'default' : 'ghost'}\n                size=\"icon-xs\"\n                onClick={() => updateTableAttributes({ alignment: 'right' })}\n                title=\"Align right\"\n                className={cn('h-7 w-7', tableAttrs.alignment === 'right' && 'bg-primary text-primary-foreground')}\n              >\n                <AlignRight size={14} />\n              </Button>\n            </div>\n\n            <div className=\"table-menu-divider\" />\n\n            {/* Size */}\n            <div className=\"table-menu-section\">\n              {TABLE_SIZES.map((size) => (\n                <Button\n                  key={size.label}\n                  variant={tableAttrs.width === size.width ? 'default' : 'ghost'}\n                  size=\"icon-xs\"\n                  onClick={() => updateTableAttributes({ width: size.width })}\n                  title={size.width ? `${size.width}px` : 'Full width'}\n                  className={cn(\n                    'h-7 w-7 text-xs font-medium',\n                    tableAttrs.width === size.width && 'bg-primary text-primary-foreground',\n                  )}\n                >\n                  {size.label === 'Full' ? <Maximize2 size={14} /> : size.label}\n                </Button>\n              ))}\n            </div>\n\n            <div className=\"table-menu-divider\" />\n\n            {/* Delete */}\n            <Button\n              variant=\"ghost\"\n              size=\"icon-xs\"\n              onClick={() => {\n                editor.chain().focus().deleteTable().run()\n                setShowTableMenu(false)\n              }}\n              title=\"Delete table\"\n              className=\"h-7 w-7 text-destructive hover:text-destructive hover:bg-destructive/10\"\n            >\n              <Trash2 size={14} />\n            </Button>\n          </div>,\n          document.body,\n        )}\n    </>\n  )\n}\n",
      "type": "registry:component"
    },
    {
      "path": "src/components/ui/editor/code-block.tsx",
      "content": "import { NodeViewWrapper, NodeViewContent, type NodeViewProps } from '@tiptap/react'\nimport { useState, useCallback } from 'react'\nimport { Check, Copy, ChevronDown } from 'lucide-react'\nimport { cn } from '@/lib/utils'\n\n// Common programming languages for the selector\nconst LANGUAGES = [\n  { value: '', label: 'Plain text' },\n  { value: 'javascript', label: 'JavaScript' },\n  { value: 'typescript', label: 'TypeScript' },\n  { value: 'jsx', label: 'JSX' },\n  { value: 'tsx', label: 'TSX' },\n  { value: 'html', label: 'HTML' },\n  { value: 'css', label: 'CSS' },\n  { value: 'scss', label: 'SCSS' },\n  { value: 'json', label: 'JSON' },\n  { value: 'python', label: 'Python' },\n  { value: 'java', label: 'Java' },\n  { value: 'c', label: 'C' },\n  { value: 'cpp', label: 'C++' },\n  { value: 'csharp', label: 'C#' },\n  { value: 'go', label: 'Go' },\n  { value: 'rust', label: 'Rust' },\n  { value: 'ruby', label: 'Ruby' },\n  { value: 'php', label: 'PHP' },\n  { value: 'swift', label: 'Swift' },\n  { value: 'kotlin', label: 'Kotlin' },\n  { value: 'sql', label: 'SQL' },\n  { value: 'bash', label: 'Bash' },\n  { value: 'shell', label: 'Shell' },\n  { value: 'yaml', label: 'YAML' },\n  { value: 'markdown', label: 'Markdown' },\n  { value: 'xml', label: 'XML' },\n  { value: 'dockerfile', label: 'Dockerfile' },\n]\n\nexport function CodeBlockComponent({ node, updateAttributes, editor }: NodeViewProps) {\n  const [copied, setCopied] = useState(false)\n  const [showLanguageDropdown, setShowLanguageDropdown] = useState(false)\n\n  const language = node.attrs.language || ''\n  const currentLanguage = LANGUAGES.find((l) => l.value === language) || LANGUAGES[0]\n  const isEditable = editor.isEditable\n\n  const copyCode = useCallback(() => {\n    const code = node.textContent\n    navigator.clipboard.writeText(code).then(() => {\n      setCopied(true)\n      setTimeout(() => setCopied(false), 2000)\n    })\n  }, [node.textContent])\n\n  const setLanguage = useCallback(\n    (lang: string) => {\n      updateAttributes({ language: lang })\n      setShowLanguageDropdown(false)\n    },\n    [updateAttributes],\n  )\n\n  // In view mode, render a simpler code block without edit controls\n  if (!isEditable) {\n    return (\n      <NodeViewWrapper className=\"code-block-wrapper code-block-view-mode\">\n        <div className=\"code-block-header\">\n          {/* Show language label (read-only) */}\n          <div className=\"code-block-language-label\">{currentLanguage.label}</div>\n\n          {/* Copy Button - available in view mode too */}\n          <button className=\"code-block-copy-button\" onClick={copyCode} contentEditable={false} title=\"Copy code\">\n            {copied ? (\n              <>\n                <Check size={14} />\n                <span>Copied!</span>\n              </>\n            ) : (\n              <>\n                <Copy size={14} />\n                <span>Copy</span>\n              </>\n            )}\n          </button>\n        </div>\n\n        <pre>\n          <code>\n            <NodeViewContent />\n          </code>\n        </pre>\n      </NodeViewWrapper>\n    )\n  }\n\n  // Edit mode - full controls\n  return (\n    <NodeViewWrapper className=\"code-block-wrapper\">\n      <div className=\"code-block-header\">\n        {/* Language Selector */}\n        <div className=\"code-block-language-container\">\n          <button\n            className=\"code-block-language-button\"\n            onClick={() => setShowLanguageDropdown(!showLanguageDropdown)}\n            contentEditable={false}\n          >\n            <span>{currentLanguage.label}</span>\n            <ChevronDown size={14} />\n          </button>\n\n          {showLanguageDropdown && (\n            <div className=\"code-block-language-dropdown\" contentEditable={false}>\n              {LANGUAGES.map((lang) => (\n                <button\n                  key={lang.value}\n                  className={cn(\n                    'code-block-language-option',\n                    lang.value === language && 'code-block-language-option-active',\n                  )}\n                  onClick={() => setLanguage(lang.value)}\n                >\n                  {lang.label}\n                </button>\n              ))}\n            </div>\n          )}\n        </div>\n\n        {/* Copy Button */}\n        <button className=\"code-block-copy-button\" onClick={copyCode} contentEditable={false} title=\"Copy code\">\n          {copied ? (\n            <>\n              <Check size={14} />\n              <span>Copied!</span>\n            </>\n          ) : (\n            <>\n              <Copy size={14} />\n              <span>Copy</span>\n            </>\n          )}\n        </button>\n      </div>\n\n      <pre>\n        <code>\n          <NodeViewContent />\n        </code>\n      </pre>\n    </NodeViewWrapper>\n  )\n}\n",
      "type": "registry:component"
    },
    {
      "path": "src/components/ui/editor/callout.tsx",
      "content": "import { NodeViewWrapper, NodeViewContent, type NodeViewProps } from '@tiptap/react'\nimport { Info, AlertTriangle, XCircle, CheckCircle, ChevronDown } from 'lucide-react'\nimport { useState, useRef, useEffect, useCallback, useMemo } from 'react'\nimport { cn } from '@/lib/utils'\nimport type { CalloutTypeConfig } from './types'\n\n// Default callout types\nconst DEFAULT_CALLOUT_TYPES: CalloutTypeConfig[] = [\n  {\n    id: 'info',\n    label: 'Info',\n    icon: Info,\n    bgLight: 'hsl(210 100% 97%)',\n    borderLight: 'hsl(210 100% 85%)',\n    iconColorLight: 'hsl(210 100% 50%)',\n    bgDark: 'hsl(210 50% 15%)',\n    borderDark: 'hsl(210 50% 30%)',\n    iconColorDark: 'hsl(210 100% 70%)',\n  },\n  {\n    id: 'warning',\n    label: 'Warning',\n    icon: AlertTriangle,\n    bgLight: 'hsl(45 100% 96%)',\n    borderLight: 'hsl(45 100% 75%)',\n    iconColorLight: 'hsl(45 100% 40%)',\n    bgDark: 'hsl(45 50% 15%)',\n    borderDark: 'hsl(45 50% 30%)',\n    iconColorDark: 'hsl(45 100% 60%)',\n  },\n  {\n    id: 'error',\n    label: 'Error',\n    icon: XCircle,\n    bgLight: 'hsl(0 100% 97%)',\n    borderLight: 'hsl(0 70% 85%)',\n    iconColorLight: 'hsl(0 70% 50%)',\n    bgDark: 'hsl(0 50% 15%)',\n    borderDark: 'hsl(0 50% 30%)',\n    iconColorDark: 'hsl(0 70% 65%)',\n  },\n  {\n    id: 'success',\n    label: 'Success',\n    icon: CheckCircle,\n    bgLight: 'hsl(140 60% 96%)',\n    borderLight: 'hsl(140 60% 80%)',\n    iconColorLight: 'hsl(140 60% 40%)',\n    bgDark: 'hsl(140 30% 15%)',\n    borderDark: 'hsl(140 30% 30%)',\n    iconColorDark: 'hsl(140 60% 60%)',\n  },\n]\n\nexport { DEFAULT_CALLOUT_TYPES }\n\nexport function CalloutComponent({ node, updateAttributes, editor, extension }: NodeViewProps) {\n  const [showTypeDropdown, setShowTypeDropdown] = useState(false)\n  const [dropdownPosition, setDropdownPosition] = useState({ top: 0, left: 0 })\n  const buttonRef = useRef<HTMLButtonElement>(null)\n  const dropdownRef = useRef<HTMLDivElement>(null)\n\n  // Get custom types from extension options, or use defaults\n  const calloutTypes: CalloutTypeConfig[] = extension.options.calloutTypes || DEFAULT_CALLOUT_TYPES\n\n  const calloutTypeId = (node.attrs.type || calloutTypes[0]?.id || 'info') as string\n  const currentType = calloutTypes.find((t) => t.id === calloutTypeId) || calloutTypes[0]\n  const Icon = currentType?.icon || Info\n  const isEditable = editor.isEditable\n\n  // Detect dark mode\n  const [isDark, setIsDark] = useState(false)\n  useEffect(() => {\n    const checkDarkMode = () => {\n      setIsDark(document.documentElement.classList.contains('dark'))\n    }\n    checkDarkMode()\n\n    const observer = new MutationObserver(checkDarkMode)\n    observer.observe(document.documentElement, { attributes: true, attributeFilter: ['class'] })\n    return () => observer.disconnect()\n  }, [])\n\n  // Compute inline styles for custom colors\n  const wrapperStyle = useMemo(() => {\n    if (!currentType) return {}\n    return {\n      backgroundColor: isDark ? currentType.bgDark : currentType.bgLight,\n      borderColor: isDark ? currentType.borderDark : currentType.borderLight,\n    }\n  }, [currentType, isDark])\n\n  const iconStyle = useMemo(() => {\n    if (!currentType) return {}\n    return {\n      color: isDark ? currentType.iconColorDark : currentType.iconColorLight,\n    }\n  }, [currentType, isDark])\n\n  const setType = (typeId: string) => {\n    updateAttributes({ type: typeId })\n    setShowTypeDropdown(false)\n  }\n\n  const handleToggleDropdown = useCallback(() => {\n    if (!showTypeDropdown && buttonRef.current) {\n      const rect = buttonRef.current.getBoundingClientRect()\n      setDropdownPosition({\n        top: rect.bottom + 4,\n        left: rect.left,\n      })\n    }\n    setShowTypeDropdown(!showTypeDropdown)\n  }, [showTypeDropdown])\n\n  // Close dropdown when clicking outside\n  useEffect(() => {\n    if (!showTypeDropdown) return\n\n    const handleClickOutside = (e: MouseEvent) => {\n      const target = e.target as Node\n      const isInsideButton = buttonRef.current?.contains(target)\n      const isInsideDropdown = dropdownRef.current?.contains(target)\n\n      if (!isInsideButton && !isInsideDropdown) {\n        setShowTypeDropdown(false)\n      }\n    }\n\n    document.addEventListener('mousedown', handleClickOutside)\n    return () => document.removeEventListener('mousedown', handleClickOutside)\n  }, [showTypeDropdown])\n\n  return (\n    <NodeViewWrapper className=\"callout-wrapper\" style={wrapperStyle} data-callout-type={calloutTypeId}>\n      <div className=\"callout-icon-container\" style={iconStyle} contentEditable={false}>\n        {isEditable ? (\n          <div className=\"callout-type-selector\">\n            <button ref={buttonRef} className=\"callout-type-button\" onClick={handleToggleDropdown} type=\"button\">\n              <Icon size={20} />\n              <ChevronDown size={12} className=\"callout-type-chevron\" />\n            </button>\n\n            {showTypeDropdown && (\n              <div\n                ref={dropdownRef}\n                className=\"callout-type-dropdown\"\n                style={{ top: dropdownPosition.top, left: dropdownPosition.left }}\n              >\n                {calloutTypes.map((type) => {\n                  const TypeIcon = type.icon\n                  return (\n                    <button\n                      key={type.id}\n                      className={cn('callout-type-option', type.id === calloutTypeId && 'callout-type-option-active')}\n                      onClick={() => setType(type.id)}\n                      type=\"button\"\n                    >\n                      <TypeIcon size={16} />\n                      <span>{type.label}</span>\n                    </button>\n                  )\n                })}\n              </div>\n            )}\n          </div>\n        ) : (\n          <Icon size={20} />\n        )}\n      </div>\n      <div className=\"callout-content\">\n        <NodeViewContent />\n      </div>\n    </NodeViewWrapper>\n  )\n}\n",
      "type": "registry:component"
    },
    {
      "path": "src/components/ui/editor/toggle.tsx",
      "content": "import { NodeViewWrapper, NodeViewContent, type NodeViewProps } from '@tiptap/react'\nimport { ChevronRight } from 'lucide-react'\nimport { useCallback } from 'react'\nimport { cn } from '@/lib/utils'\n\nexport function ToggleComponent({ node, updateAttributes, editor }: NodeViewProps) {\n  const isOpen = node.attrs.open ?? true\n  const title = node.attrs.title || 'Toggle title'\n  const isEditable = editor.isEditable\n\n  const handleToggle = useCallback(() => {\n    updateAttributes({ open: !isOpen })\n  }, [isOpen, updateAttributes])\n\n  const handleTitleChange = useCallback(\n    (e: React.ChangeEvent<HTMLInputElement>) => {\n      updateAttributes({ title: e.target.value })\n    },\n    [updateAttributes],\n  )\n\n  const handleTitleKeyDown = useCallback(\n    (e: React.KeyboardEvent<HTMLInputElement>) => {\n      // Prevent editor from handling these keys\n      if (e.key === 'Enter') {\n        e.preventDefault()\n        // Open toggle and focus content if pressing Enter\n        if (!isOpen) {\n          updateAttributes({ open: true })\n        }\n      }\n    },\n    [isOpen, updateAttributes],\n  )\n\n  return (\n    <NodeViewWrapper className=\"toggle-wrapper\">\n      <div className=\"toggle-header\" contentEditable={false}>\n        <button\n          className={cn('toggle-button', isOpen && 'toggle-button-open')}\n          onClick={handleToggle}\n          type=\"button\"\n          aria-expanded={isOpen}\n        >\n          <ChevronRight size={16} className=\"toggle-chevron\" />\n        </button>\n        {isEditable ? (\n          <input\n            type=\"text\"\n            className=\"toggle-title-input\"\n            value={title}\n            onChange={handleTitleChange}\n            onKeyDown={handleTitleKeyDown}\n            placeholder=\"Toggle title...\"\n          />\n        ) : (\n          <span className=\"toggle-title\" onClick={handleToggle}>\n            {title}\n          </span>\n        )}\n      </div>\n      <div className={cn('toggle-content', !isOpen && 'toggle-content-collapsed')}>\n        <NodeViewContent className=\"toggle-content-inner\" />\n      </div>\n    </NodeViewWrapper>\n  )\n}\n",
      "type": "registry:component"
    },
    {
      "path": "src/components/ui/editor/file-attachment.tsx",
      "content": "import { useState, useRef, useCallback, useEffect } from 'react'\nimport { NodeViewWrapper, type NodeViewProps } from '@tiptap/react'\nimport {\n  FileText,\n  Image as ImageIcon,\n  File,\n  Trash2,\n  FileArchive,\n  FileCode,\n  FileSpreadsheet,\n  Loader2,\n  type LucideIcon,\n} from 'lucide-react'\nimport { Button } from '@/components/ui/button'\nimport { cn } from '@/lib/utils'\nimport { FilePreviewDialog } from './file-preview-dialog'\nimport { FileAttachmentMenu } from './file-attachment-menu'\nimport type {\n  FileDisplayMode,\n  FileAlignment,\n  FileFetcher,\n  PreviewOptions,\n  FileDeleteHandler,\n} from './extensions/file-attachment'\n\nfunction formatFileSize(bytes: number): string {\n  if (bytes === 0) return '0 B'\n  const k = 1024\n  const sizes = ['B', 'KB', 'MB', 'GB']\n  const i = Math.floor(Math.log(bytes) / Math.log(k))\n  return parseFloat((bytes / Math.pow(k, i)).toFixed(1)) + ' ' + sizes[i]\n}\n\nfunction getFileIconType(mimeType: string): 'image' | 'text' | 'spreadsheet' | 'archive' | 'code' | 'generic' {\n  if (mimeType.startsWith('image/')) {\n    return 'image'\n  }\n  if (mimeType.startsWith('text/') || mimeType.includes('document')) {\n    return 'text'\n  }\n  if (mimeType.includes('spreadsheet') || mimeType.includes('excel') || mimeType === 'text/csv') {\n    return 'spreadsheet'\n  }\n  if (mimeType.includes('zip') || mimeType.includes('archive') || mimeType.includes('compressed')) {\n    return 'archive'\n  }\n  if (mimeType.includes('code') || mimeType.includes('javascript') || mimeType.includes('json')) {\n    return 'code'\n  }\n  return 'generic'\n}\n\nconst iconMap: Record<ReturnType<typeof getFileIconType>, LucideIcon> = {\n  image: ImageIcon,\n  text: FileText,\n  spreadsheet: FileSpreadsheet,\n  archive: FileArchive,\n  code: FileCode,\n  generic: File,\n}\n\nfunction isImageType(mimeType: string): boolean {\n  return mimeType.startsWith('image/')\n}\n\nfunction FileIcon({ mimeType, size, className }: { mimeType: string; size: number; className?: string }) {\n  const iconType = getFileIconType(mimeType)\n  const Icon = iconMap[iconType]\n  return <Icon size={size} className={className} />\n}\n\n// Minimum and maximum dimensions for resizing\nconst MIN_WIDTH = 100\nconst MAX_WIDTH = 1200\n\nexport function FileAttachmentComponent({ node, deleteNode, editor, updateAttributes, selected }: NodeViewProps) {\n  const { src, name, size, mimeType, displayMode, alignment, width, uploading } = node.attrs as {\n    src: string\n    name: string\n    size: number\n    mimeType: string\n    displayMode: FileDisplayMode\n    alignment: FileAlignment\n    width: number | null\n    uploading: boolean\n  }\n  const isEditable = editor.isEditable\n  const isSelected = selected && isEditable\n\n  // Get custom file fetcher, preview options, and delete handler from extension storage\n  const storage = editor.storage as unknown as Record<\n    string,\n    {\n      onFetchFile?: FileFetcher\n      previewOptions?: PreviewOptions\n      onFileDelete?: FileDeleteHandler\n    }\n  >\n  const onFetchFile = storage.fileAttachment?.onFetchFile\n  const previewOptions = storage.fileAttachment?.previewOptions\n  const onFileDelete = storage.fileAttachment?.onFileDelete\n  const isImage = isImageType(mimeType)\n  const [isPreviewOpen, setIsPreviewOpen] = useState(false)\n  const [isMenuOpen, setIsMenuOpen] = useState(false)\n  const [menuPosition, setMenuPosition] = useState({ top: 0, left: 0 })\n  const [isResizing, setIsResizing] = useState(false)\n  const [currentWidth, setCurrentWidth] = useState<number | null>(width)\n  const elementRef = useRef<HTMLElement>(null)\n  const imageRef = useRef<HTMLImageElement>(null)\n  const resizeStartRef = useRef<{ x: number; width: number } | null>(null)\n\n  // Sync currentWidth with props\n  useEffect(() => {\n    setCurrentWidth(width)\n  }, [width])\n\n  const handleDelete = useCallback(\n    (e?: React.MouseEvent) => {\n      e?.stopPropagation()\n      if (uploading) return\n      // Call the delete handler for cleanup (e.g., delete from server)\n      onFileDelete?.(src, name, mimeType)\n      deleteNode()\n    },\n    [deleteNode, onFileDelete, src, name, mimeType, uploading],\n  )\n\n  const handleClick = useCallback(\n    (e: React.MouseEvent) => {\n      e.stopPropagation()\n\n      if (uploading || isResizing) return\n\n      if (!isEditable) {\n        // In view mode, directly open preview\n        setIsPreviewOpen(true)\n        return\n      }\n\n      // In edit mode, show the floating menu\n      const rect = (e.currentTarget as HTMLElement).getBoundingClientRect()\n      setMenuPosition({\n        top: rect.top - 45, // Position above the element\n        left: rect.left + rect.width / 2,\n      })\n      setIsMenuOpen(true)\n    },\n    [isEditable, isResizing, uploading],\n  )\n\n  const handleDoubleClick = useCallback(\n    (e: React.MouseEvent) => {\n      e.stopPropagation()\n      if (uploading || isResizing) return\n      setIsMenuOpen(false)\n      setIsPreviewOpen(true)\n    },\n    [isResizing, uploading],\n  )\n\n  const handleMenuClose = useCallback(() => {\n    setIsMenuOpen(false)\n  }, [])\n\n  const handlePreview = useCallback(() => {\n    setIsMenuOpen(false)\n    setIsPreviewOpen(true)\n  }, [])\n\n  // Resize handlers for images\n  const handleResizeStart = useCallback(\n    (e: React.MouseEvent) => {\n      if (!isEditable || !isImage || uploading) return\n      e.preventDefault()\n      e.stopPropagation()\n\n      const currentElement = imageRef.current || elementRef.current\n      if (!currentElement) return\n\n      const rect = currentElement.getBoundingClientRect()\n      resizeStartRef.current = {\n        x: e.clientX,\n        width: rect.width,\n      }\n      setIsResizing(true)\n    },\n    [isEditable, isImage, uploading],\n  )\n\n  const handleResizeMove = useCallback((e: MouseEvent) => {\n    if (!resizeStartRef.current) return\n\n    const deltaX = e.clientX - resizeStartRef.current.x\n    const newWidth = Math.max(MIN_WIDTH, Math.min(MAX_WIDTH, resizeStartRef.current.width + deltaX))\n    setCurrentWidth(newWidth)\n  }, [])\n\n  const handleResizeEnd = useCallback(() => {\n    if (resizeStartRef.current && currentWidth) {\n      updateAttributes({ width: Math.round(currentWidth) })\n    }\n    resizeStartRef.current = null\n    setIsResizing(false)\n  }, [currentWidth, updateAttributes])\n\n  // Add/remove resize event listeners\n  useEffect(() => {\n    if (isResizing) {\n      // Add cursor style to body for smooth resize experience\n      document.body.style.cursor = 'se-resize'\n      document.body.style.userSelect = 'none'\n\n      window.addEventListener('mousemove', handleResizeMove)\n      window.addEventListener('mouseup', handleResizeEnd)\n      return () => {\n        document.body.style.cursor = ''\n        document.body.style.userSelect = ''\n        window.removeEventListener('mousemove', handleResizeMove)\n        window.removeEventListener('mouseup', handleResizeEnd)\n      }\n    }\n  }, [isResizing, handleResizeMove, handleResizeEnd])\n\n  // Calculate width style for images\n  const getWidthStyle = () => {\n    if (!isImage) return {}\n    if (currentWidth) return { width: `${currentWidth}px`, maxWidth: '100%' }\n    return { maxWidth: '100%' }\n  }\n\n  // Image display (block mode) - show image directly\n  if (isImage && displayMode === 'block') {\n    return (\n      <NodeViewWrapper\n        className={cn(\n          'file-attachment-image-wrapper',\n          alignment === 'center' && 'flex justify-center',\n          alignment === 'right' && 'flex justify-end',\n        )}\n        ref={elementRef}\n      >\n        <div\n          className={cn(\n            'file-attachment-image-container',\n            'relative inline-block',\n            'group',\n            isResizing && 'select-none',\n            uploading && 'file-attachment-uploading',\n          )}\n          style={getWidthStyle()}\n        >\n          {uploading ? (\n            <div\n              className={cn(\n                'rounded-lg bg-muted flex flex-col items-center justify-center gap-2',\n                'border border-dashed border-border',\n              )}\n              style={{ width: currentWidth ?? 300, height: (currentWidth ?? 300) * 0.56, maxWidth: '100%' }}\n            >\n              <Loader2 className=\"h-6 w-6 animate-spin text-muted-foreground\" />\n              <span className=\"text-xs text-muted-foreground truncate max-w-[200px] px-2\">{name}</span>\n              <span className=\"text-[11px] text-muted-foreground/60\">Uploading...</span>\n            </div>\n          ) : (\n            <>\n              <img\n                ref={imageRef}\n                src={src}\n                alt={name}\n                onClick={handleClick}\n                onDoubleClick={handleDoubleClick}\n                className={cn(\n                  'file-attachment-image',\n                  'rounded-lg cursor-pointer',\n                  'transition-all duration-150',\n                  isEditable && 'hover:shadow-lg',\n                  isMenuOpen && 'ring-2 ring-primary ring-offset-2',\n                  isSelected && 'ring-2 ring-primary ring-offset-2 shadow-lg',\n                )}\n                style={{ width: '100%', height: 'auto' }}\n                title={isEditable ? 'Click for options, double-click to preview' : `Click to view: ${name}`}\n                draggable={false}\n              />\n\n              {/* Resize handle */}\n              {isEditable && (\n                <div\n                  className={cn(\n                    'image-resize-handle',\n                    'absolute -bottom-2 -right-2 w-6 h-6',\n                    'cursor-se-resize',\n                    'opacity-0 group-hover:opacity-100',\n                    'transition-opacity',\n                    'flex items-center justify-center',\n                    isResizing && 'image-resize-handle-active opacity-100',\n                  )}\n                  onMouseDown={handleResizeStart}\n                  title=\"Drag to resize\"\n                >\n                  <div className=\"image-resize-handle-inner\" />\n                </div>\n              )}\n\n              {/* Quick delete button */}\n              {isEditable && !isMenuOpen && (\n                <Button\n                  variant=\"secondary\"\n                  size=\"icon-xs\"\n                  onClick={handleDelete}\n                  title=\"Delete\"\n                  className={cn(\n                    'absolute top-2 right-2',\n                    'opacity-0 group-hover:opacity-100',\n                    'transition-opacity',\n                    'bg-background/80 backdrop-blur-sm',\n                    'hover:bg-destructive hover:text-destructive-foreground',\n                  )}\n                >\n                  <Trash2 size={14} />\n                </Button>\n              )}\n            </>\n          )}\n        </div>\n\n        {!uploading && (\n          <>\n            <FileAttachmentMenu\n              editor={editor}\n              isOpen={isMenuOpen}\n              onClose={handleMenuClose}\n              position={menuPosition}\n              displayMode={displayMode}\n              alignment={alignment}\n              width={currentWidth}\n              isImage={isImage}\n              onPreview={handlePreview}\n              onDelete={handleDelete}\n              updateAttributes={updateAttributes}\n            />\n\n            <FilePreviewDialog\n              isOpen={isPreviewOpen}\n              onClose={() => setIsPreviewOpen(false)}\n              src={src}\n              name={name}\n              size={size}\n              mimeType={mimeType}\n              onFetchFile={onFetchFile}\n              previewOptions={previewOptions}\n            />\n          </>\n        )}\n      </NodeViewWrapper>\n    )\n  }\n\n  // Inline mode for all files (including images)\n  if (displayMode === 'inline') {\n    return (\n      <NodeViewWrapper as=\"span\" className=\"file-attachment-inline-wrapper\" ref={elementRef}>\n        <span\n          onClick={handleClick}\n          onDoubleClick={handleDoubleClick}\n          className={cn(\n            'file-attachment-inline',\n            'inline-flex items-center gap-1.5 px-2 py-0.5 rounded-md',\n            'bg-muted text-sm font-medium',\n            'border border-border',\n            'transition-all duration-150',\n            'select-none',\n            'align-middle',\n            uploading\n              ? 'file-attachment-uploading border-dashed cursor-default'\n              : cn(\n                  'cursor-pointer',\n                  isEditable ? 'hover:bg-accent hover:border-primary/30' : 'hover:bg-accent',\n                  isMenuOpen && 'bg-accent border-primary/50',\n                  isSelected && 'ring-2 ring-primary ring-offset-1 bg-accent border-primary/50',\n                ),\n          )}\n          title={\n            uploading\n              ? `Uploading ${name}...`\n              : isEditable\n                ? 'Click for options, double-click to preview'\n                : `Click to preview: ${name}`\n          }\n        >\n          {uploading ? (\n            <Loader2 size={14} className=\"animate-spin text-muted-foreground shrink-0\" />\n          ) : isImage ? (\n            <img src={src} alt={name} className=\"w-4 h-4 rounded object-cover shrink-0\" />\n          ) : (\n            <FileIcon mimeType={mimeType} size={14} className=\"text-muted-foreground shrink-0\" />\n          )}\n          <span className=\"truncate max-w-[150px]\">{name}</span>\n          <span className=\"text-muted-foreground text-xs\">\n            {uploading ? 'Uploading...' : `(${formatFileSize(size)})`}\n          </span>\n          {isEditable && !isMenuOpen && !uploading && (\n            <Button\n              variant=\"ghost\"\n              size=\"icon-xs\"\n              onClick={handleDelete}\n              title=\"Delete\"\n              className=\"h-5 w-5 ml-0.5 text-muted-foreground hover:text-destructive\"\n            >\n              <Trash2 size={12} />\n            </Button>\n          )}\n        </span>\n\n        {!uploading && (\n          <>\n            <FileAttachmentMenu\n              editor={editor}\n              isOpen={isMenuOpen}\n              onClose={handleMenuClose}\n              position={menuPosition}\n              displayMode={displayMode}\n              alignment={alignment}\n              width={width}\n              isImage={isImage}\n              onPreview={handlePreview}\n              onDelete={handleDelete}\n              updateAttributes={updateAttributes}\n            />\n\n            <FilePreviewDialog\n              isOpen={isPreviewOpen}\n              onClose={() => setIsPreviewOpen(false)}\n              src={src}\n              name={name}\n              size={size}\n              mimeType={mimeType}\n              onFetchFile={onFetchFile}\n              previewOptions={previewOptions}\n            />\n          </>\n        )}\n      </NodeViewWrapper>\n    )\n  }\n\n  // Block/Card mode for non-images\n  return (\n    <NodeViewWrapper\n      className={cn(\n        'file-attachment-block-wrapper',\n        alignment === 'center' && 'flex justify-center',\n        alignment === 'right' && 'flex justify-end',\n      )}\n      data-drag-handle={!uploading ? '' : undefined}\n      ref={elementRef}\n    >\n      <div\n        onClick={handleClick}\n        onDoubleClick={handleDoubleClick}\n        className={cn(\n          'file-attachment-block',\n          'flex items-center gap-3 p-3 rounded-lg',\n          'bg-muted/50 border border-border',\n          'transition-all duration-150',\n          'select-none',\n          uploading\n            ? 'file-attachment-uploading border-dashed cursor-default'\n            : cn(\n                'cursor-pointer',\n                isEditable ? 'hover:bg-muted hover:border-primary/30 hover:shadow-sm' : 'hover:bg-muted',\n                isMenuOpen && 'bg-muted border-primary/50 shadow-sm',\n                isSelected && 'ring-2 ring-primary ring-offset-2 bg-muted border-primary/50 shadow-sm',\n              ),\n        )}\n        style={{ maxWidth: '400px' }}\n        title={\n          uploading\n            ? `Uploading ${name}...`\n            : isEditable\n              ? 'Click for options, double-click to preview'\n              : `Click to preview: ${name}`\n        }\n      >\n        {/* Icon */}\n        <div className=\"w-14 h-14 rounded-md bg-primary/10 flex items-center justify-center shrink-0\">\n          {uploading ? (\n            <Loader2 size={28} className=\"animate-spin text-primary\" />\n          ) : (\n            <FileIcon mimeType={mimeType} size={28} className=\"text-primary\" />\n          )}\n        </div>\n\n        {/* File Info */}\n        <div className=\"flex-1 min-w-0\">\n          <div className=\"font-medium text-sm truncate\" title={name}>\n            {name}\n          </div>\n          <div className=\"text-xs text-muted-foreground mt-0.5\">\n            {uploading ? 'Uploading...' : formatFileSize(size)}\n          </div>\n          <div className=\"text-xs text-muted-foreground/70 truncate\">{mimeType || 'Unknown type'}</div>\n        </div>\n\n        {/* Delete Action */}\n        {isEditable && !isMenuOpen && !uploading && (\n          <div className=\"shrink-0\">\n            <Button\n              variant=\"ghost\"\n              size=\"icon-sm\"\n              onClick={handleDelete}\n              title=\"Delete\"\n              className=\"text-muted-foreground hover:text-destructive hover:bg-destructive/10\"\n            >\n              <Trash2 size={16} />\n            </Button>\n          </div>\n        )}\n      </div>\n\n      {!uploading && (\n        <>\n          <FileAttachmentMenu\n            editor={editor}\n            isOpen={isMenuOpen}\n            onClose={handleMenuClose}\n            position={menuPosition}\n            displayMode={displayMode}\n            alignment={alignment}\n            width={width}\n            isImage={isImage}\n            onPreview={handlePreview}\n            onDelete={handleDelete}\n            updateAttributes={updateAttributes}\n          />\n\n          <FilePreviewDialog\n            isOpen={isPreviewOpen}\n            onClose={() => setIsPreviewOpen(false)}\n            src={src}\n            name={name}\n            size={size}\n            mimeType={mimeType}\n          />\n        </>\n      )}\n    </NodeViewWrapper>\n  )\n}\n",
      "type": "registry:component"
    },
    {
      "path": "src/components/ui/editor/file-attachment-menu.tsx",
      "content": "import { useEffect, useRef, useCallback } from 'react'\nimport { createPortal } from 'react-dom'\nimport type { Editor } from '@tiptap/react'\nimport { AlignLeft, AlignCenter, AlignRight, LayoutList, CreditCard, Maximize2, Eye, Trash2 } from 'lucide-react'\nimport { Button } from '@/components/ui/button'\nimport { cn } from '@/lib/utils'\nimport type { FileDisplayMode, FileAlignment } from './extensions/file-attachment'\n\nexport interface FileAttachmentMenuProps {\n  editor: Editor\n  isOpen: boolean\n  onClose: () => void\n  position: { top: number; left: number }\n  displayMode: FileDisplayMode\n  alignment: FileAlignment\n  width: number | null\n  isImage: boolean\n  onPreview: () => void\n  onDelete: () => void\n  updateAttributes: (attrs: Record<string, unknown>) => void\n}\n\nconst IMAGE_SIZES = [\n  { label: 'S', width: 200 },\n  { label: 'M', width: 400 },\n  { label: 'L', width: 600 },\n  { label: 'Full', width: null },\n]\n\nexport function FileAttachmentMenu({\n  editor,\n  isOpen,\n  onClose,\n  position,\n  displayMode,\n  alignment,\n  width,\n  isImage,\n  onPreview,\n  onDelete,\n  updateAttributes,\n}: FileAttachmentMenuProps) {\n  const menuRef = useRef<HTMLDivElement>(null)\n\n  // Handle click outside\n  useEffect(() => {\n    if (!isOpen) return\n\n    const handleClickOutside = (e: MouseEvent) => {\n      if (menuRef.current && !menuRef.current.contains(e.target as Node)) {\n        onClose()\n      }\n    }\n\n    const handleKeyDown = (e: KeyboardEvent) => {\n      if (e.key === 'Escape') {\n        onClose()\n      }\n    }\n\n    // Delay adding listener to avoid immediate close\n    const timeoutId = setTimeout(() => {\n      document.addEventListener('mousedown', handleClickOutside)\n      document.addEventListener('keydown', handleKeyDown)\n    }, 0)\n\n    return () => {\n      clearTimeout(timeoutId)\n      document.removeEventListener('mousedown', handleClickOutside)\n      document.removeEventListener('keydown', handleKeyDown)\n    }\n  }, [isOpen, onClose])\n\n  const handleDisplayModeChange = useCallback(\n    (mode: FileDisplayMode) => {\n      updateAttributes({ displayMode: mode })\n    },\n    [updateAttributes],\n  )\n\n  const handleAlignmentChange = useCallback(\n    (align: FileAlignment) => {\n      updateAttributes({ alignment: align })\n    },\n    [updateAttributes],\n  )\n\n  const handleWidthChange = useCallback(\n    (newWidth: number | null) => {\n      updateAttributes({ width: newWidth })\n    },\n    [updateAttributes],\n  )\n\n  if (!isOpen || !editor.isEditable) return null\n\n  return createPortal(\n    <div\n      ref={menuRef}\n      className={cn(\n        'file-attachment-menu',\n        'fixed z-50',\n        'bg-popover border border-border rounded-lg shadow-lg',\n        'p-1.5',\n        'animate-in fade-in zoom-in-95 duration-150',\n      )}\n      style={{\n        top: position.top,\n        left: position.left,\n        transform: 'translateX(-50%)',\n      }}\n      onMouseDown={(e) => e.stopPropagation()}\n    >\n      <div className=\"flex items-center gap-0.5\">\n        {/* Display Mode Toggle */}\n        <div className=\"flex items-center border-r border-border pr-1.5 mr-1\">\n          <Button\n            variant={displayMode === 'inline' ? 'default' : 'ghost'}\n            size=\"icon-xs\"\n            onClick={() => handleDisplayModeChange('inline')}\n            title=\"Inline view\"\n            className={cn('h-7 w-7', displayMode === 'inline' && 'bg-primary text-primary-foreground')}\n          >\n            <LayoutList size={14} />\n          </Button>\n          <Button\n            variant={displayMode === 'block' ? 'default' : 'ghost'}\n            size=\"icon-xs\"\n            onClick={() => handleDisplayModeChange('block')}\n            title=\"Card view\"\n            className={cn('h-7 w-7', displayMode === 'block' && 'bg-primary text-primary-foreground')}\n          >\n            <CreditCard size={14} />\n          </Button>\n        </div>\n\n        {/* Image-specific options */}\n        {isImage && displayMode === 'block' && (\n          <>\n            {/* Alignment */}\n            <div className=\"flex items-center border-r border-border pr-1.5 mr-1\">\n              <Button\n                variant={alignment === 'left' ? 'default' : 'ghost'}\n                size=\"icon-xs\"\n                onClick={() => handleAlignmentChange('left')}\n                title=\"Align left\"\n                className={cn('h-7 w-7', alignment === 'left' && 'bg-primary text-primary-foreground')}\n              >\n                <AlignLeft size={14} />\n              </Button>\n              <Button\n                variant={alignment === 'center' ? 'default' : 'ghost'}\n                size=\"icon-xs\"\n                onClick={() => handleAlignmentChange('center')}\n                title=\"Align center\"\n                className={cn('h-7 w-7', alignment === 'center' && 'bg-primary text-primary-foreground')}\n              >\n                <AlignCenter size={14} />\n              </Button>\n              <Button\n                variant={alignment === 'right' ? 'default' : 'ghost'}\n                size=\"icon-xs\"\n                onClick={() => handleAlignmentChange('right')}\n                title=\"Align right\"\n                className={cn('h-7 w-7', alignment === 'right' && 'bg-primary text-primary-foreground')}\n              >\n                <AlignRight size={14} />\n              </Button>\n            </div>\n\n            {/* Size Options */}\n            <div className=\"flex items-center border-r border-border pr-1.5 mr-1 gap-0.5\">\n              {IMAGE_SIZES.map((size) => (\n                <Button\n                  key={size.label}\n                  variant={width === size.width ? 'default' : 'ghost'}\n                  size=\"icon-xs\"\n                  onClick={() => handleWidthChange(size.width)}\n                  title={size.width ? `${size.width}px` : 'Full width'}\n                  className={cn(\n                    'h-7 w-7 text-xs font-medium',\n                    width === size.width && 'bg-primary text-primary-foreground',\n                  )}\n                >\n                  {size.label === 'Full' ? <Maximize2 size={14} /> : size.label}\n                </Button>\n              ))}\n            </div>\n          </>\n        )}\n\n        {/* Actions */}\n        <div className=\"flex items-center gap-0.5\">\n          <Button variant=\"ghost\" size=\"icon-xs\" onClick={onPreview} title=\"Preview\" className=\"h-7 w-7\">\n            <Eye size={14} />\n          </Button>\n          <Button\n            variant=\"ghost\"\n            size=\"icon-xs\"\n            onClick={onDelete}\n            title=\"Delete\"\n            className=\"h-7 w-7 text-destructive hover:text-destructive hover:bg-destructive/10\"\n          >\n            <Trash2 size={14} />\n          </Button>\n        </div>\n      </div>\n    </div>,\n    document.body,\n  )\n}\n",
      "type": "registry:component"
    },
    {
      "path": "src/components/ui/editor/file-preview-dialog.tsx",
      "content": "import { useState, useEffect, useCallback, useMemo, useRef } from 'react'\nimport { createPortal } from 'react-dom'\nimport {\n  X,\n  Download,\n  FileText,\n  File,\n  FileArchive,\n  FileCode,\n  FileSpreadsheet,\n  Image as ImageIcon,\n  AlertCircle,\n  Loader2,\n  ZoomIn,\n  ZoomOut,\n  RotateCw,\n  RefreshCw,\n  ChevronLeft,\n  ChevronRight,\n  Video,\n  type LucideIcon,\n} from 'lucide-react'\nimport { Button } from '@/components/ui/button'\nimport { cn } from '@/lib/utils'\nimport { useVirtualizer } from '@tanstack/react-virtual'\nimport { Document, Page, pdfjs } from 'react-pdf'\nimport 'react-pdf/dist/Page/AnnotationLayer.css'\nimport 'react-pdf/dist/Page/TextLayer.css'\n\n\n// Set up PDF.js worker\npdfjs.GlobalWorkerOptions.workerSrc = `//unpkg.com/pdfjs-dist@${pdfjs.version}/build/pdf.worker.min.mjs`\n\n// ============================================\n// Preview Options Types\n// ============================================\n\nexport type FileFetcher = (src: string, mimeType: string) => Promise<string | Blob>\n\nexport interface CsvPreviewOptions {\n  showRowNumbers?: boolean\n  headerRow?: boolean\n  delimiter?: ',' | ';' | '\\t' | '|' | 'auto'\n  stripWhitespace?: boolean\n  emptyValuePlaceholder?: string\n  wrapText?: boolean\n  alternateRowColors?: boolean\n  formatCell?: (value: string, rowIndex: number, colIndex: number, header: string) => string\n  highlightColumns?: (number | string)[]\n}\n\nexport interface TextPreviewOptions {\n  showLineNumbers?: boolean\n  wordWrap?: boolean\n  fontSize?: number\n  tabSize?: number\n}\n\nexport interface ImagePreviewOptions {\n  maxWidth?: number\n  maxHeight?: number\n  allowZoom?: boolean\n  showMetadata?: boolean\n  transparentBackground?: 'checkerboard' | 'white' | 'black' | 'none'\n}\n\nexport interface PdfPreviewOptions {\n  showPageControls?: boolean\n}\n\nexport interface PreviewOptions {\n  csv?: CsvPreviewOptions\n  text?: TextPreviewOptions\n  image?: ImagePreviewOptions\n  pdf?: PdfPreviewOptions\n}\n\nexport interface FilePreviewDialogProps {\n  isOpen: boolean\n  onClose: () => void\n  src: string\n  name: string\n  size: number\n  mimeType: string\n  onFetchFile?: FileFetcher\n  previewOptions?: PreviewOptions\n}\n\n// ============================================\n// Default Options\n// ============================================\n\nconst DEFAULT_CSV_OPTIONS: Required<Omit<CsvPreviewOptions, 'formatCell' | 'highlightColumns'>> = {\n  showRowNumbers: true,\n  headerRow: true,\n  delimiter: 'auto',\n  stripWhitespace: true,\n  emptyValuePlaceholder: '',\n  wrapText: false,\n  alternateRowColors: true,\n}\n\nconst DEFAULT_TEXT_OPTIONS: Required<TextPreviewOptions> = {\n  showLineNumbers: true,\n  wordWrap: false,\n  fontSize: 13,\n  tabSize: 2,\n}\n\nconst DEFAULT_IMAGE_OPTIONS: Required<ImagePreviewOptions> = {\n  maxWidth: 0,\n  maxHeight: 0,\n  allowZoom: true,\n  showMetadata: true,\n  transparentBackground: 'checkerboard',\n}\n\n// ============================================\n// Utility Functions\n// ============================================\n\nfunction formatFileSize(bytes: number): string {\n  if (bytes === 0) return '0 B'\n  const k = 1024\n  const sizes = ['B', 'KB', 'MB', 'GB']\n  const i = Math.floor(Math.log(bytes) / Math.log(k))\n  return parseFloat((bytes / Math.pow(k, i)).toFixed(1)) + ' ' + sizes[i]\n}\n\nfunction getFileIconType(\n  mimeType: string,\n): 'image' | 'video' | 'text' | 'spreadsheet' | 'archive' | 'code' | 'generic' {\n  if (mimeType.startsWith('image/')) return 'image'\n  if (mimeType.startsWith('video/')) return 'video'\n  if (mimeType.startsWith('text/') || mimeType.includes('document')) return 'text'\n  if (mimeType.includes('spreadsheet') || mimeType.includes('excel') || mimeType === 'text/csv') return 'spreadsheet'\n  if (mimeType.includes('zip') || mimeType.includes('archive') || mimeType.includes('compressed')) return 'archive'\n  if (mimeType.includes('code') || mimeType.includes('javascript') || mimeType.includes('json')) return 'code'\n  return 'generic'\n}\n\nconst iconMap: Record<ReturnType<typeof getFileIconType>, LucideIcon> = {\n  image: ImageIcon,\n  video: Video,\n  text: FileText,\n  spreadsheet: FileSpreadsheet,\n  archive: FileArchive,\n  code: FileCode,\n  generic: File,\n}\n\nfunction canPreview(mimeType: string): boolean {\n  if (mimeType.startsWith('image/')) return true\n  if (mimeType.startsWith('video/')) return true\n  if (mimeType.startsWith('text/')) return true\n  if (mimeType === 'application/json') return true\n  if (mimeType === 'text/csv' || mimeType === 'application/csv') return true\n  if (mimeType === 'application/pdf') return true\n  return false\n}\n\nfunction isTextBased(mimeType: string): boolean {\n  return (\n    mimeType.startsWith('text/') ||\n    mimeType === 'application/json' ||\n    mimeType === 'application/xml' ||\n    mimeType === 'application/javascript'\n  )\n}\n\nfunction isCsv(mimeType: string, name: string): boolean {\n  return mimeType === 'text/csv' || mimeType === 'application/csv' || name.toLowerCase().endsWith('.csv')\n}\n\nfunction isJson(mimeType: string, name: string): boolean {\n  return mimeType === 'application/json' || name.toLowerCase().endsWith('.json')\n}\n\nfunction detectDelimiter(content: string): ',' | ';' | '\\t' | '|' {\n  const firstLines = content.split('\\n').slice(0, 5).join('\\n')\n  const counts = {\n    ',': (firstLines.match(/,/g) || []).length,\n    ';': (firstLines.match(/;/g) || []).length,\n    '\\t': (firstLines.match(/\\t/g) || []).length,\n    '|': (firstLines.match(/\\|/g) || []).length,\n  }\n\n  const max = Math.max(...Object.values(counts))\n  if (max === 0) return ','\n\n  for (const [delim, count] of Object.entries(counts)) {\n    if (count === max) return delim as ',' | ';' | '\\t' | '|'\n  }\n  return ','\n}\n\n// Max rows to parse for large CSVs to avoid memory issues\nconst CSV_MAX_ROWS = 100_000\n\nfunction parseCSV(text: string, delimiter: string, stripWhitespace: boolean): { data: string[][]; truncated: boolean; totalLines: number } {\n  const lines = text.split('\\n').filter(line => line.trim())\n  const totalLines = lines.length\n  const truncated = totalLines > CSV_MAX_ROWS\n  const linesToParse = truncated ? lines.slice(0, CSV_MAX_ROWS) : lines\n\n  const data = linesToParse.map(line => {\n    const result: string[] = []\n    let current = ''\n    let inQuotes = false\n\n    for (let i = 0; i < line.length; i++) {\n      const char = line[i]\n      if (char === '\"') {\n        inQuotes = !inQuotes\n      } else if (char === delimiter && !inQuotes) {\n        result.push(stripWhitespace ? current.trim() : current)\n        current = ''\n      } else {\n        current += char\n      }\n    }\n    result.push(stripWhitespace ? current.trim() : current)\n    return result\n  })\n\n  return { data, truncated, totalLines }\n}\n\n// ============================================\n// Download Progress State\n// ============================================\n\ninterface DownloadProgress {\n  loaded: number\n  total: number | null\n  percentage: number\n}\n\n// ============================================\n// CSV Viewer Component with Virtualization\n// ============================================\n\ninterface CsvViewerProps {\n  content: string\n  options?: CsvPreviewOptions\n}\n\nfunction CsvViewer({ content, options }: CsvViewerProps) {\n  const opts = { ...DEFAULT_CSV_OPTIONS, ...options }\n  const [hasHeader, setHasHeader] = useState(opts.headerRow)\n  const parentRef = useRef<HTMLDivElement>(null)\n\n  const delimiter = opts.delimiter === 'auto' ? detectDelimiter(content) : opts.delimiter\n  const parsed = useMemo(\n    () => parseCSV(content, delimiter, opts.stripWhitespace),\n    [content, delimiter, opts.stripWhitespace],\n  )\n  const { data, truncated, totalLines } = parsed\n\n  const headers = useMemo(() => {\n    if (data.length === 0) return []\n    return hasHeader ? data[0] : data[0].map((_, i) => `Column ${i + 1}`)\n  }, [data, hasHeader])\n\n  const rows = useMemo(() => {\n    if (data.length === 0) return []\n    return hasHeader ? data.slice(1) : data\n  }, [data, hasHeader])\n\n  const highlightIndices = useMemo(() => {\n    if (!opts.highlightColumns || !headers.length) return new Set<number>()\n    return new Set(\n      opts.highlightColumns\n        .map((col) => {\n          if (typeof col === 'number') return col\n          return headers.indexOf(col)\n        })\n        .filter((i) => i >= 0),\n    )\n  }, [opts.highlightColumns, headers])\n\n  // Calculate column widths based on content\n  const columnWidths = useMemo(;() => {\n    if (data.length === 0) return []\n    // Use reduce instead of Math.max(...spread) to avoid call stack overflow on large datasets\n    const maxCols = data.reduce((max, row) => Math.max(max, row.length), 0)\n    const widths: number[] = []\n\n    for (let col = 0; col < maxCols; col++) {\n      let maxWidth = headers[col]?.length || 10\n      // Sample first 100 rows for performance\n      const sampleRows = rows.slice(0, 100)\n      for (const row of sampleRows) {\n        const cellLength = row[col]?.length || 0\n        maxWidth = Math.max(maxWidth, cellLength)\n      }\n      // Clamp between 60px and 400px, roughly 8px per character\n      widths.push(Math.min(400, Math.max(60, maxWidth * 8 + 24)))\n    }\n    return widths\n  }, [data, headers, rows])\n\n  const totalWidth = useMemo(() => {\n    return (opts.showRowNumbers ? 56 : 0) + columnWidths.reduce((sum, w) => sum + w, 0)\n  }, [columnWidths, opts.showRowNumbers])\n\n  const rowVirtualizer = useVirtualizer({\n    count: rows.length,\n    getScrollElement: () => parentRef.current,\n    estimateSize: () => 32,\n    overscan: 20,\n  })\n\n  if (data.length === 0) {\n    return <div className=\"flex items-center justify-center h-full text-muted-foreground\">No data in CSV file</div>\n  }\n\n  const formatCellValue = (value: string, rowIdx: number, colIdx: number): string => {\n    if (opts.formatCell) {\n      return opts.formatCell(value, rowIdx, colIdx, headers[colIdx] || '')\n    }\n    return value\n  }\n\n  return (\n    <div className=\"h-full flex flex-col overflow-hidden\">\n      {/* Truncation warning */}\n      {truncated && (\n        <div className=\"px-4 py-1.5 border-b border-border bg-amber-500/10 text-amber-700 dark:text-amber-400 text-xs text-center shrink-0\">\n          Showing first {CSV_MAX_ROWS.toLocaleString()} of {totalLines.toLocaleString()} rows. Download the file to view\n          all data.\n        </div>\n      )}\n\n      {/* Toolbar */}\n      <div className=\"flex items-center justify-between px-4 py-2 border-b border-border bg-muted/30 shrink-0\">\n        <div className=\"flex items-center gap-3\">\n          <span className=\"text-xs text-muted-foreground\">\n            {rows.length.toLocaleString()} rows  {headers.length} columns\n          </span>\n        </div>\n        <label className=\"flex items-center gap-2 text-sm cursor-pointer\">\n          <input\n            type=\"checkbox\"\n            checked={hasHeader}\n            onChange={(e) => setHasHeader(e.target.checked)}\n            className=\"rounded border-muted-foreground/30\"\n          />\n          <span className=\"text-xs text-muted-foreground\">First row is header</span>\n        </label>\n      </div>\n\n      {/* Virtualized Table */}\n      <div ref={parentRef} className=\"flex-1 overflow-auto\" style={{ minHeight: 0 }}>\n        <div style={{ width: totalWidth, minWidth: '100%' }}>\n          {/* Sticky Header */}\n          <div className=\"sticky top-0 z-20 flex bg-muted border-b border-border\" style={{ width: totalWidth }}>\n            {opts.showRowNumbers && (\n              <div className=\"sticky left-0 z-30 flex-shrink-0 w-14 px-3 py-2 text-left text-xs font-semibold text-muted-foreground border-r border-border bg-muted\">\n                #\n              </div>\n            )}\n            {headers.map((header, i) => (\n              <div\n                key={i}\n                className={cn(\n                  'flex-shrink-0 px-3 py-2 text-left text-xs font-semibold border-r border-border last:border-r-0 bg-muted truncate',\n                  highlightIndices.has(i) && 'bg-primary/10',\n                )}\n                style={{ width: columnWidths[i] }}\n                title={header}\n              >\n                {header || <span className=\"text-muted-foreground italic\">empty</span>}\n              </div>\n            ))}\n          </div>\n\n          {/* Virtual Rows */}\n          <div\n            style={{\n              height: `${rowVirtualizer.getTotalSize()}px`,\n              position: 'relative',\n            }}\n          >\n            {rowVirtualizer.getVirtualItems().map((virtualRow) => {\n              const row = rows[virtualRow.index]\n              return (\n                <div\n                  key={virtualRow.index}\n                  className={cn(\n                    'absolute left-0 w-full flex border-b border-border hover:bg-muted/50',\n                    opts.alternateRowColors && virtualRow.index % 2 === 1 && 'bg-muted/20',\n                  )}\n                  style={{\n                    height: `${virtualRow.size}px`,\n                    transform: `translateY(${virtualRow.start}px)`,\n                  }}\n                >\n                  {/* Sticky Row Number */}\n                  {opts.showRowNumbers && (\n                    <div className=\"sticky left-0 z-10 flex-shrink-0 w-14 px-3 py-1.5 text-xs text-muted-foreground border-r border-border font-mono bg-background flex items-center\">\n                      {virtualRow.index + 1}\n                    </div>\n                  )}\n                  {/* Cells */}\n                  {headers.map((_, cellIdx) => {\n                    const value = row[cellIdx] || ''\n                    const formattedValue = formatCellValue(value, virtualRow.index, cellIdx)\n                    return (\n                      <div\n                        key={cellIdx}\n                        className={cn(\n                          'flex-shrink-0 px-3 py-1.5 text-sm border-r border-border last:border-r-0 truncate flex items-center',\n                          highlightIndices.has(cellIdx) && 'bg-primary/5',\n                        )}\n                        style={{ width: columnWidths[cellIdx] }}\n                        title={value}\n                      >\n                        {formattedValue || (\n                          <span className=\"text-muted-foreground/50 italic\">\n                            {opts.emptyValuePlaceholder || 'empty'}\n                          </span>\n                        )}\n                      </div>\n                    )\n                  })}\n                </div>\n              )\n            })}\n          </div>\n        </div>\n      </div>\n    </div>\n  )\n}\n\n// ============================================\n// JSON Viewer Component with Virtualization\n// ============================================\n\ninterface JsonViewerProps {\n  content: string\n  options?: TextPreviewOptions\n}\n\nfunction JsonViewer({ content, options }: JsonViewerProps) {\n  const opts = { ...DEFAULT_TEXT_OPTIONS, ...options }\n  const parentRef = useRef<HTMLDivElement>(null)\n  const [error, setError] = useState<string | null>(null)\n\n  const lines = useMemo(() => {\n    try {\n      const parsed = JSON.parse(content)\n      const formatted = JSON.stringify(parsed, null, opts.tabSize)\n      setError(null)\n      return formatted.split('\\n')\n    } catch {\n      setError('Invalid JSON format')\n      return content.split('\\n')\n    }\n  }, [content, opts.tabSize])\n\n  const lineNumberWidth = useMemo(() => {\n    const digits = String(lines.length).length\n    return Math.max(40, digits * 10 + 16)\n  }, [lines.length])\n\n  const rowVirtualizer = useVirtualizer({\n    count: lines.length,\n    getScrollElement: () => parentRef.current,\n    estimateSize: () => 20,\n    overscan: 30,\n  })\n\n  return (\n    <div className=\"h-full flex flex-col overflow-hidden\">\n      {/* Toolbar */}\n      <div className=\"flex items-center justify-between px-4 py-2 border-b border-border bg-muted/30 shrink-0\">\n        <div className=\"flex items-center gap-2\">\n          {error ? (\n            <span className=\"text-xs text-destructive\">{error}</span>\n          ) : (\n            <span className=\"text-xs text-green-600 dark:text-green-400\">Valid JSON</span>\n          )}\n          <span className=\"text-xs text-muted-foreground\">{lines.length.toLocaleString()} lines</span>\n        </div>\n      </div>\n\n      {/* Virtualized Content */}\n      <div\n        ref={parentRef}\n        className=\"flex-1 overflow-auto font-mono text-sm bg-muted/20\"\n        style={{ minHeight: 0, fontSize: opts.fontSize }}\n      >\n        <div\n          style={{\n            height: `${rowVirtualizer.getTotalSize()}px`,\n            position: 'relative',\n            width: '100%',\n          }}\n        >\n          {rowVirtualizer.getVirtualItems().map((virtualRow) => {\n            const line = lines[virtualRow.index]\n            return (\n              <div\n                key={virtualRow.index}\n                className=\"absolute left-0 w-full flex hover:bg-muted/50\"\n                style={{\n                  height: `${virtualRow.size}px`,\n                  transform: `translateY(${virtualRow.start}px)`,\n                }}\n              >\n                {/* Line Number */}\n                {opts.showLineNumbers && (\n                  <div\n                    className=\"flex-shrink-0 px-2 text-right text-muted-foreground select-none border-r border-border bg-background sticky left-0 flex items-center justify-end\"\n                    style={{ width: lineNumberWidth }}\n                  >\n                    {virtualRow.index + 1}\n                  </div>\n                )}\n                {/* Line Content */}\n                <div\n                  className={cn(\n                    'flex-1 px-3 overflow-x-auto flex items-center',\n                    opts.wordWrap ? 'whitespace-pre-wrap break-words' : 'whitespace-pre',\n                  )}\n                >\n                  {line || ' '}\n                </div>\n              </div>\n            )\n          })}\n        </div>\n      </div>\n    </div>\n  )\n}\n\n// ============================================\n// Text Viewer Component with Virtualization\n// ============================================\n\ninterface TextViewerProps {\n  content: string\n  fileName: string\n  options?: TextPreviewOptions\n}\n\nfunction TextViewer({ content, fileName, options }: TextViewerProps) {\n  const opts = { ...DEFAULT_TEXT_OPTIONS, ...options }\n  const parentRef = useRef<HTMLDivElement>(null)\n  const lines = useMemo(() => content.split('\\n'), [content])\n  const ext = fileName.split('.').pop()?.toLowerCase() || ''\n\n  const lineNumberWidth = useMemo(() => {\n    const digits = String(lines.length).length\n    return Math.max(40, digits * 10 + 16)\n  }, [lines.length])\n\n  const rowVirtualizer = useVirtualizer({\n    count: lines.length,\n    getScrollElement: () => parentRef.current,\n    estimateSize: () => 24,\n    overscan: 30,\n  })\n\n  return (\n    <div className=\"h-full flex flex-col overflow-hidden\">\n      {/* Toolbar */}\n      <div className=\"flex items-center justify-between px-4 py-2 border-b border-border bg-muted/30 shrink-0\">\n        <span className=\"text-xs text-muted-foreground\">{lines.length.toLocaleString()} lines</span>\n        <span className=\"text-xs text-muted-foreground uppercase\">{ext || 'txt'}</span>\n      </div>\n\n      {/* Virtualized Content */}\n      <div\n        ref={parentRef}\n        className=\"flex-1 overflow-auto font-mono text-sm bg-muted/20\"\n        style={{ minHeight: 0, fontSize: opts.fontSize }}\n      >\n        <div\n          style={{\n            height: `${rowVirtualizer.getTotalSize()}px`,\n            position: 'relative',\n            width: '100%',\n          }}\n        >\n          {rowVirtualizer.getVirtualItems().map((virtualRow) => {\n            const line = lines[virtualRow.index]\n            return (\n              <div\n                key={virtualRow.index}\n                className=\"absolute left-0 w-full flex hover:bg-muted/50\"\n                style={{\n                  height: `${virtualRow.size}px`,\n                  transform: `translateY(${virtualRow.start}px)`,\n                }}\n              >\n                {/* Line Number */}\n                {opts.showLineNumbers && (\n                  <div\n                    className=\"flex-shrink-0 px-2 py-0.5 text-right text-muted-foreground select-none border-r border-border bg-background sticky left-0\"\n                    style={{ width: lineNumberWidth }}\n                  >\n                    {virtualRow.index + 1}\n                  </div>\n                )}\n                {/* Line Content */}\n                <div\n                  className={cn(\n                    'flex-1 px-3 py-0.5 overflow-x-auto',\n                    opts.wordWrap ? 'whitespace-pre-wrap break-words' : 'whitespace-pre',\n                  )}\n                >\n                  {line || ' '}\n                </div>\n              </div>\n            )\n          })}\n        </div>\n      </div>\n    </div>\n  )\n}\n\n// ============================================\n// Image Viewer with Enhanced Controls\n// ============================================\n\ninterface ImageViewerProps {\n  src: string\n  name: string\n  options?: ImagePreviewOptions\n}\n\nfunction ImageViewer({ src, name, options }: ImageViewerProps) {\n  const opts = { ...DEFAULT_IMAGE_OPTIONS, ...options }\n  const [zoom, setZoom] = useState(1)\n  const [rotation, setRotation] = useState(0)\n  const [position, setPosition] = useState({ x: 0, y: 0 })\n  const [isDragging, setIsDragging] = useState(false)\n  const [dragStart, setDragStart] = useState({ x: 0, y: 0 })\n  const [dimensions, setDimensions] = useState<{ width: number; height: number } | null>(null)\n  const containerRef = useRef<HTMLDivElement>(null)\n\n  const handleZoomIn = () => setZoom((prev) => Math.min(prev + 0.25, 5))\n  const handleZoomOut = () => setZoom((prev) => Math.max(prev - 0.25, 0.25))\n  const handleRotate = () => setRotation((prev) => (prev + 90) % 360)\n  const handleReset = () => {\n    setZoom(1)\n    setRotation(0)\n    setPosition({ x: 0, y: 0 })\n  }\n\n  const handleImageLoad = (e: React.SyntheticEvent<HTMLImageElement>) => {\n    const img = e.currentTarget\n    setDimensions({ width: img.naturalWidth, height: img.naturalHeight })\n  }\n\n  const handleMouseDown = (e: React.MouseEvent) => {\n    if (zoom > 1) {\n      setIsDragging(true)\n      setDragStart({ x: e.clientX - position.x, y: e.clientY - position.y })\n    }\n  }\n\n  const handleMouseMove = (e: React.MouseEvent) => {\n    if (isDragging) {\n      setPosition({\n        x: e.clientX - dragStart.x,\n        y: e.clientY - dragStart.y,\n      })\n    }\n  }\n\n  const handleMouseUp = () => setIsDragging(false)\n\n  const handleWheel = useCallback(\n    (e: React.WheelEvent) => {\n      if (!opts.allowZoom) return\n      e.preventDefault()\n      const delta = e.deltaY > 0 ? -0.1 : 0.1\n      setZoom((prev) => Math.max(0.25, Math.min(5, prev + delta)))\n    },\n    [opts.allowZoom],\n  )\n\n  const backgroundClass = useMemo(() => {\n    switch (opts.transparentBackground) {\n      case 'checkerboard':\n        return 'bg-[repeating-conic-gradient(hsl(var(--muted))_0%_25%,transparent_0%_50%)] bg-[length:20px_20px]'\n      case 'white':\n        return 'bg-white'\n      case 'black':\n        return 'bg-black'\n      default:\n        return 'bg-background'\n    }\n  }, [opts.transparentBackground])\n\n  return (\n    <div className=\"h-full flex flex-col\">\n      {/* Controls */}\n      {opts.allowZoom && (\n        <div className=\"flex items-center justify-center gap-2 py-2 bg-background/50 border-b border-border\">\n          <Button variant=\"ghost\" size=\"icon-sm\" onClick={handleZoomOut} title=\"Zoom out\">\n            <ZoomOut className=\"w-4 h-4\" />\n          </Button>\n          <span className=\"text-sm text-muted-foreground min-w-[4rem] text-center font-medium\">\n            {Math.round(zoom * 100)}%\n          </span>\n          <Button variant=\"ghost\" size=\"icon-sm\" onClick={handleZoomIn} title=\"Zoom in\">\n            <ZoomIn className=\"w-4 h-4\" />\n          </Button>\n          <div className=\"w-px h-4 bg-border mx-2\" />\n          <Button variant=\"ghost\" size=\"icon-sm\" onClick={handleRotate} title=\"Rotate 90\">\n            <RotateCw className=\"w-4 h-4\" />\n          </Button>\n          <Button variant=\"ghost\" size=\"icon-sm\" onClick={handleReset} title=\"Reset view\">\n            <RefreshCw className=\"w-4 h-4\" />\n          </Button>\n        </div>\n      )}\n\n      {/* Image Container */}\n      <div\n        ref={containerRef}\n        className={cn(\n          'flex-1 overflow-hidden flex items-center justify-center',\n          backgroundClass,\n          zoom > 1 ? 'cursor-grab' : 'cursor-default',\n          isDragging && 'cursor-grabbing',\n        )}\n        onMouseDown={handleMouseDown}\n        onMouseMove={handleMouseMove}\n        onMouseUp={handleMouseUp}\n        onMouseLeave={handleMouseUp}\n        onWheel={handleWheel}\n      >\n        <img\n          src={src}\n          alt={name}\n          onLoad={handleImageLoad}\n          className=\"max-w-full max-h-full object-contain select-none transition-transform duration-100\"\n          style={{\n            transform: `translate(${position.x}px, ${position.y}px) scale(${zoom}) rotate(${rotation}deg)`,\n            maxWidth: opts.maxWidth || undefined,\n            maxHeight: opts.maxHeight || undefined,\n          }}\n          draggable={false}\n        />\n      </div>\n\n      {/* Metadata */}\n      {opts.showMetadata && dimensions && (\n        <div className=\"flex items-center justify-center gap-4 py-2 text-xs text-muted-foreground bg-background/50 border-t border-border\">\n          <span>\n            {dimensions.width}  {dimensions.height} px\n          </span>\n        </div>\n      )}\n    </div>\n  )\n}\n\n// ============================================\n// PDF Viewer Component with Page Navigation\n// ============================================\n\ninterface PdfViewerProps {\n  src: string\n}\n\nfunction PdfViewer({ src }: PdfViewerProps) {\n  const [numPages, setNumPages] = useState<number>(0)\n  const [currentPage, setCurrentPage] = useState(1)\n  const [scale, setScale] = useState(1)\n  const [isLoading, setIsLoading] = useState(true)\n  const [error, setError] = useState<string | null>(null)\n  const containerRef = useRef<HTMLDivElement>(null)\n  const pageRefs = useRef<Map<number, HTMLDivElement>>(new Map())\n  const [containerWidth, setContainerWidth] = useState<number>(800)\n\n  // Track container width for responsive scaling\n  useEffect(() => {\n    const updateWidth = () => {\n      if (containerRef.current) {\n        setContainerWidth(containerRef.current.clientWidth - 48)\n      }\n    }\n\n    updateWidth()\n    window.addEventListener('resize', updateWidth)\n    return () => window.removeEventListener('resize', updateWidth)\n  }, [])\n\n  const onDocumentLoadSuccess = ({ numPages }: { numPages: number }) => {\n    setNumPages(numPages)\n    setIsLoading(false)\n    setError(null)\n  }\n\n  const onDocumentLoadError = (err: Error) => {\n    setError(err.message || 'Failed to load PDF')\n    setIsLoading(false)\n  }\n\n  const handleZoomIn = () => setScale((prev) => Math.min(prev + 0.25, 3))\n  const handleZoomOut = () => setScale((prev) => Math.max(prev - 0.25, 0.5))\n  const handleFitWidth = () => setScale(1)\n\n  const goToPage = useCallback(\n    (page: number) => {\n      const validPage = Math.max(1, Math.min(page, numPages))\n      setCurrentPage(validPage)\n\n      const pageElement = pageRefs.current.get(validPage)\n      if (pageElement) {\n        pageElement.scrollIntoView({ behavior: 'smooth', block: 'start' })\n      }\n    },\n    [numPages],\n  )\n\n  const handlePageInputChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const value = parseInt(e.target.value, 10)\n    if (!isNaN(value)) {\n      goToPage(value)\n    }\n  }\n\n  const setPageRef = useCallback((pageNum: number, element: HTMLDivElement | null) => {\n    if (element) {\n      pageRefs.current.set(pageNum, element)\n    } else {\n      pageRefs.current.delete(pageNum)\n    }\n  }, [])\n\n  return (\n    <div className=\"h-full flex flex-col overflow-hidden\">\n      {/* PDF Controls */}\n      <div className=\"flex items-center justify-between px-4 py-2 border-b border-border bg-muted/30 shrink-0\">\n        <div className=\"flex items-center gap-2\">\n          {/* Page Navigation */}\n          <Button variant=\"ghost\" size=\"icon-sm\" onClick={() => goToPage(currentPage - 1)} disabled={currentPage <= 1}>\n            <ChevronLeft className=\"h-4 w-4\" />\n          </Button>\n\n          <div className=\"flex items-center gap-1.5\">\n            <input\n              type=\"number\"\n              min={1}\n              max={numPages}\n              value={currentPage}\n              onChange={handlePageInputChange}\n              className=\"w-14 h-7 text-center text-sm border border-border rounded bg-background px-2\"\n            />\n            <span className=\"text-sm text-muted-foreground\">/ {numPages}</span>\n          </div>\n\n          <Button\n            variant=\"ghost\"\n            size=\"icon-sm\"\n            onClick={() => goToPage(currentPage + 1)}\n            disabled={currentPage >= numPages}\n          >\n            <ChevronRight className=\"h-4 w-4\" />\n          </Button>\n        </div>\n\n        {/* Zoom Controls */}\n        <div className=\"flex items-center gap-1\">\n          <Button variant=\"ghost\" size=\"icon-sm\" onClick={handleZoomOut}>\n            <ZoomOut className=\"h-4 w-4\" />\n          </Button>\n\n          <span className=\"text-xs text-muted-foreground min-w-[50px] text-center\">{Math.round(scale * 100)}%</span>\n\n          <Button variant=\"ghost\" size=\"icon-sm\" onClick={handleZoomIn}>\n            <ZoomIn className=\"h-4 w-4\" />\n          </Button>\n\n          <div className=\"w-px h-6 bg-border mx-1\" />\n\n          <Button variant=\"ghost\" size=\"sm\" onClick={handleFitWidth} className=\"text-xs\">\n            Fit\n          </Button>\n        </div>\n      </div>\n\n      {/* PDF Content */}\n      <div ref={containerRef} className=\"flex-1 overflow-auto bg-muted/20\" style={{ minHeight: 0 }}>\n        {error ? (\n          <div className=\"flex items-center justify-center h-full\">\n            <div className=\"text-center space-y-4\">\n              <div className=\"w-16 h-16 rounded-xl bg-destructive/10 flex items-center justify-center mx-auto\">\n                <FileText className=\"h-8 w-8 text-destructive\" />\n              </div>\n              <div>\n                <p className=\"font-medium text-destructive\">Failed to load PDF</p>\n                <p className=\"text-sm text-muted-foreground mt-1\">{error}</p>\n              </div>\n            </div>\n          </div>\n        ) : (\n          <div className=\"flex justify-center p-6\">\n            <Document\n              file={src}\n              onLoadSuccess={onDocumentLoadSuccess}\n              onLoadError={onDocumentLoadError}\n              loading={\n                <div className=\"flex items-center justify-center py-20\">\n                  <div className=\"text-center space-y-3\">\n                    <Loader2 className=\"h-8 w-8 animate-spin mx-auto text-primary\" />\n                    <p className=\"text-sm text-muted-foreground\">Loading PDF...</p>\n                  </div>\n                </div>\n              }\n              className=\"flex flex-col items-center gap-4\"\n            >\n              {!isLoading &&\n                Array.from({ length: numPages }, (_, index) => {\n                  const pageNum = index + 1\n                  return (\n                    <div\n                      key={pageNum}\n                      ref={(el) => setPageRef(pageNum, el)}\n                      className={cn(\n                        'shadow-lg rounded-sm overflow-hidden bg-white scroll-mt-6',\n                        currentPage === pageNum && 'ring-2 ring-primary',\n                      )}\n                      onClick={() => setCurrentPage(pageNum)}\n                    >\n                      <Page\n                        pageNumber={pageNum}\n                        width={containerWidth * scale}\n                        renderTextLayer={true}\n                        renderAnnotationLayer={true}\n                      />\n                    </div>\n                  )\n                })}\n            </Document>\n          </div>\n        )}\n      </div>\n    </div>\n  )\n}\n\n// ============================================\n// Video Preview Component\n// ============================================\n\nfunction VideoPreview({ src, name }: { src: string; name: string }) {\n  return (\n    <div className=\"flex-1 flex items-center justify-center p-4 bg-black\">\n      <video src={src} controls autoPlay={false} className=\"max-w-full max-h-full rounded\">\n        Your browser does not support video playback for {name}.\n      </video>\n    </div>\n  )\n}\n\n// ============================================\n// No Preview Component\n// ============================================\n\nfunction NoPreview({ mimeType, name }: { mimeType: string; name: string }) {\n  const iconType = getFileIconType(mimeType)\n  const Icon = iconMap[iconType]\n\n  return (\n    <div className=\"flex flex-col items-center justify-center h-full gap-4 text-center p-8\">\n      <div className=\"w-24 h-24 rounded-2xl bg-muted flex items-center justify-center\">\n        <Icon className=\"w-12 h-12 text-muted-foreground\" />\n      </div>\n      <div>\n        <h3 className=\"text-lg font-medium mb-1\">{name}</h3>\n        <p className=\"text-muted-foreground text-sm\">Preview not available for this file type</p>\n        <p className=\"text-muted-foreground text-xs mt-1\">{mimeType || 'Unknown type'}</p>\n      </div>\n    </div>\n  )\n}\n\n// ============================================\n// Loading with Progress Component\n// ============================================\n\ninterface LoadingProgressProps {\n  fileName: string\n  mimeType: string\n  progress: DownloadProgress | null\n}\n\nfunction LoadingProgress({ fileName, mimeType, progress }: LoadingProgressProps) {\n  const iconType = getFileIconType(mimeType)\n  const Icon = iconMap[iconType]\n\n  return (\n    <div className=\"flex-1 flex items-center justify-center\">\n      <div className=\"text-center space-y-4 w-80\">\n        <div className=\"w-16 h-16 rounded-xl bg-muted flex items-center justify-center mx-auto\">\n          <Icon className=\"w-8 h-8 text-muted-foreground\" />\n        </div>\n\n        <p className=\"font-medium truncate\">{fileName}</p>\n\n        {progress && (\n          <div className=\"space-y-2\">\n            <div className=\"h-2 bg-muted rounded-full overflow-hidden\">\n              <div\n                className=\"h-full bg-primary transition-all duration-150 ease-out\"\n                style={{ width: `${progress.percentage}%` }}\n              />\n            </div>\n            <div className=\"flex items-center justify-between text-xs text-muted-foreground\">\n              <span>\n                {formatFileSize(progress.loaded)}\n                {progress.total && ` / ${formatFileSize(progress.total)}`}\n              </span>\n              <span>{progress.percentage}%</span>\n            </div>\n          </div>\n        )}\n\n        <p className=\"text-sm text-muted-foreground\">\n          {progress?.percentage === 100 ? 'Processing file...' : 'Downloading file...'}\n        </p>\n      </div>\n    </div>\n  )\n}\n\n// ============================================\n// Main Dialog Component\n// ============================================\n\nexport function FilePreviewDialog({\n  isOpen,\n  onClose,\n  src,\n  name,\n  size,\n  mimeType,\n  onFetchFile,\n  previewOptions,\n}: FilePreviewDialogProps) {\n  const [textContent, setTextContent] = useState<string | null>(null)\n  const [isLoadingContent, setIsLoadingContent] = useState(false)\n  const [loadError, setLoadError] = useState<string | null>(null)\n  const [downloadProgress, setDownloadProgress] = useState<DownloadProgress | null>(null)\n\n  const fileCategory = useMemo(() => {\n    if (mimeType.startsWith('image/')) return 'image'\n    if (mimeType.startsWith('video/')) return 'video'\n    if (mimeType === 'application/pdf') return 'pdf'\n    if (isCsv(mimeType, name)) return 'csv'\n    if (isJson(mimeType, name)) return 'json'\n    if (isTextBased(mimeType)) return 'text'\n    return 'unknown'\n  }, [mimeType, name])\n\n  const needsTextFetch = ['csv', 'json', 'text'].includes(fileCategory)\n\n  // Fetch text content for text-based files with progress tracking\n  useEffect(() => {\n    if (!isOpen || !needsTextFetch) {\n      setTextContent(null)\n      setDownloadProgress(null)\n      return\n    }\n\n    const abortController = new AbortController()\n\n    const fetchContent = async () => {\n      setIsLoadingContent(true)\n      setLoadError(null)\n      setDownloadProgress({ loaded: 0, total: size || null, percentage: 0 })\n\n      try {\n        let text: string\n\n        if (onFetchFile) {\n          const result = await onFetchFile(src, mimeType)\n          text = typeof result === 'string' ? result : await result.text()\n        } else if (src.startsWith('data:')) {\n          const base64Content = src.split(',')[1]\n          if (!base64Content) throw new Error('Invalid data URL')\n          text = atob(base64Content)\n        } else {\n          const response = await fetch(src, { signal: abortController.signal })\n          if (!response.ok) throw new Error('Failed to fetch file')\n\n          const contentLength = response.headers.get('content-length')\n          const total = contentLength ? parseInt(contentLength, 10) : size || null\n\n          if (!response.body) {\n            text = await response.text()\n          } else {\n            const reader = response.body.getReader()\n            const chunks: Uint8Array[] = []\n            let loaded = 0\n\n            while (true) {\n              const { done, value } = await reader.read()\n              if (done) break\n\n              chunks.push(value)\n              loaded += value.length\n\n              const percentage = total ? Math.round((loaded / total) * 100) : 0\n              setDownloadProgress({ loaded, total, percentage })\n            }\n\n            const allChunks = new Uint8Array(loaded)\n            let position = 0\n            for (const chunk of chunks) {\n              allChunks.set(chunk, position)\n              position += chunk.length\n            }\n\n            const decoder = new TextDecoder('utf-8')\n            text = decoder.decode(allChunks)\n          }\n        }\n\n        setTextContent(text)\n        setDownloadProgress(null)\n      } catch (error) {\n        if ((error as Error).name === 'AbortError') return\n        setLoadError('Failed to load file content')\n        console.error('Error fetching file content:', error)\n        setDownloadProgress(null)\n      } finally {\n        setIsLoadingContent(false)\n      }\n    }\n\n    fetchContent()\n\n    return () => {\n      abortController.abort()\n    }\n  }, [isOpen, src, mimeType, size, needsTextFetch, onFetchFile])\n\n  const handleDownload = useCallback(() => {\n    const link = document.createElement('a')\n    link.href = src\n    link.download = name\n    link.target = '_blank'\n    document.body.appendChild(link)\n    link.click()\n    document.body.removeChild(link)\n  }, [src, name])\n\n  useEffect(() => {\n    if (!isOpen) return\n\n    const handleKeyDown = (e: KeyboardEvent) => {\n      if (e.key === 'Escape') {\n        onClose()\n      }\n    }\n\n    document.addEventListener('keydown', handleKeyDown)\n    document.body.style.overflow = 'hidden'\n\n    return () => {\n      document.removeEventListener('keydown', handleKeyDown)\n      document.body.style.overflow = ''\n    }\n  }, [isOpen, onClose])\n\n  if (!isOpen) return null\n\n  const preview = canPreview(mimeType)\n\n  const renderPreview = () => {\n    if (isLoadingContent) {\n      return <LoadingProgress fileName={name} mimeType={mimeType} progress={downloadProgress} />\n    }\n\n    if (loadError) {\n      return (\n        <div className=\"flex-1 flex items-center justify-center\">\n          <div className=\"text-center space-y-4\">\n            <div className=\"w-16 h-16 rounded-xl bg-destructive/10 flex items-center justify-center mx-auto\">\n              <AlertCircle className=\"h-8 w-8 text-destructive\" />\n            </div>\n            <div>\n              <p className=\"font-medium text-destructive\">{loadError}</p>\n              <p className=\"text-sm text-muted-foreground mt-1\">Try downloading the file instead</p>\n            </div>\n            <Button onClick={handleDownload}>\n              <Download className=\"h-4 w-4 mr-2\" />\n              Download File\n            </Button>\n          </div>\n        </div>\n      )\n    }\n\n    if (!preview) {\n      return <NoPreview mimeType={mimeType} name={name} />\n    }\n\n    switch (fileCategory) {\n      case 'image':\n        return <ImageViewer src={src} name={name} options={previewOptions?.image} />\n      case 'video':\n        return <VideoPreview src={src} name={name} />\n      case 'pdf':\n        return <PdfViewer src={src} />\n      case 'csv':\n        return textContent ? <CsvViewer content={textContent} options={previewOptions?.csv} /> : null\n      case 'json':\n        return textContent ? <JsonViewer content={textContent} options={previewOptions?.text} /> : null\n      case 'text':\n        return textContent ? <TextViewer content={textContent} fileName={name} options={previewOptions?.text} /> : null\n      default:\n        return <NoPreview mimeType={mimeType} name={name} />\n    }\n  }\n\n  return createPortal(\n    <div className=\"fixed inset-0 z-[100]\">\n      {/* Backdrop */}\n      <div\n        className=\"absolute inset-0 bg-foreground/80 backdrop-blur-sm animate-in fade-in duration-200\"\n        onClick={onClose}\n      />\n\n      {/* Dialog */}\n      <div className=\"absolute inset-0 flex flex-col animate-in fade-in zoom-in-95 duration-200\">\n        {/* Header */}\n        <div className=\"flex items-center justify-between px-4 py-3 bg-background/95 backdrop-blur border-b border-border\">\n          <div className=\"flex items-center gap-3 min-w-0\">\n            <div className=\"flex-1 min-w-0\">\n              <h2 className=\"font-medium truncate\" title={name}>\n                {name}\n              </h2>\n              <p className=\"text-xs text-muted-foreground\">\n                {formatFileSize(size)}  {mimeType || 'Unknown type'}\n              </p>\n            </div>\n          </div>\n          <div className=\"flex items-center gap-2 shrink-0\">\n            <Button variant=\"outline\" size=\"sm\" onClick={handleDownload}>\n              <Download className=\"w-4 h-4 mr-2\" />\n              Download\n            </Button>\n            <Button variant=\"ghost\" size=\"icon\" onClick={onClose}>\n              <X className=\"w-5 h-5\" />\n            </Button>\n          </div>\n        </div>\n\n        {/* Content */}\n        <div\n          className={cn(\n            'flex-1 overflow-hidden bg-background flex flex-col',\n            fileCategory === 'image' && 'bg-muted/50',\n          )}\n        >\n          {renderPreview()}\n        </div>\n      </div>\n    </div>,\n    document.body,\n  )\n}\n",
      "type": "registry:component"
    },
    {
      "path": "src/components/ui/editor/mention-list.tsx",
      "content": "import { forwardRef, useImperativeHandle, useState } from 'react'\nimport { cn } from '@/lib/utils'\nimport type { MentionItem } from './types'\n\nexport interface MentionListRef {\n  onKeyDown: (props: { event: KeyboardEvent }) => boolean\n}\n\nexport interface MentionListProps {\n  items: MentionItem[]\n  command: (item: MentionItem) => void\n  loading?: boolean\n  noResultsText: string\n  loadingText: string\n  renderItem?: (item: MentionItem, isSelected: boolean) => React.ReactNode\n}\n\nexport const MentionList = forwardRef<MentionListRef, MentionListProps>(\n  ({ items, command, loading, noResultsText, loadingText, renderItem }, ref) => {\n    const [selectedIndex, setSelectedIndex] = useState(0)\n\n    // Handle keyboard navigation via ref\n    useImperativeHandle(\n      ref,\n      () => ({\n        onKeyDown: ({ event }) => {\n          if (event.key === 'ArrowUp') {\n            setSelectedIndex((prev) => (prev <= 0 ? items.length - 1 : prev - 1))\n            return true\n          }\n          if (event.key === 'ArrowDown') {\n            setSelectedIndex((prev) => (prev >= items.length - 1 ? 0 : prev + 1))\n            return true\n          }\n          if (event.key === 'Enter') {\n            const safeIdx = Math.min(selectedIndex, items.length - 1)\n            if (items[safeIdx]) {\n              command(items[safeIdx])\n            }\n            return true\n          }\n          return false\n        },\n      }),\n      [items, selectedIndex, command],\n    )\n\n    if (loading) {\n      return (\n        <div className=\"mention-list\">\n          <div className=\"mention-list-loading\">{loadingText}</div>\n        </div>\n      )\n    }\n\n    if (items.length === 0) {\n      return (\n        <div className=\"mention-list\">\n          <div className=\"mention-list-empty\">{noResultsText}</div>\n        </div>\n      )\n    }\n\n    // Ensure selectedIndex is in bounds for rendering\n    const safeIndex = Math.min(Math.max(0, selectedIndex), items.length - 1)\n\n    return (\n      <div className=\"mention-list\">\n        {items.map((item, index) => (\n          <button\n            key={item.id}\n            type=\"button\"\n            className={cn('mention-list-item', index === safeIndex && 'is-selected')}\n            onClick={() => command(item)}\n            onMouseEnter={() => setSelectedIndex(index)}\n          >\n            {renderItem ? renderItem(item, index === safeIndex) : <DefaultMentionItem item={item} />}\n          </button>\n        ))}\n      </div>\n    )\n  },\n)\n\nMentionList.displayName = 'MentionList'\n\nfunction DefaultMentionItem({ item }: { item: MentionItem }) {\n  return (\n    <>\n      {item.avatar && <img src={item.avatar} alt=\"\" className=\"w-6 h-6 rounded-full object-cover flex-shrink-0\" />}\n      <span className=\"font-medium truncate\">{item.label}</span>\n    </>\n  )\n}\n",
      "type": "registry:component"
    },
    {
      "path": "src/components/ui/editor/mention-component.tsx",
      "content": "import { NodeViewWrapper, type NodeViewProps } from '@tiptap/react'\nimport { cn } from '@/lib/utils'\nimport type { MentionItem } from './types'\n\nexport function MentionComponent({ node, editor, selected }: NodeViewProps) {\n  const { id, label, avatar, metadata } = node.attrs as MentionItem & { metadata?: Record<string, unknown> }\n  const isEditable = editor.isEditable\n\n  // Get callbacks from storage (using type assertion to avoid type errors)\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  const storage = (editor.storage as any).mention as\n    | {\n        onMentionClick?: (item: MentionItem, event: MouseEvent) => void\n        renderMention?: (item: MentionItem) => React.ReactNode\n      }\n    | undefined\n  const onMentionClick = storage?.onMentionClick\n  const renderMention = storage?.renderMention\n\n  const mentionItem: MentionItem & { metadata?: Record<string, unknown> } = { id, label, avatar, metadata }\n\n  // Custom render if provided\n  if (renderMention) {\n    return (\n      <NodeViewWrapper as=\"span\" className=\"mention-wrapper\">\n        {renderMention(mentionItem)}\n      </NodeViewWrapper>\n    )\n  }\n\n  // Default render: badge with name (avatar only if provided)\n  return (\n    <NodeViewWrapper as=\"span\" className=\"mention-wrapper\">\n      <span\n        className={cn(\n          'mention',\n          'inline-flex items-center gap-1 px-1.5 rounded',\n          'bg-primary/10 text-primary text-sm font-medium',\n          'cursor-pointer hover:bg-primary/20',\n          'transition-colors whitespace-nowrap',\n          selected && isEditable && 'ring-2 ring-primary ring-offset-1',\n        )}\n        onClick={(e) => onMentionClick?.(mentionItem, e.nativeEvent)}\n        contentEditable={false}\n      >\n        {avatar && <img src={avatar} alt=\"\" className=\"w-4 h-4 rounded-full object-cover flex-shrink-0\" />}\n        <span>@{label}</span>\n      </span>\n    </NodeViewWrapper>\n  )\n}\n",
      "type": "registry:component"
    },
    {
      "path": "src/components/ui/editor/commands.ts",
      "content": "import type { Editor } from '@tiptap/react'\nimport type { SlashCommand, SlashCommandGroupInfo, EditorActionContext } from './types'\nimport {\n  Type,\n  Heading1,\n  Heading2,\n  Heading3,\n  List,\n  ListOrdered,\n  CheckSquare,\n  Quote,\n  Code,\n  Minus,\n  Link,\n  Highlighter,\n  CodeSquare,\n  Table2,\n  Info,\n  ChevronRight,\n} from 'lucide-react'\n\n// Command group definitions\nexport const commandGroups: SlashCommandGroupInfo[] = [\n  { id: 'basic', label: 'Basic Blocks', priority: 1 },\n  { id: 'lists', label: 'Lists', priority: 2 },\n  { id: 'formatting', label: 'Formatting', priority: 3 },\n  { id: 'advanced', label: 'Advanced', priority: 4 },\n  { id: 'media', label: 'Media', priority: 5 },\n  { id: 'custom', label: 'Custom', priority: 6 },\n]\n\n// Default slash commands\nexport const defaultSlashCommands: SlashCommand[] = [\n  // Basic blocks\n  {\n    name: 'Text',\n    description: 'Just start writing with plain text',\n    icon: Type,\n    aliases: ['paragraph', 'p'],\n    group: 'basic',\n    action: (editor: Editor) => {\n      editor.chain().focus().setParagraph().run()\n    },\n  },\n  {\n    name: 'Heading 1',\n    description: 'Large section heading',\n    icon: Heading1,\n    aliases: ['h1', 'title'],\n    group: 'basic',\n    action: (editor: Editor) => {\n      editor.chain().focus().toggleHeading({ level: 1 }).run()\n    },\n  },\n  {\n    name: 'Heading 2',\n    description: 'Medium section heading',\n    icon: Heading2,\n    aliases: ['h2', 'subtitle'],\n    group: 'basic',\n    action: (editor: Editor) => {\n      editor.chain().focus().toggleHeading({ level: 2 }).run()\n    },\n  },\n  {\n    name: 'Heading 3',\n    description: 'Small section heading',\n    icon: Heading3,\n    aliases: ['h3'],\n    group: 'basic',\n    action: (editor: Editor) => {\n      editor.chain().focus().toggleHeading({ level: 3 }).run()\n    },\n  },\n\n  // Lists\n  {\n    name: 'Bullet List',\n    description: 'Create a simple bullet list',\n    icon: List,\n    aliases: ['ul', 'unordered', 'bullets'],\n    group: 'lists',\n    action: (editor: Editor) => {\n      editor.chain().focus().toggleBulletList().run()\n    },\n  },\n  {\n    name: 'Numbered List',\n    description: 'Create a numbered list',\n    icon: ListOrdered,\n    aliases: ['ol', 'ordered', 'numbers'],\n    group: 'lists',\n    action: (editor: Editor) => {\n      editor.chain().focus().toggleOrderedList().run()\n    },\n  },\n  {\n    name: 'Task List',\n    description: 'Track tasks with a to-do list',\n    icon: CheckSquare,\n    aliases: ['todo', 'checkbox', 'checklist'],\n    group: 'lists',\n    action: (editor: Editor) => {\n      editor.chain().focus().toggleTaskList().run()\n    },\n  },\n\n  // Formatting\n  {\n    name: 'Inline Code',\n    description: 'Mark text as inline code',\n    icon: CodeSquare,\n    aliases: ['code', 'monospace', 'mono'],\n    group: 'formatting',\n    action: (editor: Editor) => {\n      editor.chain().focus().toggleCode().run()\n    },\n  },\n  {\n    name: 'Highlight',\n    description: 'Highlight important text',\n    icon: Highlighter,\n    aliases: ['mark', 'marker', 'yellow'],\n    group: 'formatting',\n    action: (editor: Editor) => {\n      editor.chain().focus().toggleHighlight().run()\n    },\n  },\n  {\n    name: 'Link',\n    description: 'Add a link to text',\n    icon: Link,\n    aliases: ['url', 'href', 'anchor'],\n    group: 'formatting',\n    action: (_editor: Editor, context?: EditorActionContext) => {\n      if (!context) {\n        console.warn('[RichTextEditor] Link command requires EditorActionContext')\n        return\n      }\n      context.openLinkPopover()\n    },\n  },\n\n  // Advanced\n  {\n    name: 'Quote',\n    description: 'Capture a quote',\n    icon: Quote,\n    aliases: ['blockquote', 'quotation'],\n    group: 'advanced',\n    action: (editor: Editor) => {\n      editor.chain().focus().toggleBlockquote().run()\n    },\n  },\n  {\n    name: 'Code Block',\n    description: 'Display code with syntax highlighting',\n    icon: Code,\n    aliases: ['codeblock', 'pre', 'syntax'],\n    group: 'advanced',\n    action: (editor: Editor) => {\n      editor.chain().focus().toggleCodeBlock().run()\n    },\n  },\n  {\n    name: 'Divider',\n    description: 'Visually divide blocks',\n    icon: Minus,\n    aliases: ['hr', 'horizontal', 'rule', 'separator'],\n    group: 'advanced',\n    action: (editor: Editor) => {\n      editor.chain().focus().setHorizontalRule().run()\n    },\n  },\n  {\n    name: 'Table',\n    description: 'Insert a table',\n    icon: Table2,\n    aliases: ['table', 'grid'],\n    group: 'advanced',\n    action: (editor: Editor) => {\n      editor.chain().focus().insertTable({ rows: 3, cols: 3, withHeaderRow: true }).run()\n    },\n  },\n  {\n    name: 'Callout',\n    description: 'Highlight important information',\n    icon: Info,\n    aliases: ['callout', 'note', 'info', 'alert', 'notice'],\n    group: 'advanced',\n    action: (editor: Editor) => {\n      editor.chain().focus().setCallout({ type: 'info' }).run()\n    },\n  },\n  {\n    name: 'Toggle',\n    description: 'Expandable content block',\n    icon: ChevronRight,\n    aliases: ['toggle', 'expand', 'collapse', 'details', 'accordion'],\n    group: 'advanced',\n    action: (editor: Editor) => {\n      editor.chain().focus().setToggle().run()\n    },\n  },\n]\n\n// Filter commands based on query\nexport function filterCommands(commands: SlashCommand[], query: string): SlashCommand[] {\n  if (!query) return commands\n\n  const lowerQuery = query.toLowerCase()\n\n  return commands.filter((command) => {\n    const nameMatch = command.name.toLowerCase().includes(lowerQuery)\n    const descriptionMatch = command.description.toLowerCase().includes(lowerQuery)\n    const aliasMatch = command.aliases?.some((alias) => alias.toLowerCase().includes(lowerQuery))\n    return nameMatch || descriptionMatch || aliasMatch\n  })\n}\n\n// Group commands by their group\nexport function groupCommands(commands: SlashCommand[]): Map<SlashCommandGroupInfo, SlashCommand[]> {\n  const grouped = new Map<SlashCommandGroupInfo, SlashCommand[]>()\n\n  // Sort groups by priority\n  const sortedGroups = [...commandGroups].sort((a, b) => a.priority - b.priority)\n\n  for (const group of sortedGroups) {\n    const groupCommands = commands.filter((cmd) => cmd.group === group.id)\n    if (groupCommands.length > 0) {\n      grouped.set(group, groupCommands)\n    }\n  }\n\n  return grouped\n}\n",
      "type": "registry:component"
    },
    {
      "path": "src/components/ui/editor/types.ts",
      "content": "import type { Editor } from '@tiptap/react'\nimport type { LucideIcon } from 'lucide-react'\n\n// Content format types\nexport type EditorContentFormat = 'html' | 'json' | 'text'\n\nexport interface EditorContent {\n  html?: string\n  json?: Record<string, unknown>\n  text?: string\n}\n\n// Editor action context for commands that need special UI (like dialogs/popovers)\nexport interface EditorActionContext {\n  openLinkPopover: () => void\n}\n\n// Slash command types\nexport interface SlashCommand {\n  name: string\n  description: string\n  icon: LucideIcon\n  aliases?: string[]\n  group: SlashCommandGroup\n  action: (editor: Editor, context?: EditorActionContext) => void\n}\n\nexport type SlashCommandGroup = 'basic' | 'lists' | 'formatting' | 'media' | 'advanced' | 'custom'\n\nexport interface SlashCommandGroupInfo {\n  id: SlashCommandGroup\n  label: string\n  priority: number\n}\n\n// Toolbar action types\nexport interface ToolbarAction {\n  id: string\n  icon: LucideIcon\n  label: string\n  isActive?: (editor: Editor) => boolean\n  action: (editor: Editor) => void\n}\n\n// Plugin types\nexport interface EditorPlugin {\n  name: string\n  slashCommands?: SlashCommand[]\n  toolbarActions?: ToolbarAction[]\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  extensions?: any[]\n  onInit?: (editor: Editor) => void\n  onDestroy?: () => void\n}\n\n// Main editor props\nexport interface RichTextEditorProps {\n  /** Initial content (HTML string or JSON) */\n  content?: string | Record<string, unknown>\n  /** Callback when content changes */\n  onChange?: (content: EditorContent) => void\n  /** Whether the editor is editable */\n  editable?: boolean\n  /** Placeholder text when editor is empty */\n  placeholder?: string\n  /** Enable autofocus on mount */\n  autoFocus?: boolean\n  /** Additional class names */\n  className?: string\n  /** Show the fixed toolbar at the top (defaults to true in edit mode) */\n  showToolbar?: boolean\n  /** Enable mentions (requires onMention callback) */\n  enableMentions?: boolean\n  /** Callback to search users for mentions */\n  onMention?: (query: string) => Promise<MentionItem[]>\n  /** Enable file uploads (requires onFileUpload callback) */\n  enableFileUpload?: boolean\n  /** Callback to handle file uploads */\n  onFileUpload?: (file: File) => Promise<string>\n  /** Custom plugins */\n  plugins?: EditorPlugin[]\n  /** Minimum height of the editor */\n  minHeight?: string | number\n  /** Maximum height for code blocks. If not set, code blocks expand fully. */\n  codeBlockMaxHeight?: string | number\n  /** Custom callout types. If not provided, defaults to info, warning, error, success. */\n  calloutTypes?: CalloutTypeConfig[]\n}\n\n// Viewer props (lighter weight)\nexport interface RichTextViewerProps {\n  /** Content to display (HTML string or JSON) */\n  content: string | Record<string, unknown>\n  /** Additional class names */\n  className?: string\n  /** Callback when a mention is clicked */\n  onMentionClick?: (item: MentionItem, event: MouseEvent) => void\n  /** Maximum height for code blocks. If not set, code blocks expand fully. */\n  codeBlockMaxHeight?: string | number\n}\n\n// Mention types\nexport interface MentionItem {\n  id: string\n  label: string\n  avatar?: string\n  metadata?: Record<string, unknown>\n}\n\n// Editor ref for imperative handle\nexport interface RichTextEditorRef {\n  getEditor: () => Editor | null\n  getContent: (format?: EditorContentFormat) => string | Record<string, unknown> | null\n  setContent: (content: string | Record<string, unknown>) => void\n  focus: () => void\n  blur: () => void\n  isEmpty: () => boolean\n  clear: () => void\n}\n\n// Command menu state\nexport interface CommandMenuState {\n  isOpen: boolean\n  query: string\n  selectedIndex: number\n  items: SlashCommand[]\n  position: { top: number; left: number } | null\n}\n\n// File attachment types\nexport type FileDisplayMode = 'block' | 'inline'\nexport type FileAlignment = 'left' | 'center' | 'right'\n\nexport interface FileAttachmentAttributes {\n  src: string\n  name: string\n  size: number\n  mimeType: string\n  displayMode: FileDisplayMode\n  alignment: FileAlignment\n  width: number | null\n  uploading?: boolean\n  uploadId?: string | null\n}\n\n// Callout types\nexport interface CalloutTypeConfig {\n  /** Unique identifier for this callout type */\n  id: string\n  /** Display label shown in dropdown */\n  label: string\n  /** Lucide icon component */\n  icon: LucideIcon\n  /** Light mode background color (CSS color value) */\n  bgLight?: string\n  /** Light mode border color (CSS color value) */\n  borderLight?: string\n  /** Light mode icon color (CSS color value) */\n  iconColorLight?: string\n  /** Dark mode background color (CSS color value) */\n  bgDark?: string\n  /** Dark mode border color (CSS color value) */\n  borderDark?: string\n  /** Dark mode icon color (CSS color value) */\n  iconColorDark?: string\n}\n",
      "type": "registry:component"
    },
    {
      "path": "src/components/ui/editor/index.ts",
      "content": "// Components\nexport { RichTextEditor } from './editor'\nexport { RichTextViewer } from './viewer'\nexport { BubbleMenu } from './bubble-menu'\nexport { CommandMenu } from './command-menu'\nexport { Toolbar } from './toolbar'\n\n// Types\nexport type {\n  RichTextEditorProps,\n  RichTextEditorRef,\n  RichTextViewerProps,\n  EditorContent,\n  EditorContentFormat,\n  SlashCommand,\n  SlashCommandGroup,\n  SlashCommandGroupInfo,\n  ToolbarAction,\n  EditorPlugin,\n  MentionItem,\n  CommandMenuState,\n  FileAttachmentAttributes,\n  FileDisplayMode,\n  FileAlignment,\n  CalloutTypeConfig,\n} from './types'\n\n// Utilities\nexport { defaultSlashCommands, filterCommands, groupCommands, commandGroups } from './commands'\nexport { createExtensions } from './extensions'\nexport { SlashCommands } from './extensions/slash-commands'\n\n// Plugins\nexport {\n  createFileUploadPlugin,\n  type FileUploadPluginOptions,\n  type DisplayModeByType,\n  createMentionPlugin,\n  type MentionPluginOptions,\n} from './plugins'\n\n// Extensions\nexport { FileAttachment } from './extensions/file-attachment'\nexport type {\n  FileFetcher,\n  FileDeleteHandler,\n  PreviewOptions,\n  CsvPreviewOptions,\n  TextPreviewOptions,\n  ImagePreviewOptions,\n  PdfPreviewOptions,\n} from './extensions/file-attachment'\n\nexport { MentionExtension } from './extensions/mention-extension'\n\n// Callout\nexport { Callout } from './extensions/callout'\nexport { DEFAULT_CALLOUT_TYPES } from './callout'\n",
      "type": "registry:component"
    },
    {
      "path": "src/components/ui/editor/editor.css",
      "content": "/* Editor Container */\n.rich-text-editor {\n  position: relative;\n  width: 100%;\n}\n\n.rich-text-editor .tiptap {\n  outline: none;\n  min-height: inherit;\n  padding: 1rem;\n}\n\n/* Placeholder Styles */\n.tiptap p.is-editor-empty:first-child::before {\n  color: var(--muted-foreground);\n  content: attr(data-placeholder);\n  float: left;\n  height: 0;\n  pointer-events: none;\n}\n\n.tiptap .is-node-empty:first-child::before {\n  color: var(--muted-foreground);\n  content: attr(data-placeholder);\n  float: left;\n  height: 0;\n  pointer-events: none;\n}\n\n/* Typography */\n.tiptap {\n  line-height: 1.7;\n  font-size: 1rem;\n  color: var(--foreground);\n}\n\n.tiptap > * + * {\n  margin-top: 0.75em;\n}\n\n/* Headings */\n.tiptap h1 {\n  font-size: 2.25rem;\n  font-weight: 700;\n  line-height: 1.2;\n  margin-top: 2rem;\n  margin-bottom: 0.5rem;\n}\n\n.tiptap h2 {\n  font-size: 1.75rem;\n  font-weight: 600;\n  line-height: 1.3;\n  margin-top: 1.5rem;\n  margin-bottom: 0.5rem;\n}\n\n.tiptap h3 {\n  font-size: 1.375rem;\n  font-weight: 600;\n  line-height: 1.4;\n  margin-top: 1.25rem;\n  margin-bottom: 0.5rem;\n}\n\n/* Paragraphs */\n.tiptap p {\n  margin: 0;\n}\n\n/* Links */\n.tiptap a,\n.tiptap .editor-link {\n  color: var(--primary);\n  text-decoration: underline;\n  text-underline-offset: 3px;\n  cursor: pointer;\n  transition: opacity 0.15s ease;\n}\n\n.tiptap a:hover {\n  opacity: 0.8;\n}\n\n/* Lists */\n.tiptap ul,\n.tiptap ol {\n  padding-left: 1.5rem;\n  margin: 0.5rem 0;\n}\n\n.tiptap ul {\n  list-style-type: disc;\n}\n\n.tiptap ol {\n  list-style-type: decimal;\n}\n\n.tiptap li {\n  margin: 0.25rem 0;\n}\n\n.tiptap li p {\n  margin: 0;\n}\n\n/* Task List */\n.tiptap .editor-task-list {\n  list-style: none;\n  padding-left: 0;\n}\n\n.tiptap .editor-task-item {\n  display: flex;\n  align-items: flex-start;\n  gap: 0.5rem;\n  margin: 0.25rem 0;\n}\n\n.tiptap .editor-task-item > label {\n  flex-shrink: 0;\n  margin-top: 0.25rem;\n}\n\n.tiptap .editor-task-item > label input[type='checkbox'] {\n  width: 1rem;\n  height: 1rem;\n  accent-color: var(--primary);\n  cursor: pointer;\n  border-radius: 3px;\n}\n\n.tiptap .editor-task-item > div {\n  flex: 1;\n}\n\n.tiptap .editor-task-item[data-checked='true'] > div {\n  text-decoration: line-through;\n  opacity: 0.6;\n}\n\n/* Blockquote */\n.tiptap blockquote {\n  border-left: 3px solid var(--border);\n  padding-left: 1rem;\n  margin: 1rem 0;\n  color: var(--muted-foreground);\n  font-style: italic;\n}\n\n/* Code - Inline */\n.tiptap code {\n  background-color: var(--muted);\n  border-radius: 0.25rem;\n  padding: 0.2rem 0.4rem;\n  font-family: ui-monospace, SFMono-Regular, 'SF Mono', Menlo, Consolas, monospace;\n  font-size: 0.875em;\n  color: var(--foreground);\n}\n\n/* Code Block */\n.tiptap pre,\n.tiptap .editor-code-block {\n  background-color: var(--muted);\n  border-radius: 0.5rem;\n  padding: 1rem;\n  margin: 1rem 0;\n  overflow-x: auto;\n  font-family: ui-monospace, SFMono-Regular, 'SF Mono', Menlo, Consolas, monospace;\n  font-size: 0.875rem;\n  line-height: 1.6;\n}\n\n.tiptap pre code,\n.tiptap .editor-code-block code {\n  background: none;\n  padding: 0;\n  border-radius: 0;\n  color: inherit;\n  font-size: inherit;\n}\n\n/* Syntax Highlighting - lowlight theme */\n.tiptap .hljs-comment,\n.tiptap .hljs-quote {\n  color: #6a737d;\n}\n\n.tiptap .hljs-keyword,\n.tiptap .hljs-selector-tag,\n.tiptap .hljs-addition {\n  color: #d73a49;\n}\n\n.tiptap .hljs-number,\n.tiptap .hljs-string,\n.tiptap .hljs-meta .hljs-meta-string,\n.tiptap .hljs-literal,\n.tiptap .hljs-doctag,\n.tiptap .hljs-regexp {\n  color: #032f62;\n}\n\n.tiptap .hljs-title,\n.tiptap .hljs-section,\n.tiptap .hljs-name,\n.tiptap .hljs-selector-id,\n.tiptap .hljs-selector-class {\n  color: #6f42c1;\n}\n\n.tiptap .hljs-attribute,\n.tiptap .hljs-attr,\n.tiptap .hljs-variable,\n.tiptap .hljs-template-variable,\n.tiptap .hljs-class .hljs-title,\n.tiptap .hljs-type {\n  color: #005cc5;\n}\n\n.tiptap .hljs-symbol,\n.tiptap .hljs-bullet,\n.tiptap .hljs-subst,\n.tiptap .hljs-meta,\n.tiptap .hljs-meta .hljs-keyword,\n.tiptap .hljs-selector-attr,\n.tiptap .hljs-selector-pseudo,\n.tiptap .hljs-link {\n  color: #22863a;\n}\n\n.tiptap .hljs-built_in,\n.tiptap .hljs-deletion {\n  color: #b31d28;\n}\n\n/* Dark mode syntax highlighting */\n.dark .tiptap .hljs-comment,\n.dark .tiptap .hljs-quote {\n  color: #8b949e;\n}\n\n.dark .tiptap .hljs-keyword,\n.dark .tiptap .hljs-selector-tag,\n.dark .tiptap .hljs-addition {\n  color: #ff7b72;\n}\n\n.dark .tiptap .hljs-number,\n.dark .tiptap .hljs-string,\n.dark .tiptap .hljs-meta .hljs-meta-string,\n.dark .tiptap .hljs-literal,\n.dark .tiptap .hljs-doctag,\n.dark .tiptap .hljs-regexp {\n  color: #a5d6ff;\n}\n\n.dark .tiptap .hljs-title,\n.dark .tiptap .hljs-section,\n.dark .tiptap .hljs-name,\n.dark .tiptap .hljs-selector-id,\n.dark .tiptap .hljs-selector-class {\n  color: #d2a8ff;\n}\n\n.dark .tiptap .hljs-attribute,\n.dark .tiptap .hljs-attr,\n.dark .tiptap .hljs-variable,\n.dark .tiptap .hljs-template-variable,\n.dark .tiptap .hljs-class .hljs-title,\n.dark .tiptap .hljs-type {\n  color: #79c0ff;\n}\n\n.dark .tiptap .hljs-symbol,\n.dark .tiptap .hljs-bullet,\n.dark .tiptap .hljs-subst,\n.dark .tiptap .hljs-meta,\n.dark .tiptap .hljs-meta .hljs-keyword,\n.dark .tiptap .hljs-selector-attr,\n.dark .tiptap .hljs-selector-pseudo,\n.dark .tiptap .hljs-link {\n  color: #7ee787;\n}\n\n.dark .tiptap .hljs-built_in,\n.dark .tiptap .hljs-deletion {\n  color: #ffa198;\n}\n\n/* Horizontal Rule */\n.tiptap hr {\n  border: none;\n  border-top: 1px solid var(--border);\n  margin: 2rem 0;\n}\n\n/* Images */\n.tiptap .editor-image {\n  max-width: 100%;\n  height: auto;\n  border-radius: 0.5rem;\n  margin: 1rem 0;\n}\n\n.tiptap img.ProseMirror-selectednode {\n  outline: 2px solid var(--primary);\n  outline-offset: 2px;\n}\n\n/* Highlight */\n.tiptap mark {\n  background-color: hsl(50 100% 70%);\n  border-radius: 0.125rem;\n  padding: 0.125rem 0;\n  color: hsl(0 0% 10%);\n}\n\n.dark .tiptap mark {\n  background-color: hsl(50 100% 40%);\n  color: hsl(0 0% 95%);\n}\n\n/* Selection */\n.tiptap ::selection {\n  background-color: var(--primary);\n  color: var(--primary-foreground);\n}\n\n/* Focus styling for read-only mode disabled */\n.rich-text-editor[data-editable='false'] .tiptap {\n  cursor: default;\n}\n\n/* ======================================\n   Command Menu Styles\n   ====================================== */\n\n.command-menu {\n  background-color: var(--popover);\n  border: 1px solid var(--border);\n  border-radius: 0.5rem;\n  box-shadow: 0 10px 40px -10px hsl(var(--foreground) / 0.2);\n  max-height: 320px;\n  overflow-y: auto;\n  min-width: 280px;\n  padding: 0.5rem;\n  animation: command-menu-appear 0.15s ease-out;\n}\n\n@keyframes command-menu-appear {\n  from {\n    opacity: 0;\n    transform: translateY(-8px) scale(0.96);\n  }\n  to {\n    opacity: 1;\n    transform: translateY(0) scale(1);\n  }\n}\n\n.command-menu-empty {\n  padding: 1rem;\n  text-align: center;\n  color: var(--muted-foreground);\n  font-size: 0.875rem;\n}\n\n.command-menu-group {\n  margin-bottom: 0.5rem;\n}\n\n.command-menu-group:last-child {\n  margin-bottom: 0;\n}\n\n.command-menu-group-label {\n  padding: 0.375rem 0.5rem;\n  font-size: 0.75rem;\n  font-weight: 500;\n  color: var(--muted-foreground);\n  text-transform: uppercase;\n  letter-spacing: 0.05em;\n}\n\n.command-menu-item {\n  display: flex;\n  align-items: center;\n  gap: 0.75rem;\n  width: 100%;\n  padding: 0.5rem;\n  border: none;\n  background: none;\n  border-radius: 0.375rem;\n  cursor: pointer;\n  text-align: left;\n  transition:\n    background-color 0.15s ease,\n    color 0.15s ease;\n}\n\n.command-menu-item:hover,\n.command-menu-item-selected {\n  background-color: var(--primary);\n  color: var(--primary-foreground);\n}\n\n.command-menu-item-icon {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 2rem;\n  height: 2rem;\n  border-radius: 0.375rem;\n  background-color: var(--muted);\n  color: var(--foreground);\n  flex-shrink: 0;\n}\n\n.command-menu-item-content {\n  flex: 1;\n  min-width: 0;\n}\n\n.command-menu-item-name {\n  font-size: 0.875rem;\n  font-weight: 500;\n  color: var(--foreground);\n}\n\n.command-menu-item:hover .command-menu-item-name,\n.command-menu-item-selected .command-menu-item-name {\n  color: var(--primary-foreground);\n}\n\n.command-menu-item-description {\n  font-size: 0.75rem;\n  color: var(--muted-foreground);\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n\n.command-menu-item:hover .command-menu-item-description,\n.command-menu-item-selected .command-menu-item-description {\n  color: hsl(var(--primary-foreground) / 0.7);\n}\n\n/* ======================================\n   Bubble Menu Styles\n   ====================================== */\n\n.bubble-menu {\n  display: flex;\n  align-items: center;\n  gap: 0.125rem;\n  background-color: var(--popover);\n  border: 1px solid var(--border);\n  border-radius: 0.5rem;\n  box-shadow: 0 4px 20px -4px hsl(var(--foreground) / 0.15);\n  padding: 0.25rem;\n  animation: bubble-menu-appear 0.1s ease-out;\n}\n\n@keyframes bubble-menu-appear {\n  from {\n    opacity: 0;\n    transform: translateY(4px) scale(0.96);\n  }\n  to {\n    opacity: 1;\n    transform: translateY(0) scale(1);\n  }\n}\n\n.bubble-menu-divider {\n  width: 1px;\n  height: 1.25rem;\n  background-color: var(--border);\n  margin: 0 0.25rem;\n}\n\n.bubble-menu-link-input {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  padding: 0.25rem;\n}\n\n.bubble-menu-link-input input {\n  min-width: 200px;\n  padding: 0.375rem 0.5rem;\n  font-size: 0.875rem;\n  border: 1px solid var(--border);\n  border-radius: 0.25rem;\n  background-color: var(--background);\n  color: var(--foreground);\n  outline: none;\n}\n\n.bubble-menu-link-input input:focus {\n  border-color: var(--ring);\n}\n\n.bubble-menu-link-submit,\n.bubble-menu-link-cancel {\n  padding: 0.375rem 0.75rem;\n  font-size: 0.75rem;\n  font-weight: 500;\n  border: none;\n  border-radius: 0.25rem;\n  cursor: pointer;\n  transition: background-color 0.15s ease;\n}\n\n.bubble-menu-link-submit {\n  background-color: var(--primary);\n  color: var(--primary-foreground);\n}\n\n.bubble-menu-link-submit:hover {\n  opacity: 0.9;\n}\n\n.bubble-menu-link-cancel {\n  background-color: var(--muted);\n  color: var(--muted-foreground);\n}\n\n.bubble-menu-link-cancel:hover {\n  background-color: var(--accent);\n}\n\n/* ======================================\n   Enhanced Code Block Styles\n   ====================================== */\n\n.code-block-wrapper {\n  position: relative;\n  margin: 1rem 0;\n  border-radius: 0.5rem;\n  overflow: hidden;\n  background-color: var(--muted);\n}\n\n.code-block-header {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: 0.5rem 0.75rem;\n  background-color: color-mix(in oklch, var(--muted) 100%, black 5%);\n  border-bottom: 1px solid var(--border);\n}\n\n.dark .code-block-header {\n  background-color: color-mix(in oklch, var(--muted) 100%, white 5%);\n}\n\n.code-block-language-container {\n  position: relative;\n}\n\n.code-block-language-button {\n  display: flex;\n  align-items: center;\n  gap: 0.375rem;\n  padding: 0.25rem 0.5rem;\n  font-size: 0.75rem;\n  font-weight: 500;\n  color: var(--muted-foreground);\n  background: none;\n  border: none;\n  border-radius: 0.25rem;\n  cursor: pointer;\n  transition:\n    background-color 0.15s ease,\n    color 0.15s ease;\n}\n\n.code-block-language-button:hover {\n  background-color: var(--accent);\n  color: var(--foreground);\n}\n\n.code-block-language-dropdown {\n  position: absolute;\n  top: 100%;\n  left: 0;\n  z-index: 50;\n  margin-top: 0.25rem;\n  min-width: 150px;\n  max-height: 250px;\n  overflow-y: auto;\n  background-color: var(--popover);\n  border: 1px solid var(--border);\n  border-radius: 0.5rem;\n  box-shadow: 0 10px 40px -10px hsl(var(--foreground) / 0.2);\n  padding: 0.25rem;\n}\n\n.code-block-language-option {\n  display: block;\n  width: 100%;\n  padding: 0.375rem 0.5rem;\n  font-size: 0.75rem;\n  text-align: left;\n  color: var(--foreground);\n  background: none;\n  border: none;\n  border-radius: 0.25rem;\n  cursor: pointer;\n  transition: background-color 0.15s ease;\n}\n\n.code-block-language-option:hover {\n  background-color: var(--primary);\n  color: var(--primary-foreground);\n}\n\n.code-block-language-option-active {\n  background-color: var(--primary);\n  color: var(--primary-foreground);\n}\n\n.code-block-language-option-active:hover {\n  background-color: var(--primary);\n  opacity: 0.9;\n}\n\n.code-block-copy-button {\n  display: flex;\n  align-items: center;\n  gap: 0.375rem;\n  padding: 0.25rem 0.5rem;\n  font-size: 0.75rem;\n  font-weight: 500;\n  color: var(--muted-foreground);\n  background: none;\n  border: none;\n  border-radius: 0.25rem;\n  cursor: pointer;\n  transition:\n    background-color 0.15s ease,\n    color 0.15s ease;\n}\n\n.code-block-copy-button:hover {\n  background-color: var(--accent);\n  color: var(--foreground);\n}\n\n/* Language label for view mode (non-interactive) */\n.code-block-language-label {\n  font-size: 0.75rem;\n  font-weight: 500;\n  color: var(--muted-foreground);\n  padding: 0.25rem 0.5rem;\n}\n\n.code-block-wrapper pre {\n  margin: 0;\n  padding: 1rem;\n  overflow-x: auto;\n  overflow-y: auto;\n  max-height: var(--code-block-max-height, none);\n  font-family: ui-monospace, SFMono-Regular, 'SF Mono', Menlo, Consolas, monospace;\n  font-size: 0.875rem;\n  line-height: 1.6;\n}\n\n.code-block-wrapper pre code {\n  background: none;\n  padding: 0;\n  border-radius: 0;\n  font-size: inherit;\n}\n\n/* ======================================\n   Fixed Toolbar Styles\n   ====================================== */\n\n.toolbar {\n  display: flex;\n  align-items: center;\n  flex-wrap: wrap;\n  gap: 0.125rem;\n  padding: 0.5rem;\n  background-color: var(--background);\n  border-bottom: 1px solid var(--border);\n  position: sticky;\n  top: 0;\n  z-index: 10;\n}\n\n.toolbar-divider {\n  width: 1px;\n  height: 1.5rem;\n  background-color: var(--border);\n  margin: 0 0.375rem;\n}\n\n/* Editor with toolbar wrapper */\n.editor-with-toolbar {\n  display: flex;\n  flex-direction: column;\n  border: 1px solid var(--border);\n  border-radius: var(--radius);\n  overflow: hidden;\n  background-color: var(--background);\n}\n\n.editor-with-toolbar .rich-text-editor {\n  border: none;\n  border-radius: 0;\n}\n\n/* ======================================\n   File Attachment Styles\n   ====================================== */\n\n/* Block/Card mode - displays as a card */\n.file-attachment-block-wrapper {\n  display: flex;\n  margin: 0.75rem 0;\n  width: 100%;\n}\n\n.file-attachment-block {\n  user-select: none;\n}\n\n/* Selection state for block mode */\n.file-attachment-block-wrapper .ProseMirror-selectednode,\n.file-attachment-block-wrapper:has(.ProseMirror-selectednode) .file-attachment-block {\n  outline: 2px solid var(--primary);\n  outline-offset: 2px;\n  border-radius: 0.5rem;\n}\n\n/* Inline mode - displays inline with text, properly aligned */\n.file-attachment-inline-wrapper {\n  display: inline;\n  line-height: 1;\n}\n\n.file-attachment-inline {\n  user-select: none;\n  /* Vertical alignment fix - align to text baseline */\n  vertical-align: baseline;\n  position: relative;\n  top: 0.125em; /* Fine-tune alignment with text */\n  line-height: 1.4;\n}\n\n/* Selection state for inline mode */\n.file-attachment-inline-wrapper .ProseMirror-selectednode,\n.file-attachment-inline:has(.ProseMirror-selectednode) {\n  outline: 2px solid var(--primary);\n  outline-offset: 1px;\n  border-radius: 0.375rem;\n}\n\n/* Uploading state */\n.file-attachment-uploading {\n  opacity: 0.6;\n  position: relative;\n  overflow: hidden;\n}\n\n.file-attachment-uploading::after {\n  content: '';\n  position: absolute;\n  inset: 0;\n  background: linear-gradient(90deg, transparent 0%, rgba(var(--primary), 0.1) 50%, transparent 100%);\n  animation: file-attachment-shimmer 1.5s infinite;\n}\n\n@keyframes file-attachment-shimmer {\n  0% {\n    transform: translateX(-100%);\n  }\n  100% {\n    transform: translateX(100%);\n  }\n}\n\n/* Preview thumbnail */\n.file-attachment-preview img {\n  object-fit: cover;\n}\n\n/* Drag handle cursor for block mode */\n.file-attachment-block-wrapper[data-drag-handle] {\n  cursor: grab;\n}\n\n.file-attachment-block-wrapper[data-drag-handle]:active {\n  cursor: grabbing;\n}\n\n/* ======================================\n   Image Resize Handle Styles\n   ====================================== */\n\n.image-resize-handle {\n  z-index: 10;\n}\n\n.image-resize-handle-inner {\n  width: 10px;\n  height: 10px;\n  border-right: 2px solid var(--primary);\n  border-bottom: 2px solid var(--primary);\n  border-radius: 0 0 3px 0;\n  transition:\n    transform 0.15s ease,\n    border-color 0.15s ease;\n  box-shadow: 1px 1px 2px hsl(var(--background) / 0.8);\n}\n\n.image-resize-handle:hover .image-resize-handle-inner {\n  transform: scale(1.2);\n}\n\n.image-resize-handle-active .image-resize-handle-inner {\n  transform: scale(1.3);\n  border-color: var(--primary);\n}\n\n/* Image container during resize */\n.file-attachment-image-container.resizing {\n  outline: 2px solid var(--primary);\n  outline-offset: 2px;\n}\n\n/* ======================================\n   File Attachment Menu Styles\n   ====================================== */\n\n.file-attachment-menu {\n  animation: file-attachment-menu-appear 0.15s ease-out;\n}\n\n@keyframes file-attachment-menu-appear {\n  from {\n    opacity: 0;\n    transform: translateX(-50%) translateY(4px) scale(0.96);\n  }\n  to {\n    opacity: 1;\n    transform: translateX(-50%) translateY(0) scale(1);\n  }\n}\n\n/* File preview dialog animations */\n@keyframes file-preview-fade-in {\n  from {\n    opacity: 0;\n  }\n  to {\n    opacity: 1;\n  }\n}\n\n@keyframes file-preview-zoom-in {\n  from {\n    opacity: 0;\n    transform: scale(0.95);\n  }\n  to {\n    opacity: 1;\n    transform: scale(1);\n  }\n}\n\n/* ======================================\n   Mention Styles\n   ====================================== */\n\n/* Mention wrapper (inline) */\n.mention-wrapper {\n  display: inline;\n}\n\n.mention {\n  /* Use middle alignment and offset to match text baseline */\n  vertical-align: middle;\n  margin-top: -0.125em;\n  margin-bottom: -0.125em;\n}\n\n.mention img {\n  vertical-align: middle;\n}\n\n/* Mention List (Dropdown) */\n.mention-list {\n  background-color: var(--popover);\n  border: 1px solid var(--border);\n  border-radius: 0.5rem;\n  box-shadow: 0 4px 20px -4px hsl(var(--foreground) / 0.15);\n  max-height: 280px;\n  overflow-y: auto;\n  padding: 0.25rem;\n  min-width: 200px;\n}\n\n.mention-list-item {\n  display: flex;\n  align-items: center;\n  gap: 0.625rem;\n  width: 100%;\n  padding: 0.5rem 0.75rem;\n  border-radius: 0.375rem;\n  background: transparent;\n  border: none;\n  cursor: pointer;\n  text-align: left;\n  transition:\n    background-color 0.15s ease,\n    color 0.15s ease;\n  color: var(--foreground);\n  font-size: 0.875rem;\n}\n\n.mention-list-item:hover,\n.mention-list-item.is-selected {\n  background-color: var(--primary);\n  color: var(--primary-foreground);\n}\n\n.mention-list-loading,\n.mention-list-empty {\n  padding: 1rem;\n  text-align: center;\n  color: var(--muted-foreground);\n  font-size: 0.875rem;\n}\n\n/* Tippy.js animation for mention dropdown */\n.tippy-box[data-animation='shift-away'][data-state='hidden'] {\n  opacity: 0;\n}\n\n.tippy-box[data-animation='shift-away'][data-state='hidden'][data-placement^='top'] {\n  transform: translateY(8px);\n}\n\n.tippy-box[data-animation='shift-away'][data-state='hidden'][data-placement^='bottom'] {\n  transform: translateY(-8px);\n}\n\n.tippy-box[data-animation='shift-away'][data-state='hidden'][data-placement^='left'] {\n  transform: translateX(8px);\n}\n\n.tippy-box[data-animation='shift-away'][data-state='hidden'][data-placement^='right'] {\n  transform: translateX(-8px);\n}\n\n/* Remove default tippy styling */\n.tippy-box {\n  background-color: transparent;\n  border: none;\n  box-shadow: none;\n}\n\n.tippy-content {\n  padding: 0;\n}\n\n/* ======================================\n   Table Styles\n   ====================================== */\n\n/* Table wrapper (edit mode - ProseMirror creates this div via NodeView) */\n.tiptap .tableWrapper {\n  margin: 1.5rem 0 2rem 0;\n  overflow-x: auto;\n  border-radius: 0.5rem;\n  background-color: var(--background);\n  transition: box-shadow 0.15s ease;\n}\n\n/* Table wrapper alignment */\n.tiptap .tableWrapper[data-alignment='center'] {\n  margin-left: auto;\n  margin-right: auto;\n}\n\n.tiptap .tableWrapper[data-alignment='right'] {\n  margin-left: auto;\n  margin-right: 0;\n}\n\n/* Main table */\n.tiptap table {\n  border-collapse: collapse;\n  width: 100%;\n  margin: 0;\n}\n\n/* Table cells - both td and th */\n.tiptap td,\n.tiptap th {\n  border: 1px solid var(--border);\n  box-sizing: border-box;\n  min-width: 100px;\n  padding: 0.75rem 1rem;\n  position: relative;\n  vertical-align: top;\n  text-align: left;\n  background-color: var(--background);\n  transition: background-color 0.1s ease;\n}\n\n/* Header cells */\n.tiptap th {\n  background-color: var(--muted);\n  font-weight: 600;\n  color: var(--foreground);\n  font-size: 0.875rem;\n  text-transform: none;\n  letter-spacing: 0;\n}\n\n/* Remove margins from content inside cells */\n.tiptap td > *,\n.tiptap th > * {\n  margin: 0;\n}\n\n/* Paragraph inside cells */\n.tiptap td p,\n.tiptap th p {\n  margin: 0;\n  line-height: 1.5;\n}\n\n/* Selected cell highlight */\n.tiptap .selectedCell::after {\n  background-color: hsl(var(--primary) / 0.1);\n  content: '';\n  left: 0;\n  right: 0;\n  top: 0;\n  bottom: 0;\n  pointer-events: none;\n  position: absolute;\n  z-index: 2;\n}\n\n/* Column resize handle */\n.tiptap .column-resize-handle {\n  background-color: var(--primary);\n  bottom: 0;\n  pointer-events: none;\n  position: absolute;\n  right: -1px;\n  top: 0;\n  width: 3px;\n  z-index: 20;\n}\n\n/* Resize cursor state */\n.tiptap.resize-cursor {\n  cursor: col-resize;\n}\n\n/* Hover effect on cells in edit mode */\n.rich-text-editor[data-editable='true'] .tiptap td:hover {\n  background-color: hsl(var(--accent) / 0.5);\n}\n\n.rich-text-editor[data-editable='true'] .tiptap th:hover {\n  background-color: color-mix(in oklch, var(--muted) 100%, var(--foreground) 4%);\n}\n\n/* First/last cell border radius */\n.tiptap table tr:first-child th:first-child,\n.tiptap table tr:first-child td:first-child {\n  border-top-left-radius: 0.375rem;\n}\n\n.tiptap table tr:first-child th:last-child,\n.tiptap table tr:first-child td:last-child {\n  border-top-right-radius: 0.375rem;\n}\n\n.tiptap table tr:last-child td:first-child,\n.tiptap table tr:last-child th:first-child {\n  border-bottom-left-radius: 0.375rem;\n}\n\n.tiptap table tr:last-child td:last-child,\n.tiptap table tr:last-child th:last-child {\n  border-bottom-right-radius: 0.375rem;\n}\n\n/* Dark mode adjustments */\n.dark .tiptap th {\n  background-color: var(--muted);\n}\n\n.dark .tiptap td {\n  background-color: var(--background);\n}\n\n.dark .rich-text-editor[data-editable='true'] .tiptap th:hover {\n  background-color: color-mix(in oklch, var(--muted) 100%, var(--foreground) 6%);\n}\n\n/* ======================================\n   Table Controls - Enterprise Style\n   ====================================== */\n\n.table-controls {\n  pointer-events: none;\n}\n\n.table-controls > * {\n  pointer-events: auto;\n}\n\n/* Row handle on the left side */\n.table-row-handle {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 28px;\n  z-index: 40;\n}\n\n.table-row-handle-button {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 20px;\n  height: 28px;\n  border-radius: 4px;\n  color: var(--muted-foreground);\n  background: transparent;\n  border: none;\n  cursor: pointer;\n  opacity: 0;\n  transition: all 0.15s ease;\n}\n\n.table-row-handle:hover .table-row-handle-button,\n.table-row-handle-active .table-row-handle-button {\n  opacity: 1;\n  background-color: var(--muted);\n  color: var(--foreground);\n}\n\n/* Column handle at top */\n.table-col-handle {\n  z-index: 40;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n}\n\n.table-col-add-button {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 20px;\n  height: 20px;\n  border-radius: 50%;\n  background-color: var(--primary);\n  color: var(--primary-foreground);\n  border: none;\n  cursor: pointer;\n  opacity: 0;\n  transition: all 0.15s ease;\n  box-shadow: 0 2px 8px hsl(var(--primary) / 0.25);\n}\n\n.table-col-handle:hover .table-col-add-button,\n.table-col-handle-active .table-col-add-button {\n  opacity: 1;\n}\n\n.table-col-add-button:hover {\n  transform: scale(1.1);\n  box-shadow: 0 4px 12px hsl(var(--primary) / 0.35);\n}\n\n.table-col-line {\n  position: absolute;\n  top: 20px;\n  left: 50%;\n  transform: translateX(-50%);\n  width: 2px;\n  background-color: var(--primary);\n  border-radius: 1px;\n  opacity: 0;\n  transition: opacity 0.15s ease;\n}\n\n.table-col-handle:hover .table-col-line,\n.table-col-handle-active .table-col-line {\n  opacity: 1;\n}\n\n/* Table options button - top left */\n.table-options-button {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 24px;\n  height: 24px;\n  border-radius: 6px;\n  background-color: var(--popover);\n  border: 1px solid var(--border);\n  color: var(--muted-foreground);\n  cursor: pointer;\n  opacity: 0;\n  transition: all 0.15s ease;\n  z-index: 40;\n}\n\n.table-controls:hover .table-options-button {\n  opacity: 1;\n}\n\n.table-options-button:hover {\n  background-color: var(--accent);\n  color: var(--foreground);\n  border-color: var(--primary);\n}\n\n/* Resize handle - bottom right corner */\n.table-resize-handle {\n  width: 24px;\n  height: 24px;\n  cursor: se-resize;\n  z-index: 40;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  opacity: 0;\n  transition: opacity 0.15s ease;\n}\n\n.table-controls:hover .table-resize-handle,\n.table-resize-handle-active {\n  opacity: 1;\n}\n\n.table-resize-handle-inner {\n  width: 10px;\n  height: 10px;\n  border-right: 2px solid var(--primary);\n  border-bottom: 2px solid var(--primary);\n  border-radius: 0 0 3px 0;\n  transition:\n    transform 0.15s ease,\n    border-color 0.15s ease;\n}\n\n.table-resize-handle:hover .table-resize-handle-inner {\n  transform: scale(1.2);\n}\n\n.table-resize-handle-active .table-resize-handle-inner {\n  transform: scale(1.3);\n  border-color: var(--primary);\n}\n\n/* Table wrapper during resize */\n.tiptap .tableWrapper.resizing {\n  outline: 2px solid var(--primary);\n  outline-offset: 2px;\n  transition: none !important;\n  overflow: hidden !important;\n}\n\n.tiptap .tableWrapper.resizing table {\n  transition: none !important;\n}\n\n.tiptap .tableWrapper.resizing td,\n.tiptap .tableWrapper.resizing th {\n  transition: none !important;\n}\n\n/* Add row button at bottom */\n.table-add-row-bottom {\n  display: flex;\n  justify-content: center;\n  opacity: 0;\n  transition: opacity 0.15s ease;\n  z-index: 40;\n}\n\n.table-controls:hover .table-add-row-bottom {\n  opacity: 1;\n}\n\n.table-add-row-bottom-button {\n  display: flex;\n  align-items: center;\n  gap: 6px;\n  padding: 6px 12px;\n  font-size: 12px;\n  font-weight: 500;\n  color: var(--muted-foreground);\n  background-color: var(--popover);\n  border: 1px solid var(--border);\n  border-radius: 6px;\n  cursor: pointer;\n  transition: all 0.15s ease;\n}\n\n.table-add-row-bottom-button:hover {\n  background-color: var(--accent);\n  color: var(--foreground);\n  border-color: var(--primary);\n}\n\n/* Dropdown menus */\n.table-control-dropdown {\n  position: absolute;\n  min-width: 150px;\n  background-color: var(--popover);\n  border: 1px solid var(--border);\n  border-radius: 8px;\n  box-shadow: 0 8px 30px -8px hsl(var(--foreground) / 0.2);\n  padding: 4px;\n  z-index: 60;\n  animation: table-dropdown-appear 0.12s ease-out;\n}\n\n.table-row-dropdown {\n  top: 0;\n  left: calc(100% + 4px);\n}\n\n.table-col-dropdown {\n  top: calc(100% + 8px);\n  left: 50%;\n  transform: translateX(-50%);\n}\n\n@keyframes table-dropdown-appear {\n  from {\n    opacity: 0;\n    transform: scale(0.95);\n  }\n  to {\n    opacity: 1;\n    transform: scale(1);\n  }\n}\n\n.table-control-dropdown-item {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  width: 100%;\n  padding: 8px 10px;\n  font-size: 13px;\n  color: var(--foreground);\n  background: none;\n  border: none;\n  border-radius: 6px;\n  cursor: pointer;\n  text-align: left;\n  transition: background-color 0.15s ease;\n}\n\n.table-control-dropdown-item:hover {\n  background-color: var(--primary);\n  color: var(--primary-foreground);\n}\n\n.table-control-dropdown-item-danger {\n  color: var(--destructive);\n}\n\n.table-control-dropdown-item-danger:hover {\n  background-color: hsl(var(--destructive) / 0.1);\n}\n\n.table-control-dropdown-divider {\n  height: 1px;\n  background-color: var(--border);\n  margin: 4px 8px;\n}\n\n/* Floating table menu */\n.table-floating-menu {\n  display: flex;\n  align-items: center;\n  gap: 2px;\n  padding: 6px;\n  background-color: var(--popover);\n  border: 1px solid var(--border);\n  border-radius: 8px;\n  box-shadow: 0 4px 20px -4px hsl(var(--foreground) / 0.15);\n  animation: table-floating-menu-appear 0.15s ease-out;\n}\n\n@keyframes table-floating-menu-appear {\n  from {\n    opacity: 0;\n    transform: translateX(-50%) translateY(4px) scale(0.95);\n  }\n  to {\n    opacity: 1;\n    transform: translateX(-50%) translateY(0) scale(1);\n  }\n}\n\n.table-menu-section {\n  display: flex;\n  align-items: center;\n  gap: 2px;\n}\n\n.table-menu-divider {\n  width: 1px;\n  height: 20px;\n  background-color: var(--border);\n  margin: 0 4px;\n}\n\n/* ======================================\n   Callout Styles\n   ====================================== */\n\n.callout-wrapper {\n  display: flex;\n  gap: 0.75rem;\n  padding: 1rem;\n  margin: 1rem 0;\n  border-radius: 0.5rem;\n  border: 1px solid var(--border);\n  background-color: var(--muted);\n  overflow: visible;\n  position: relative;\n}\n\n.callout-icon-container {\n  flex-shrink: 0;\n  display: flex;\n  align-items: flex-start;\n  padding-top: 0.125rem;\n  position: relative;\n  z-index: 1;\n}\n\n.callout-type-selector {\n  position: relative;\n  z-index: 50;\n}\n\n.callout-type-button {\n  display: flex;\n  align-items: center;\n  gap: 0.125rem;\n  padding: 0.25rem;\n  background: transparent;\n  border: none;\n  border-radius: 0.375rem;\n  cursor: pointer;\n  transition: background-color 0.15s ease;\n}\n\n.callout-type-button:hover {\n  background-color: var(--accent);\n  color: var(--foreground);\n}\n\n.callout-type-chevron {\n  opacity: 0.5;\n}\n\n.callout-type-dropdown {\n  position: fixed;\n  z-index: 9999;\n  min-width: 140px;\n  background-color: var(--popover);\n  border: 1px solid var(--border);\n  border-radius: 0.5rem;\n  box-shadow: 0 10px 40px -10px hsl(var(--foreground) / 0.2);\n  padding: 0.25rem;\n  animation: callout-dropdown-appear 0.12s ease-out;\n}\n\n@keyframes callout-dropdown-appear {\n  from {\n    opacity: 0;\n    transform: translateY(-4px) scale(0.96);\n  }\n  to {\n    opacity: 1;\n    transform: translateY(0) scale(1);\n  }\n}\n\n.callout-type-option {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  width: 100%;\n  padding: 0.5rem 0.625rem;\n  font-size: 0.8125rem;\n  text-align: left;\n  color: var(--foreground);\n  background: none;\n  border: none;\n  border-radius: 0.375rem;\n  cursor: pointer;\n  transition: background-color 0.15s ease;\n}\n\n.callout-type-option:hover {\n  background-color: var(--primary);\n  color: var(--primary-foreground);\n}\n\n.callout-type-option-active {\n  background-color: var(--primary);\n  color: var(--primary-foreground);\n}\n\n.callout-type-option-active:hover {\n  background-color: var(--primary);\n  opacity: 0.9;\n}\n\n.callout-content {\n  flex: 1;\n  min-width: 0;\n}\n\n.callout-content > * {\n  margin: 0;\n}\n\n.callout-content p {\n  margin: 0;\n}\n\n/* ======================================\n   Toggle (Expandable) Styles\n   ====================================== */\n\n.toggle-wrapper {\n  margin: 0.5rem 0;\n}\n\n.toggle-header {\n  display: flex;\n  align-items: center;\n  gap: 0.25rem;\n}\n\n.toggle-button {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 1.25rem;\n  height: 1.25rem;\n  padding: 0;\n  background: transparent;\n  border: none;\n  border-radius: 0.25rem;\n  cursor: pointer;\n  color: var(--muted-foreground);\n  transition:\n    background-color 0.15s ease,\n    color 0.15s ease;\n  flex-shrink: 0;\n}\n\n.toggle-button:hover {\n  background-color: var(--accent);\n  color: var(--foreground);\n}\n\n.toggle-chevron {\n  transition: transform 0.15s ease;\n}\n\n.toggle-button-open .toggle-chevron {\n  transform: rotate(90deg);\n}\n\n.toggle-title-input {\n  flex: 1;\n  min-width: 0;\n  padding: 0.125rem 0.25rem;\n  font-size: 1rem;\n  font-weight: 500;\n  color: var(--foreground);\n  background-color: transparent;\n  border: none;\n  border-radius: 0.25rem;\n  outline: none;\n}\n\n.toggle-title-input:focus {\n  background-color: var(--muted);\n}\n\n.toggle-title-input::placeholder {\n  color: var(--muted-foreground);\n  font-weight: 400;\n}\n\n.toggle-title {\n  flex: 1;\n  font-size: 1rem;\n  font-weight: 500;\n  color: var(--foreground);\n  cursor: pointer;\n}\n\n.toggle-content {\n  display: grid;\n  grid-template-rows: 1fr;\n  transition: grid-template-rows 0.15s ease;\n}\n\n.toggle-content-collapsed {\n  grid-template-rows: 0fr;\n}\n\n.toggle-content-inner {\n  overflow: hidden;\n  padding-left: 1.5rem;\n  color: var(--muted-foreground);\n}\n\n.toggle-content-inner > *:first-child {\n  margin-top: 0.375rem;\n}\n\n.toggle-content-inner > *:last-child {\n  margin-bottom: 0.25rem;\n}\n\n.toggle-content-inner p {\n  margin: 0;\n}\n",
      "type": "registry:component"
    },
    {
      "path": "src/components/ui/editor/extensions/index.ts",
      "content": "import { StarterKit } from '@tiptap/starter-kit'\nimport { Placeholder } from '@tiptap/extension-placeholder'\nimport { Image } from '@tiptap/extension-image'\nimport { Link } from '@tiptap/extension-link'\nimport { TaskList } from '@tiptap/extension-task-list'\nimport { TaskItem } from '@tiptap/extension-task-item'\nimport { Typography } from '@tiptap/extension-typography'\nimport { Underline } from '@tiptap/extension-underline'\nimport { TextAlign } from '@tiptap/extension-text-align'\nimport { Highlight } from '@tiptap/extension-highlight'\nimport { TextStyle } from '@tiptap/extension-text-style'\nimport { Color } from '@tiptap/extension-color'\nimport { EnhancedCodeBlock } from './code-block'\nimport { tableExtensions } from './table'\nimport { Callout } from './callout'\nimport { Toggle } from './toggle'\nimport type { CalloutTypeConfig } from '../types'\n\nexport interface ExtensionOptions {\n  placeholder?: string\n  calloutTypes?: CalloutTypeConfig[]\n}\n\nexport function createExtensions(options: ExtensionOptions = {}) {\n  return [\n    StarterKit.configure({\n      codeBlock: false, // We use EnhancedCodeBlock instead\n      heading: {\n        levels: [1, 2, 3],\n      },\n    }),\n    Placeholder.configure({\n      placeholder: options.placeholder || \"Type '/' for commands...\",\n      emptyEditorClass: 'is-editor-empty',\n      emptyNodeClass: 'is-node-empty',\n    }),\n    Image.configure({\n      inline: false,\n      allowBase64: true,\n      HTMLAttributes: {\n        class: 'editor-image',\n      },\n    }),\n    Link.configure({\n      openOnClick: false,\n      autolink: true,\n      defaultProtocol: 'https',\n      HTMLAttributes: {\n        class: 'editor-link',\n      },\n    }),\n    TaskList.configure({\n      HTMLAttributes: {\n        class: 'editor-task-list',\n      },\n    }),\n    TaskItem.configure({\n      nested: true,\n      HTMLAttributes: {\n        class: 'editor-task-item',\n      },\n    }),\n    EnhancedCodeBlock,\n    Typography,\n    Underline,\n    TextAlign.configure({\n      types: ['heading', 'paragraph'],\n    }),\n    Highlight.configure({\n      multicolor: true,\n    }),\n    TextStyle,\n    Color,\n    ...tableExtensions,\n    Callout.configure({\n      calloutTypes: options.calloutTypes,\n    }),\n    Toggle,\n  ]\n}\n",
      "type": "registry:component"
    },
    {
      "path": "src/components/ui/editor/extensions/code-block.ts",
      "content": "import { CodeBlockLowlight } from '@tiptap/extension-code-block-lowlight'\nimport { common, createLowlight } from 'lowlight'\nimport { ReactNodeViewRenderer } from '@tiptap/react'\nimport { CodeBlockComponent } from '../code-block'\n\n// Create lowlight instance with common languages\nconst lowlight = createLowlight(common)\n\n/**\n * Enhanced CodeBlock extension with:\n * - Language selector dropdown\n * - Copy code button\n * - Syntax highlighting via lowlight\n */\nexport const EnhancedCodeBlock = CodeBlockLowlight.extend({\n  addNodeView() {\n    return ReactNodeViewRenderer(CodeBlockComponent)\n  },\n}).configure({\n  lowlight,\n  HTMLAttributes: {\n    class: 'editor-code-block',\n  },\n})\n",
      "type": "registry:component"
    },
    {
      "path": "src/components/ui/editor/extensions/slash-commands.ts",
      "content": "import { Extension } from '@tiptap/core'\nimport { Suggestion } from '@tiptap/suggestion'\nimport { PluginKey } from '@tiptap/pm/state'\nimport type { SlashCommand } from '../types'\nimport type { Editor, Range } from '@tiptap/core'\n\nconst slashCommandsPluginKey = new PluginKey('slashCommands')\n\nexport interface SlashCommandsOptions {\n  suggestion: {\n    char?: string\n    startOfLine?: boolean\n    items: (props: { query: string; editor: Editor }) => SlashCommand[]\n    command: (props: { editor: Editor; range: Range; props: SlashCommand }) => void\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    render: () => any\n  }\n}\n\nexport const SlashCommands = Extension.create<SlashCommandsOptions>({\n  name: 'slashCommands',\n\n  addOptions() {\n    return {\n      suggestion: {\n        char: '/',\n        startOfLine: true,\n        items: () => [],\n        command: ({ editor, range, props }) => {\n          // Delete the slash and query text\n          editor.chain().focus().deleteRange(range).run()\n          // Execute the command action\n          props.action(editor)\n        },\n        render: () => ({\n          onStart: () => {},\n          onUpdate: () => {},\n          onKeyDown: () => false,\n          onExit: () => {},\n        }),\n      },\n    }\n  },\n\n  addProseMirrorPlugins() {\n    return [\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      Suggestion({\n        editor: this.editor,\n        pluginKey: slashCommandsPluginKey,\n        ...this.options.suggestion,\n      } as any),\n    ]\n  },\n})\n",
      "type": "registry:component"
    },
    {
      "path": "src/components/ui/editor/extensions/callout.ts",
      "content": "import { Node, mergeAttributes } from '@tiptap/core'\nimport { ReactNodeViewRenderer } from '@tiptap/react'\nimport { CalloutComponent } from '../callout'\nimport type { CalloutTypeConfig } from '../types'\n\nexport interface CalloutOptions {\n  HTMLAttributes: Record<string, unknown>\n  calloutTypes?: CalloutTypeConfig[]\n}\n\ndeclare module '@tiptap/core' {\n  interface Commands<ReturnType> {\n    callout: {\n      setCallout: (attributes?: { type?: string }) => ReturnType\n      toggleCallout: (attributes?: { type?: string }) => ReturnType\n    }\n  }\n}\n\nexport const Callout = Node.create<CalloutOptions>({\n  name: 'callout',\n\n  group: 'block',\n\n  content: 'block+',\n\n  defining: true,\n\n  addOptions() {\n    return {\n      HTMLAttributes: {},\n      calloutTypes: undefined,\n    }\n  },\n\n  addAttributes() {\n    return {\n      type: {\n        default: 'info',\n        parseHTML: (element) => element.getAttribute('data-callout-type') || 'info',\n        renderHTML: (attributes) => ({\n          'data-callout-type': attributes.type,\n        }),\n      },\n    }\n  },\n\n  parseHTML() {\n    return [\n      {\n        tag: 'div[data-callout]',\n      },\n    ]\n  },\n\n  renderHTML({ HTMLAttributes }) {\n    return [\n      'div',\n      mergeAttributes(this.options.HTMLAttributes, HTMLAttributes, {\n        'data-callout': '',\n        class: 'callout-block',\n      }),\n      0,\n    ]\n  },\n\n  addNodeView() {\n    return ReactNodeViewRenderer(CalloutComponent)\n  },\n\n  addCommands() {\n    return {\n      setCallout:\n        (attributes) =>\n        ({ commands }) => {\n          return commands.wrapIn(this.name, attributes)\n        },\n      toggleCallout:\n        (attributes) =>\n        ({ commands }) => {\n          return commands.toggleWrap(this.name, attributes)\n        },\n    }\n  },\n\n  addKeyboardShortcuts() {\n    return {\n      'Mod-Shift-c': () => this.editor.commands.toggleCallout(),\n    }\n  },\n})\n",
      "type": "registry:component"
    },
    {
      "path": "src/components/ui/editor/extensions/toggle.ts",
      "content": "import { Node, mergeAttributes } from '@tiptap/core'\nimport { ReactNodeViewRenderer } from '@tiptap/react'\nimport { ToggleComponent } from '../toggle'\n\nexport interface ToggleOptions {\n  HTMLAttributes: Record<string, unknown>\n}\n\ndeclare module '@tiptap/core' {\n  interface Commands<ReturnType> {\n    toggle: {\n      setToggle: () => ReturnType\n    }\n  }\n}\n\nexport const Toggle = Node.create<ToggleOptions>({\n  name: 'toggle',\n\n  group: 'block',\n\n  content: 'block+',\n\n  defining: true,\n\n  addOptions() {\n    return {\n      HTMLAttributes: {},\n    }\n  },\n\n  addAttributes() {\n    return {\n      open: {\n        default: true,\n        parseHTML: (element) => element.getAttribute('data-open') !== 'false',\n        renderHTML: (attributes) => ({\n          'data-open': attributes.open ? 'true' : 'false',\n        }),\n      },\n      title: {\n        default: 'Toggle title',\n        parseHTML: (element) => element.getAttribute('data-title') || 'Toggle title',\n        renderHTML: (attributes) => ({\n          'data-title': attributes.title,\n        }),\n      },\n    }\n  },\n\n  parseHTML() {\n    return [\n      {\n        tag: 'div[data-toggle]',\n      },\n    ]\n  },\n\n  renderHTML({ HTMLAttributes }) {\n    return [\n      'div',\n      mergeAttributes(this.options.HTMLAttributes, HTMLAttributes, {\n        'data-toggle': '',\n        class: 'toggle-block',\n      }),\n      0,\n    ]\n  },\n\n  addNodeView() {\n    return ReactNodeViewRenderer(ToggleComponent)\n  },\n\n  addCommands() {\n    return {\n      setToggle:\n        () =>\n        ({ commands }) => {\n          return commands.insertContent({\n            type: this.name,\n            attrs: { open: true, title: 'Toggle title' },\n            content: [\n              {\n                type: 'paragraph',\n              },\n            ],\n          })\n        },\n    }\n  },\n})\n",
      "type": "registry:component"
    },
    {
      "path": "src/components/ui/editor/extensions/table.ts",
      "content": "import { Table } from '@tiptap/extension-table'\nimport { TableRow } from '@tiptap/extension-table-row'\nimport { TableHeader } from '@tiptap/extension-table-header'\nimport { TableCell } from '@tiptap/extension-table-cell'\nimport { mergeAttributes } from '@tiptap/react'\n\nexport type TableAlignment = 'left' | 'center' | 'right'\nexport type TableWidth = 'auto' | 'fixed' | 'full'\n\n// Extended table extension with alignment and width support\nexport const TableExtension = Table.extend({\n  addAttributes() {\n    return {\n      ...this.parent?.(),\n      alignment: {\n        default: 'left',\n        parseHTML: (element) => element.getAttribute('data-alignment') || 'left',\n        renderHTML: (attributes) => ({\n          'data-alignment': attributes.alignment,\n        }),\n      },\n      width: {\n        default: null,\n        parseHTML: (element) => {\n          const width = element.getAttribute('data-width')\n          return width ? parseInt(width, 10) : null\n        },\n        renderHTML: (attributes) => {\n          if (!attributes.width) return {}\n          return {\n            'data-width': attributes.width,\n            style: `width: ${attributes.width}px; max-width: 100%;`,\n          }\n        },\n      },\n    }\n  },\n\n  // Wrap table in a .tableWrapper div for view mode (read-only).\n  // In edit mode, ProseMirror's NodeView creates the wrapper instead.\n  renderHTML({ HTMLAttributes }) {\n    return [\n      'div',\n      { class: 'tableWrapper' },\n      ['table', mergeAttributes(this.options.HTMLAttributes, HTMLAttributes), ['tbody', 0]],\n    ]\n  },\n}).configure({\n  resizable: true,\n  HTMLAttributes: {\n    class: 'editor-table',\n  },\n})\n\n// Table row extension\nexport const TableRowExtension = TableRow.configure({\n  HTMLAttributes: {\n    class: 'editor-table-row',\n  },\n})\n\n// Override colwidth attribute to output inline width style in renderHTML.\n// By default, Tiptap stores colwidth as a data attribute but doesn't emit\n// style=\"width: \" in getHTML(). ProseMirror's NodeView handles widths via\n// <colgroup> in edit mode, but in view mode (no NodeView) we need inline styles.\nconst colwidthOverride = {\n  default: null,\n  parseHTML: (element: HTMLElement) => {\n    const colwidth = element.getAttribute('colwidth')\n    if (colwidth) {\n      return colwidth.split(',').map((w: string) => parseInt(w, 10))\n    }\n    // Fallback: try to read width from inline style\n    const style = element.style?.width\n    if (style && style.endsWith('px')) {\n      return [parseInt(style, 10)]\n    }\n    return null\n  },\n  renderHTML: (attributes: { colwidth?: number[] | null }) => {\n    if (!attributes.colwidth?.length) return {}\n    return {\n      colwidth: attributes.colwidth.join(','),\n      style: `width: ${attributes.colwidth[0]}px`,\n    }\n  },\n}\n\n// Table header cell extension with colwidth  inline width\nexport const TableHeaderExtension = TableHeader.extend({\n  addAttributes() {\n    return {\n      ...this.parent?.(),\n      colwidth: colwidthOverride,\n    }\n  },\n}).configure({\n  HTMLAttributes: {\n    class: 'editor-table-header',\n  },\n})\n\n// Table cell extension with colwidth  inline width\nexport const TableCellExtension = TableCell.extend({\n  addAttributes() {\n    return {\n      ...this.parent?.(),\n      colwidth: colwidthOverride,\n    }\n  },\n}).configure({\n  HTMLAttributes: {\n    class: 'editor-table-cell',\n  },\n})\n\n// Export all table extensions as an array\nexport const tableExtensions = [TableExtension, TableRowExtension, TableHeaderExtension, TableCellExtension]\n",
      "type": "registry:component"
    },
    {
      "path": "src/components/ui/editor/extensions/file-attachment.ts",
      "content": "import { Node, mergeAttributes } from '@tiptap/core'\nimport { ReactNodeViewRenderer } from '@tiptap/react'\nimport { FileAttachmentComponent } from '../file-attachment'\n\nexport type FileFetcher = (src: string, mimeType: string) => Promise<string | Blob>\n\n// Import preview options types\nexport interface CsvPreviewOptions {\n  maxRows?: number\n  maxColumns?: number\n  showRowNumbers?: boolean\n  headerRow?: boolean\n  delimiter?: ',' | ';' | '\\t' | '|' | 'auto'\n  stripWhitespace?: boolean\n  emptyValuePlaceholder?: string\n  maxCellWidth?: number\n  wrapText?: boolean\n  freezeHeader?: boolean\n  alternateRowColors?: boolean\n  formatCell?: (value: string, rowIndex: number, colIndex: number, header: string) => string\n  highlightColumns?: (number | string)[]\n}\n\nexport interface TextPreviewOptions {\n  maxChars?: number\n  maxLines?: number\n  showLineNumbers?: boolean\n  wordWrap?: boolean\n  fontSize?: number\n  tabSize?: number\n}\n\nexport interface ImagePreviewOptions {\n  maxWidth?: number\n  maxHeight?: number\n  allowZoom?: boolean\n  showMetadata?: boolean\n  transparentBackground?: 'checkerboard' | 'white' | 'black' | 'none'\n}\n\nexport interface PdfPreviewOptions {\n  showPageControls?: boolean\n}\n\nexport interface PreviewOptions {\n  csv?: CsvPreviewOptions\n  text?: TextPreviewOptions\n  image?: ImagePreviewOptions\n  pdf?: PdfPreviewOptions\n}\n\nexport type FileDeleteHandler = (src: string, name: string, mimeType: string) => void\n\nexport interface FileAttachmentOptions {\n  HTMLAttributes: Record<string, unknown>\n  /**\n   * Custom file fetcher for preview. Use this when files are stored behind\n   * authentication or need special handling to retrieve content.\n   */\n  onFetchFile?: FileFetcher\n  /**\n   * Preview customization options\n   */\n  previewOptions?: PreviewOptions\n  /**\n   * Callback when a file is deleted from the editor.\n   */\n  onFileDelete?: FileDeleteHandler\n}\n\nexport type FileDisplayMode = 'block' | 'inline'\nexport type FileAlignment = 'left' | 'center' | 'right'\n\ndeclare module '@tiptap/core' {\n  interface Commands<ReturnType> {\n    fileAttachment: {\n      /**\n       * Add a file attachment (inline - allows text before/after)\n       */\n      setFileAttachment: (attributes: {\n        src: string\n        name: string\n        size: number\n        mimeType: string\n        displayMode?: FileDisplayMode\n        alignment?: FileAlignment\n        width?: number\n      }) => ReturnType\n      /**\n       * Add a file attachment as a block (on its own line)\n       */\n      setFileAttachmentBlock: (attributes: {\n        src: string\n        name: string\n        size: number\n        mimeType: string\n        alignment?: FileAlignment\n        width?: number\n      }) => ReturnType\n      /**\n       * Update file attachment attributes\n       */\n      updateFileAttachment: (\n        attributes: Partial<{\n          displayMode: FileDisplayMode\n          alignment: FileAlignment\n          width: number\n        }>,\n      ) => ReturnType\n      /**\n       * Remove current file attachment\n       */\n      removeFileAttachment: () => ReturnType\n      /**\n       * Complete a file upload: find placeholder by uploadId, set src, clear uploading state\n       */\n      completeFileUpload: (uploadId: string, src: string) => ReturnType\n      /**\n       * Fail a file upload: find placeholder by uploadId and remove it\n       */\n      failFileUpload: (uploadId: string) => ReturnType\n    }\n  }\n}\n\nexport const FileAttachment = Node.create<FileAttachmentOptions>({\n  name: 'fileAttachment',\n\n  // Use inline group to allow text before/after\n  group: 'inline',\n\n  // This is an inline node\n  inline: true,\n\n  atom: true,\n\n  draggable: true,\n\n  addOptions() {\n    return {\n      HTMLAttributes: {},\n      onFetchFile: undefined,\n      previewOptions: undefined,\n      onFileDelete: undefined,\n    }\n  },\n\n  addStorage() {\n    return {\n      onFetchFile: this.options.onFetchFile,\n      previewOptions: this.options.previewOptions,\n      onFileDelete: this.options.onFileDelete,\n    }\n  },\n\n  addAttributes() {\n    return {\n      src: {\n        default: '',\n      },\n      name: {\n        default: '',\n      },\n      size: {\n        default: 0,\n      },\n      mimeType: {\n        default: '',\n      },\n      displayMode: {\n        default: 'inline',\n      },\n      alignment: {\n        default: 'left',\n      },\n      width: {\n        default: null, // null means auto/original size\n      },\n      uploading: {\n        default: false,\n        renderHTML: () => ({}),\n        parseHTML: () => false,\n      },\n      uploadId: {\n        default: null,\n        renderHTML: () => ({}),\n        parseHTML: () => null,\n      },\n    }\n  },\n\n  parseHTML() {\n    return [\n      {\n        tag: 'span[data-file-attachment]',\n      },\n      // Also parse div for backwards compatibility\n      {\n        tag: 'div[data-file-attachment]',\n      },\n    ]\n  },\n\n  renderHTML({ HTMLAttributes }) {\n    return [\n      'span',\n      mergeAttributes(this.options.HTMLAttributes, HTMLAttributes, {\n        'data-file-attachment': '',\n        'data-display-mode': HTMLAttributes.displayMode || 'inline',\n        'data-alignment': HTMLAttributes.alignment || 'left',\n      }),\n    ]\n  },\n\n  addNodeView() {\n    return ReactNodeViewRenderer(FileAttachmentComponent)\n  },\n\n  addCommands() {\n    return {\n      setFileAttachment:\n        (attributes) =>\n        ({ commands }) => {\n          return commands.insertContent({\n            type: this.name,\n            attrs: {\n              ...attributes,\n              displayMode: attributes.displayMode ?? 'inline',\n              alignment: attributes.alignment ?? 'left',\n            },\n          })\n        },\n      setFileAttachmentBlock:\n        (attributes) =>\n        ({ chain }) => {\n          // Insert a new paragraph, then the file attachment as a block, then another paragraph\n          return chain()\n            .insertContent([\n              {\n                type: 'paragraph',\n                content: [\n                  {\n                    type: this.name,\n                    attrs: {\n                      ...attributes,\n                      displayMode: 'block',\n                      alignment: attributes.alignment ?? 'left',\n                    },\n                  },\n                ],\n              },\n            ])\n            .run()\n        },\n      updateFileAttachment:\n        (attributes) =>\n        ({ commands }) => {\n          return commands.updateAttributes(this.name, attributes)\n        },\n      removeFileAttachment:\n        () =>\n        ({ commands }) => {\n          return commands.deleteSelection()\n        },\n      completeFileUpload:\n        (uploadId: string, src: string) =>\n        ({ tr, state, dispatch }) => {\n          let found = false\n          state.doc.descendants((node, pos) => {\n            if (node.type.name === 'fileAttachment' && node.attrs.uploadId === uploadId) {\n              if (dispatch) {\n                tr.setNodeMarkup(pos, undefined, {\n                  ...node.attrs,\n                  src,\n                  uploading: false,\n                  uploadId: null,\n                })\n              }\n              found = true\n              return false\n            }\n          })\n          if (dispatch && found) {\n            dispatch(tr)\n          }\n          return found\n        },\n      failFileUpload:\n        (uploadId: string) =>\n        ({ tr, state, dispatch }) => {\n          let found = false\n          state.doc.descendants((node, pos) => {\n            if (node.type.name === 'fileAttachment' && node.attrs.uploadId === uploadId) {\n              if (dispatch) {\n                tr.delete(pos, pos + node.nodeSize)\n              }\n              found = true\n              return false\n            }\n          })\n          if (dispatch && found) {\n            dispatch(tr)\n          }\n          return found\n        },\n    }\n  },\n})\n",
      "type": "registry:component"
    },
    {
      "path": "src/components/ui/editor/extensions/mention-extension.ts",
      "content": "import { Node, mergeAttributes } from '@tiptap/core'\nimport { ReactNodeViewRenderer } from '@tiptap/react'\nimport type { MentionItem } from '../types'\nimport { MentionComponent } from '../mention-component'\n\nexport interface MentionExtensionOptions {\n  HTMLAttributes: Record<string, unknown>\n  onMentionClick?: (item: MentionItem, event: MouseEvent) => void\n  onMentionRemove?: (item: MentionItem) => void\n  renderMention?: (item: MentionItem) => React.ReactNode\n}\n\ndeclare module '@tiptap/core' {\n  interface Commands<ReturnType> {\n    mention: {\n      setMention: (attributes: MentionItem) => ReturnType\n    }\n  }\n}\n\nexport const MentionExtension = Node.create<MentionExtensionOptions>({\n  name: 'mention',\n  group: 'inline',\n  inline: true,\n  selectable: true,\n  atom: true, // Treated as single unit\n\n  addOptions() {\n    return {\n      HTMLAttributes: {},\n      onMentionClick: undefined,\n      onMentionRemove: undefined,\n      renderMention: undefined,\n    }\n  },\n\n  addStorage() {\n    return {\n      onMentionClick: this.options.onMentionClick,\n      onMentionRemove: this.options.onMentionRemove,\n      renderMention: this.options.renderMention,\n    }\n  },\n\n  addAttributes() {\n    return {\n      id: { default: '' },\n      label: { default: '' },\n      avatar: { default: null },\n      metadata: { default: null },\n    }\n  },\n\n  parseHTML() {\n    return [{ tag: 'span[data-mention]' }]\n  },\n\n  renderHTML({ HTMLAttributes }) {\n    return [\n      'span',\n      mergeAttributes(this.options.HTMLAttributes, HTMLAttributes, {\n        'data-mention': '',\n        'data-mention-id': HTMLAttributes.id,\n        class: 'mention',\n      }),\n      `@${HTMLAttributes.label}`,\n    ]\n  },\n\n  addNodeView() {\n    return ReactNodeViewRenderer(MentionComponent)\n  },\n\n  addCommands() {\n    return {\n      setMention:\n        (attributes) =>\n        ({ commands }) => {\n          return commands.insertContent({\n            type: this.name,\n            attrs: attributes,\n          })\n        },\n    }\n  },\n\n  // Track when mentions are removed\n  onDestroy() {\n    // Cleanup if needed\n  },\n})\n",
      "type": "registry:component"
    },
    {
      "path": "src/components/ui/editor/extensions/mention-suggestion.ts",
      "content": "import { Extension } from '@tiptap/core'\nimport Suggestion, { type SuggestionOptions } from '@tiptap/suggestion'\nimport { PluginKey } from '@tiptap/pm/state'\nimport type { MentionItem } from '../types'\n\nconst mentionSuggestionPluginKey = new PluginKey('mentionSuggestion')\n\nexport interface MentionSuggestionOptions {\n  trigger: string\n  onSearch: (query: string) => Promise<MentionItem[]> | MentionItem[]\n  allowSpaces: boolean\n  minQueryLength: number\n  maxSuggestions: number\n  debounceMs: number\n  renderItem?: (item: MentionItem, isSelected: boolean) => React.ReactNode\n  noResultsText: string\n  loadingText: string\n  onMentionSelect?: (item: MentionItem) => void\n  suggestion?: Omit<SuggestionOptions<MentionItem>, 'editor'>\n}\n\nexport const MentionSuggestion = Extension.create<MentionSuggestionOptions>({\n  name: 'mentionSuggestion',\n\n  addOptions() {\n    return {\n      trigger: '@',\n      onSearch: () => [],\n      allowSpaces: false,\n      minQueryLength: 0,\n      maxSuggestions: 10,\n      debounceMs: 150,\n      renderItem: undefined,\n      noResultsText: 'No results found',\n      loadingText: 'Searching...',\n      onMentionSelect: undefined,\n      suggestion: undefined,\n    }\n  },\n\n  addStorage() {\n    return {\n      renderItem: this.options.renderItem,\n      noResultsText: this.options.noResultsText,\n      loadingText: this.options.loadingText,\n    }\n  },\n\n  addProseMirrorPlugins() {\n    return [\n      Suggestion({\n        editor: this.editor,\n        pluginKey: mentionSuggestionPluginKey,\n        char: this.options.trigger,\n        allowSpaces: this.options.allowSpaces,\n        startOfLine: false, // Allow @ anywhere\n\n        items: async ({ query }) => {\n          if (query.length < this.options.minQueryLength) return []\n          const results = await this.options.onSearch(query)\n          return results.slice(0, this.options.maxSuggestions)\n        },\n\n        command: ({ editor, range, props }) => {\n          // Insert a space after the mention if we're not at the end or if there's no space\n          const nodeAfter = editor.view.state.selection.$to.nodeAfter\n          const addSpace = !nodeAfter?.text?.startsWith(' ')\n\n          editor\n            .chain()\n            .focus()\n            .deleteRange(range)\n            .setMention({\n              id: props.id,\n              label: props.label,\n              avatar: props.avatar,\n              metadata: props.metadata,\n            })\n            .command(({ tr }) => {\n              if (addSpace) {\n                tr.insertText(' ')\n              }\n              return true\n            })\n            .run()\n\n          this.options.onMentionSelect?.(props)\n        },\n\n        ...this.options.suggestion,\n      }),\n    ]\n  },\n})\n",
      "type": "registry:component"
    },
    {
      "path": "src/components/ui/editor/plugins/index.ts",
      "content": "export {\n  createFileUploadPlugin,\n  type FileUploadPluginOptions,\n  type DisplayModeByType,\n  type PreviewOptions,\n  type CsvPreviewOptions,\n  type TextPreviewOptions,\n  type ImagePreviewOptions,\n  type PdfPreviewOptions,\n} from './file-upload'\n\nexport { createMentionPlugin, type MentionPluginOptions } from './mention'\n",
      "type": "registry:component"
    },
    {
      "path": "src/components/ui/editor/plugins/file-upload.ts",
      "content": "import { Paperclip, FileBox } from 'lucide-react'\nimport type { Editor } from '@tiptap/react'\nimport type { EditorPlugin, SlashCommand, ToolbarAction } from '../types'\nimport { FileAttachment } from '../extensions/file-attachment'\n\n// ============================================\n// Preview Customization Types\n// ============================================\n\n/**\n * CSV/Spreadsheet preview options\n */\nexport interface CsvPreviewOptions {\n  /** Maximum rows to display (default: 1000) */\n  maxRows?: number\n  /** Maximum columns to display (default: 50) */\n  maxColumns?: number\n  /** Show row numbers column (default: false) */\n  showRowNumbers?: boolean\n  /** Treat first row as header (default: true) */\n  headerRow?: boolean\n  /** CSV delimiter - 'auto' will detect (default: 'auto') */\n  delimiter?: ',' | ';' | '\\t' | '|' | 'auto'\n  /** Strip whitespace from cells (default: true) */\n  stripWhitespace?: boolean\n  /** Placeholder for empty cells (default: '-') */\n  emptyValuePlaceholder?: string\n  /** Maximum width per cell in pixels (default: 300) */\n  maxCellWidth?: number\n  /** Enable text wrapping in cells (default: false) */\n  wrapText?: boolean\n  /** Freeze header row while scrolling (default: true) */\n  freezeHeader?: boolean\n  /** Alternate row colors for readability (default: true) */\n  alternateRowColors?: boolean\n  /** Custom cell formatter */\n  formatCell?: (value: string, rowIndex: number, colIndex: number, header: string) => string\n  /** Columns to highlight (by index or header name) */\n  highlightColumns?: (number | string)[]\n}\n\n/**\n * Text/Code preview options\n */\nexport interface TextPreviewOptions {\n  /** Maximum characters to display (default: 500000) */\n  maxChars?: number\n  /** Maximum lines to display (default: 10000) */\n  maxLines?: number\n  /** Show line numbers (default: false) */\n  showLineNumbers?: boolean\n  /** Enable word wrap (default: true) */\n  wordWrap?: boolean\n  /** Font size in pixels (default: 13) */\n  fontSize?: number\n  /** Tab size for indentation (default: 2) */\n  tabSize?: number\n}\n\n/**\n * Image preview options\n */\nexport interface ImagePreviewOptions {\n  /** Maximum width constraint (default: none) */\n  maxWidth?: number\n  /** Maximum height constraint (default: none) */\n  maxHeight?: number\n  /** Allow zoom controls (default: true) */\n  allowZoom?: boolean\n  /** Show image metadata (dimensions, size) (default: true) */\n  showMetadata?: boolean\n  /** Background color for transparent images (default: 'checkerboard') */\n  transparentBackground?: 'checkerboard' | 'white' | 'black' | 'none'\n}\n\n/**\n * PDF preview options\n */\nexport interface PdfPreviewOptions {\n  /** Show page controls (default: true) */\n  showPageControls?: boolean\n}\n\n/**\n * Combined preview options\n */\nexport interface PreviewOptions {\n  csv?: CsvPreviewOptions\n  text?: TextPreviewOptions\n  image?: ImagePreviewOptions\n  pdf?: PdfPreviewOptions\n}\n\n/**\n * Display mode configuration by MIME type pattern\n * Patterns support wildcards like 'image/*'\n */\nexport type DisplayModeByType = Record<string, 'block' | 'inline'>\n\nlet uploadIdCounter = 0\nfunction generateUploadId(): string {\n  return `upload-${Date.now()}-${++uploadIdCounter}`\n}\n\nexport interface FileUploadPluginOptions {\n  /**\n   * Handler for uploading files. Should return the URL of the uploaded file.\n   */\n  onUpload: (file: File) => Promise<string>\n\n  /**\n   * Accepted file types (MIME types or extensions).\n   * @example ['image/*', 'application/pdf', '.doc', '.docx']\n   */\n  accept?: string[]\n\n  /**\n   * Maximum file size in bytes.\n   * @default 10 * 1024 * 1024 (10MB)\n   */\n  maxSize?: number\n\n  /**\n   * Default display mode for uploaded files.\n   * @default 'inline'\n   */\n  defaultDisplayMode?: 'block' | 'inline'\n\n  /**\n   * Custom file fetcher for preview. Use this when files are stored behind\n   * authentication or need special handling to retrieve content.\n   * Should return the file content as text or Blob.\n   * @param src - The file URL/path stored in the attachment\n   * @param mimeType - The MIME type of the file\n   */\n  onFetchFile?: (src: string, mimeType: string) => Promise<string | Blob>\n\n  /**\n   * Callback when upload starts.\n   */\n  onUploadStart?: (file: File) => void\n\n  /**\n   * Callback when upload completes successfully.\n   */\n  onUploadComplete?: (file: File, url: string) => void\n\n  /**\n   * Callback when upload fails.\n   */\n  onUploadError?: (file: File, error: Error) => void\n\n  /**\n   * Callback when a file is deleted from the editor.\n   * Use this to clean up server-side resources.\n   * @param src - The file URL\n   * @param name - The file name\n   * @param mimeType - The file MIME type\n   */\n  onFileDelete?: (src: string, name: string, mimeType: string) => void\n\n  /**\n   * Override default display mode for specific file types.\n   * Keys are MIME type patterns (supports wildcards like 'image/*').\n   * @example { 'image/*': 'block', 'application/pdf': 'block', 'text/*': 'inline' }\n   */\n  displayModeByType?: DisplayModeByType\n\n  /**\n   * Customize preview dialog behavior for different file types.\n   */\n  previewOptions?: PreviewOptions\n}\n\nfunction createFileInput(\n  options: FileUploadPluginOptions,\n  editor: Editor,\n  displayMode: 'block' | 'inline',\n): HTMLInputElement {\n  const input = document.createElement('input')\n  input.type = 'file'\n  input.multiple = true\n\n  if (options.accept && options.accept.length > 0) {\n    input.accept = options.accept.join(',')\n  }\n\n  input.onchange = async () => {\n    const files = input.files\n    if (!files || files.length === 0) return\n\n    for (const file of Array.from(files)) {\n      await uploadFile(file, options, editor, displayMode)\n    }\n\n    // Reset input for future use\n    input.value = ''\n  }\n\n  return input\n}\n\nasync function uploadFile(\n  file: File,\n  options: FileUploadPluginOptions,\n  editor: Editor,\n  requestedDisplayMode: 'block' | 'inline',\n): Promise<void> {\n  const maxSize = options.maxSize ?? 10 * 1024 * 1024 // 10MB default\n\n  // Check file size\n  if (file.size > maxSize) {\n    const error = new Error(`File \"${file.name}\" exceeds the maximum size of ${formatSize(maxSize)}`)\n    options.onUploadError?.(file, error)\n    console.error(error.message)\n    return\n  }\n\n  // Check file type if accept is specified\n  if (options.accept && options.accept.length > 0) {\n    const isAccepted = options.accept.some((pattern) => {\n      if (pattern.startsWith('.')) {\n        // Extension check\n        return file.name.toLowerCase().endsWith(pattern.toLowerCase())\n      }\n      if (pattern.endsWith('/*')) {\n        // Wildcard MIME type (e.g., 'image/*')\n        const baseType = pattern.slice(0, -2)\n        return file.type.startsWith(baseType)\n      }\n      // Exact MIME type match\n      return file.type === pattern\n    })\n\n    if (!isAccepted) {\n      const error = new Error(`File type \"${file.type}\" is not accepted`)\n      options.onUploadError?.(file, error)\n      console.error(error.message)\n      return\n    }\n  }\n\n  // Determine display mode before inserting placeholder\n  const displayMode = getDisplayModeForType(file.type, options.displayModeByType, requestedDisplayMode)\n\n  // Generate unique ID to find placeholder after async upload\n  const uploadId = generateUploadId()\n\n  // Insert placeholder immediately so user sees loading state\n  const placeholderAttrs = {\n    src: '',\n    name: file.name,\n    size: file.size,\n    mimeType: file.type,\n    uploading: true,\n    uploadId,\n  }\n\n  if (displayMode === 'block') {\n    editor.commands.setFileAttachmentBlock(placeholderAttrs)\n  } else {\n    editor.commands.setFileAttachment({\n      ...placeholderAttrs,\n      displayMode: 'inline',\n    })\n  }\n\n  options.onUploadStart?.(file)\n\n  try {\n    const url = await options.onUpload(file)\n\n    // Guard: editor may have been destroyed during the async upload\n    if (editor.isDestroyed) return\n\n    // Complete the upload: update placeholder with real URL\n    editor.commands.completeFileUpload(uploadId, url)\n\n    options.onUploadComplete?.(file, url)\n  } catch (err) {\n    const error = err instanceof Error ? err : new Error('Upload failed')\n    options.onUploadError?.(file, error)\n    console.error('File upload failed:', error)\n\n    // Remove the placeholder on failure\n    if (!editor.isDestroyed) {\n      editor.commands.failFileUpload(uploadId)\n    }\n  }\n}\n\nfunction formatSize(bytes: number): string {\n  if (bytes === 0) return '0 B'\n  const k = 1024\n  const sizes = ['B', 'KB', 'MB', 'GB']\n  const i = Math.floor(Math.log(bytes) / Math.log(k))\n  return parseFloat((bytes / Math.pow(k, i)).toFixed(1)) + ' ' + sizes[i]\n}\n\n/**\n * Determine display mode for a file based on its MIME type\n */\nfunction getDisplayModeForType(\n  mimeType: string,\n  displayModeByType: DisplayModeByType | undefined,\n  defaultMode: 'block' | 'inline',\n): 'block' | 'inline' {\n  if (!displayModeByType) return defaultMode\n\n  // Check for exact match first\n  if (displayModeByType[mimeType]) {\n    return displayModeByType[mimeType]\n  }\n\n  // Check for wildcard patterns (e.g., 'image/*')\n  for (const pattern of Object.keys(displayModeByType)) {\n    if (pattern.endsWith('/*')) {\n      const baseType = pattern.slice(0, -2)\n      if (mimeType.startsWith(baseType + '/')) {\n        return displayModeByType[pattern]\n      }\n    }\n  }\n\n  return defaultMode\n}\n\nfunction setupClipboardPaste(editor: Editor, options: FileUploadPluginOptions): () => void {\n  const handlePaste = async (event: ClipboardEvent) => {\n    const files = event.clipboardData?.files\n    if (!files || files.length === 0) return\n\n    // Only handle if clipboard contains files (screenshots, copied images)\n    // Let normal text paste pass through\n    const hasFiles = Array.from(files).some((file) => file.type.length > 0)\n    if (!hasFiles) return\n\n    event.preventDefault()\n    event.stopPropagation()\n\n    const defaultMode = options.defaultDisplayMode ?? 'inline'\n\n    for (const file of Array.from(files)) {\n      if (!file.type) continue\n\n      const displayMode = getDisplayModeForType(file.type, options.displayModeByType, defaultMode)\n      await uploadFile(file, options, editor, displayMode)\n    }\n  }\n\n  const editorElement = editor.view.dom\n  editorElement.addEventListener('paste', handlePaste)\n\n  return () => {\n    editorElement.removeEventListener('paste', handlePaste)\n  }\n}\n\nfunction setupDragAndDrop(editor: Editor, options: FileUploadPluginOptions): () => void {\n  const handleDragOver = (event: DragEvent) => {\n    event.preventDefault()\n    event.stopPropagation()\n  }\n\n  const handleDrop = async (event: DragEvent) => {\n    event.preventDefault()\n    event.stopPropagation()\n\n    const files = event.dataTransfer?.files\n    if (!files || files.length === 0) return\n\n    const defaultMode = options.defaultDisplayMode ?? 'inline'\n\n    for (const file of Array.from(files)) {\n      // Determine display mode based on file type\n      const displayMode = getDisplayModeForType(file.type, options.displayModeByType, defaultMode)\n      await uploadFile(file, options, editor, displayMode)\n    }\n  }\n\n  const editorElement = editor.view.dom\n\n  editorElement.addEventListener('dragover', handleDragOver)\n  editorElement.addEventListener('drop', handleDrop)\n\n  return () => {\n    editorElement.removeEventListener('dragover', handleDragOver)\n    editorElement.removeEventListener('drop', handleDrop)\n  }\n}\n\nexport function createFileUploadPlugin(options: FileUploadPluginOptions): EditorPlugin {\n  let fileInputInline: HTMLInputElement | null = null\n  let fileInputBlock: HTMLInputElement | null = null\n  let cleanupDragAndDrop: (() => void) | null = null\n  let cleanupClipboardPaste: (() => void) | null = null\n\n  const triggerInlineUpload = (editor: Editor) => {\n    if (!fileInputInline) {\n      fileInputInline = createFileInput(options, editor, 'inline')\n    }\n    fileInputInline.click()\n  }\n\n  const triggerBlockUpload = (editor: Editor) => {\n    if (!fileInputBlock) {\n      fileInputBlock = createFileInput(options, editor, 'block')\n    }\n    fileInputBlock.click()\n  }\n\n  // Default upload uses the configured default display mode\n  const triggerDefaultUpload = (editor: Editor) => {\n    const displayMode = options.defaultDisplayMode ?? 'inline'\n    if (displayMode === 'block') {\n      triggerBlockUpload(editor)\n    } else {\n      triggerInlineUpload(editor)\n    }\n  }\n\n  const slashCommands: SlashCommand[] = [\n    {\n      name: 'File',\n      description: 'Inline file attachment',\n      icon: Paperclip,\n      aliases: ['file', 'upload', 'attachment', 'attach', 'inline'],\n      group: 'media',\n      action: triggerInlineUpload,\n    },\n    {\n      name: 'File Card',\n      description: 'File attachment as card/block',\n      icon: FileBox,\n      aliases: ['filecard', 'fileblock', 'card', 'block'],\n      group: 'media',\n      action: triggerBlockUpload,\n    },\n  ]\n\n  const toolbarAction: ToolbarAction = {\n    id: 'file-upload',\n    icon: Paperclip,\n    label: 'Upload file',\n    action: triggerDefaultUpload,\n  }\n\n  return {\n    name: 'file-upload',\n    slashCommands,\n    toolbarActions: [toolbarAction],\n    extensions: [\n      FileAttachment.configure({\n        onFetchFile: options.onFetchFile,\n        previewOptions: options.previewOptions,\n        onFileDelete: options.onFileDelete,\n      }),\n    ],\n    onInit: (editor) => {\n      // Create file inputs for this editor\n      fileInputInline = createFileInput(options, editor, 'inline')\n      fileInputBlock = createFileInput(options, editor, 'block')\n      // Setup drag and drop\n      cleanupDragAndDrop = setupDragAndDrop(editor, options)\n      // Setup clipboard paste (screenshots, copied images)\n      cleanupClipboardPaste = setupClipboardPaste(editor, options)\n    },\n    onDestroy: () => {\n      // Cleanup file inputs\n      if (fileInputInline) {\n        fileInputInline.remove()\n        fileInputInline = null\n      }\n      if (fileInputBlock) {\n        fileInputBlock.remove()\n        fileInputBlock = null\n      }\n      // Cleanup drag and drop\n      if (cleanupDragAndDrop) {\n        cleanupDragAndDrop()\n        cleanupDragAndDrop = null\n      }\n      // Cleanup clipboard paste\n      if (cleanupClipboardPaste) {\n        cleanupClipboardPaste()\n        cleanupClipboardPaste = null\n      }\n    },\n  }\n}\n",
      "type": "registry:component"
    },
    {
      "path": "src/components/ui/editor/plugins/mention.ts",
      "content": "import { AtSign } from 'lucide-react'\nimport { ReactRenderer } from '@tiptap/react'\nimport tippy, { type Instance as TippyInstance } from 'tippy.js'\nimport type { SuggestionProps, SuggestionKeyDownProps } from '@tiptap/suggestion'\nimport type { EditorPlugin, MentionItem } from '../types'\nimport { MentionExtension } from '../extensions/mention-extension'\nimport { MentionSuggestion } from '../extensions/mention-suggestion'\nimport { MentionList, type MentionListRef } from '../mention-list'\n\nexport interface MentionPluginOptions {\n  /**\n   * Trigger character for mentions (default: \"@\")\n   */\n  trigger?: string\n\n  /**\n   * Search handler - required. Called when user types after trigger.\n   * Should return filtered list of mention items.\n   */\n  onSearch: (query: string) => Promise<MentionItem[]> | MentionItem[]\n\n  /**\n   * Allow spaces in search query (default: false)\n   * If false, mention closes on space\n   */\n  allowSpaces?: boolean\n\n  /**\n   * Minimum characters before searching (default: 0)\n   */\n  minQueryLength?: number\n\n  /**\n   * Maximum items to show in dropdown (default: 10)\n   */\n  maxSuggestions?: number\n\n  /**\n   * Debounce delay for search in ms (default: 150)\n   */\n  debounceMs?: number\n\n  /**\n   * Custom render for dropdown items\n   */\n  renderItem?: (item: MentionItem, isSelected: boolean) => React.ReactNode\n\n  /**\n   * Custom render for inserted mention\n   */\n  renderMention?: (item: MentionItem) => React.ReactNode\n\n  /**\n   * Placeholder text when no results (default: \"No results found\")\n   */\n  noResultsText?: string\n\n  /**\n   * Loading text while searching (default: \"Searching...\")\n   */\n  loadingText?: string\n\n  /**\n   * Callback when a mention is selected/inserted\n   */\n  onMentionSelect?: (item: MentionItem) => void\n\n  /**\n   * Callback when a mention is removed from editor\n   */\n  onMentionRemove?: (item: MentionItem) => void\n\n  /**\n   * Callback when mention is clicked in view/edit mode\n   */\n  onMentionClick?: (item: MentionItem, event: MouseEvent) => void\n}\n\nexport function createMentionPlugin(options: MentionPluginOptions): EditorPlugin {\n  const {\n    trigger = '@',\n    onSearch,\n    allowSpaces = false,\n    minQueryLength = 0,\n    maxSuggestions = 10,\n    debounceMs = 150,\n    renderItem,\n    renderMention,\n    noResultsText = 'No results found',\n    loadingText = 'Searching...',\n    onMentionSelect,\n    onMentionRemove,\n    onMentionClick,\n  } = options\n\n  return {\n    name: 'mention',\n\n    extensions: [\n      MentionExtension.configure({\n        onMentionClick,\n        onMentionRemove,\n        renderMention,\n      }),\n      MentionSuggestion.configure({\n        trigger,\n        onSearch,\n        allowSpaces,\n        minQueryLength,\n        maxSuggestions,\n        debounceMs,\n        renderItem,\n        noResultsText,\n        loadingText,\n        onMentionSelect,\n        suggestion: {\n          render: () => {\n            let component: ReactRenderer<MentionListRef> | null = null\n            let popup: TippyInstance[] | null = null\n\n            return {\n              onStart: (props: SuggestionProps<MentionItem>) => {\n                component = new ReactRenderer(MentionList, {\n                  props: {\n                    ...props,\n                    loading: false,\n                    noResultsText,\n                    loadingText,\n                    renderItem,\n                    command: props.command,\n                  },\n                  editor: props.editor,\n                })\n\n                if (!props.clientRect) return\n\n                popup = tippy('body', {\n                  getReferenceClientRect: props.clientRect as () => DOMRect,\n                  appendTo: () => document.body,\n                  content: component.element,\n                  showOnCreate: true,\n                  interactive: true,\n                  trigger: 'manual',\n                  placement: 'bottom-start',\n                  animation: 'shift-away',\n                  maxWidth: 'none',\n                })\n              },\n\n              onUpdate: (props: SuggestionProps<MentionItem>) => {\n                component?.updateProps({\n                  ...props,\n                  loading: false,\n                  noResultsText,\n                  loadingText,\n                  renderItem,\n                  command: props.command,\n                })\n\n                if (!props.clientRect) return\n\n                popup?.[0]?.setProps({\n                  getReferenceClientRect: props.clientRect as () => DOMRect,\n                })\n              },\n\n              onKeyDown: (props: SuggestionKeyDownProps) => {\n                if (props.event.key === 'Escape') {\n                  popup?.[0]?.hide()\n                  return true\n                }\n\n                return component?.ref?.onKeyDown(props) ?? false\n              },\n\n              onExit: () => {\n                popup?.[0]?.destroy()\n                component?.destroy()\n              },\n            }\n          },\n        },\n      }),\n    ],\n\n    // Optional: Add slash command for mentions\n    slashCommands: [\n      {\n        name: 'Mention',\n        description: 'Mention a user',\n        icon: AtSign,\n        aliases: ['mention', 'user', '@'],\n        group: 'basic',\n        action: (editor) => {\n          // Insert @ character to trigger mention\n          editor.chain().focus().insertContent(trigger).run()\n        },\n      },\n    ],\n  }\n}\n",
      "type": "registry:component"
    }
  ],
  "type": "registry:block"
}